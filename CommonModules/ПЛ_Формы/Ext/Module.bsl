//<< Портал-Юг Баринов 2019.02.08 [Общие метаданные] 
// Модуль для программного изменения форм и серверных обработчиков событий форм и элементов форм
//>> Портал-Юг Баринов 2019.02.08 

#Область ПрограммныйИнтерфейс

#Область СобытияФорм

//<< Портал-Юг Баринов 2019.02.08 [Общие метаданные]
// Процедура - При создании на сервере
// Процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
//  Форма				 - Форма - форма, из обработчика события которой происходит вызов процедуры
//  Отказ				 - Булево - Стандартный параметр обработчика
//  СтандартнаяОбработка - Булево - Стандартный параметр обработчика 
//
Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	ИмяФормы = Форма.ИмяФормы;
	
	Если Ложь Тогда
				
		//<<Портал-Юг, Давиденко 2019.02.11 [3.2.8 Редактирование цены в обработке «формирование заказов по потребностям»]
	ИначеЕсли Найти(ИмяФормы, "Обработка.ОбеспечениеПотребностей.Форма.Форма") <> 0 Тогда
		обрОбеспечениеПотребностейФормаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	ИначеЕсли Найти(ИмяФормы, "Документ.ЗаказПоставщику.Форма.ФормаДокумента") <> 0 Тогда
		докЗаказПоставщикуФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.11
		
	//<< Портал-Юг, Баринов, 2019.08.29 [б/н Сверка с оригиналом приобретения товаров]
	ИначеЕсли Найти(ИмяФормы, "Документ.ПриобретениеТоваровУслуг.Форма.ФормаДокумента") <> 0 Тогда
		докПриобретениеТоваровУслугФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//>> Портал-Юг, Баринов, 2019.08.29	
		
		//<<Портал-Юг, Давиденко 2019.02.11 [3.2.4 Колонка «уточнение» в документе «заказ на перемещение»]
	ИначеЕсли Найти(ИмяФормы, "Документ.ЗаказНаПеремещение.Форма.ФормаДокумента") <> 0 Тогда
		докЗаказНаПеремещениеФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.11
		
		//<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
	ИначеЕсли Найти(ИмяФормы, "Справочник.Склады.Форма.ФормаЭлемента") <> 0 Тогда
		спрСкладыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.12
		
		//<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
	ИначеЕсли Найти(ИмяФормы, "Документ.ПеремещениеТоваров.Форма.ФормаДокумента") <> 0 Тогда
		докПеремещениеТоваровФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.12
		
		//<<Портал-Юг, Давиденко 2019.02.13 [4.2.3 Вид операции «Заборный лист» в документе «Выпуск блюд»]
	ИначеЕсли Найти(ИмяФормы, "Документ.питВыпускБлюд.Форма.ФормаДокумента") <> 0 Тогда
		докПитВыпускБлюдФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.13
		
		//<<Портал-Юг, Давиденко 2019.02.14 [4.2.3 Вид операции «Заборный лист» в документе «Выпуск блюд»]
	ИначеЕсли Найти(ИмяФормы, "Документ.питВыпускБлюд.Форма.ФормаСписка") <> 0 Тогда
		докПитВыпускБлюдФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.14
		
		//<<Портал-Юг, Давиденко 2019.02.20 [4.2.7 Нулевая цена и аналитика продаж в отчёте о розничных продажах и выпуске блюд]
	ИначеЕсли Найти(ИмяФормы, "Документ.ОтчетОРозничныхПродажах.Форма.ФормаДокумента") <> 0 Тогда
		докОтчетОРозничныхПродажахФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.02.20
		
		//<<Портал-Юг, Каунов, 2019.03.04 [6.2.4 Настройки выгрузки в БП по организациям]
	ИначеЕсли Найти(ИмяФормы, "Справочник.Организации.Форма.ФормаЭлемента") <> 0 Тогда
		спрОрганизацииФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		
	ИначеЕсли Найти(ИмяФормы, "ПланВидовХарактеристик.СтатьиРасходов.Форма.ФормаЭлемента") <> 0 Тогда
		пвхСтатьиРасходовФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		
	ИначеЕсли Найти(ИмяФормы, "Справочник.ГруппыФинансовогоУчетаНоменклатуры.Форма.ФормаЭлемента") <> 0 Тогда
		спрГруппыФинансовогоУчетаНоменклатурыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Каунов, 2019.03.04			 
		
		//<< Портал-Юг Баринов 2019.03.12 [6.2.14 Дополнительные реквизиты в чеке общепита]
	ИначеЕсли Найти(ИмяФормы, "Документ.питДанныеПродажФронта.Форма.ФормаДокумента") <> 0 Тогда
		докпитДанныеПродажФронтаФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>> Портал-Юг Баринов 2019.03.12
		
		//<<Портал-Юг, Давиденко 2019.03.31 [5.2.5 Связь серии и упаковки]
	ИначеЕсли Найти(ИмяФормы, "Справочник.СерииНоменклатуры.Форма.ФормаЭлемента") <> 0 Тогда
		спрСерииНоменклатурыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		
	ИначеЕсли Найти(ИмяФормы, "Справочник.ВидыНоменклатуры.Форма.НастройкаСоставаРеквизитовСерии") <> 0 Тогда
		спрВидыНоменклатурыФормаНастройкаСоставаРеквизитовСерииПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Давиденко 2019.03.31
		
		//<< Портал-Юг Баринов 2019.02.26 [6.2.13 Регистр сведений «Соответствие с Front-системами»]
	ИначеЕсли Найти(ИмяФормы, "РегистрСведений.РезультатыОбменаДанными.Форма.Форма") <> 0 Тогда
		рсРезультатыОбменаДаннымиФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>> Портал-Юг Баринов 2019.02.26
		
	//<< Портал-Юг, Свинцов И.И., 2019.02.11 [5.2.26 Сопоставление вскрытой и не вскрытой номенклатуры алкогольной продукции] 
	ИначеЕсли Найти(ИмяФормы, "Справочник.Номенклатура.Форма.ФормаЭлемента") <> 0 Тогда		
		спрНоменклатураФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);		
	//>> Портал-Юг, Свинцов И.И. 2019.02.11
		
	//<<Портал-Юг, Каунов, 2019.02.15 [6.2.2 Правила регистрации справочников в БП]
	
	//<< Портал-Юг, Кондрашихин, 2023.11.16 [Обновление ERP 2.5] // Описание:
	//ФормаУзла перенесена поставщиком в ФормаСинхронизации
	
	//ИначеЕсли Найти(ИмяФормы, "ПланОбмена.СинхронизацияДанныхЧерезУниверсальныйФормат.ФормаУзла") <> 0  Тогда 
	//поСинхронизацияДанныхЧерезУФФормаУзлаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	
	ИначеЕсли Найти(ИмяФормы, "ПланОбмена.СинхронизацияДанныхЧерезУниверсальныйФормат.Форма.ФормаСинхронизации") <> 0  Тогда 
		поСинхронизацияДанныхЧерезУФФормаУзлаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	
	//>> Портал-Юг, Кондрашихин, 2023.11.16
	
	//>>Портал-Юг, Каунов, 2019.02.15	
	
	//<< Портал-Юг, Свинцов И.И., 2019.02.27 [5.2.31 Инвентаризация алкогольной продукции]
	ИначеЕсли Найти(ИмяФормы, "Документ.питИнвентаризацияТоваров.Форма.ФормаДокумента") <> 0 Тогда
		докПитИнвентаризацияТоваровФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка); 
	//>> Портал-Юг, Свинцов И.И., 2019.02.27
	
	//<< Портал-Юг, Свинцов И.И., 2019.03.01 [5.2.29 Автоматическая генерация серий и заполнение документа «Приобретение товаров и услуг»] 
	ИначеЕсли  Найти(ИмяФормы, "Документ.ТТНВходящаяЕГАИС.Форма.ФормаДокумента") <> 0 Тогда 
		докТТНВходящаяЕГАИСФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//>> Портал-Юг, Свинцов И.И., 2019.03.01
	
	//<<Портал-Юг, Давиденко 2019.03.12 [6.2.10 Отражение производства услуг по СКЛ]
	ИначеЕсли  Найти(ИмяФормы, "Документ.ПроизводствоБезЗаказа.Форма.ФормаДокумента") <> 0 Тогда 
		докПроизводствоБезЗаказаФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//>>Портал-Юг, Давиденко 2019.03.12	
	
	//<< Портал-Юг, Баринов, 2019.08.01 [ТП Нулевая цена по кассе ККМ] 
	ИначеЕсли Найти(ИмяФормы, "Справочник.КассыККМ.Форма.ФормаЭлемента") <> 0 Тогда
		спрКассыККМФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//>> Портал-Юг, Баринов, 2019.08.01
	
	//<<Портал-Юг, Гладкая Н. 22.05.2020 добавлен реквизит для обмена с ЕЛМА
	ИначеЕсли Найти(ИмяФормы, "Справочник.Партнеры.Форма.ФормаЭлементаРеквизитыКонтрагента") <> 0 Тогда
		спрПартнерыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Гладкая Н. 22.05.2020
	//<<Портал-Юг, Гладкая Н. 20.11.2020,SD33228
	ИначеЕсли Найти(ИмяФормы, "Задача.ЗадачаИсполнителя.Форма.ФормаЗадачи") <> 0 Тогда
		здчЗадачаИсполнителяПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		//>>Портал-Юг, Гладкая Н. 20.11.2020
		
	//<<Портал-Юг, Гладкая Н. 01.03.2021,SD40699
	ИначеЕсли Найти(ИмяФормы, "Документ.ЗаказНаПеремещение.Форма.ФормаСписка") <> 0 Тогда
		докЗаказНаПеремещениеФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//>>Портал-Юг, Гладкая Н. 01.03.2021
	
	//<<===ПорталЮгКрым, Плотникова Н.Ю. 21.07.2021 [51201]  
	ИначеЕсли Найти(ИмяФормы, "Документ.питПланМеню.Форма.ФормаДокумента") <> 0 Тогда
		докпитПланМенюФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		
		//<< Портал-Юг, Кондрашихин, 2024.09.13 [9268, Обновление ERP 2.5.17]
		// Отработанные в обработке планы-меню хранятся в РС и в обработку больше не попадают
		// Добавляет кнопку, если нужно, что бы план снова попадал в обработку
	ИначеЕсли Найти(ИмяФормы, "Обработка.питОбеспечениеПотребностей.Форма.Форма") <> 0 Тогда
		обрПитОбеспечениепотребностейФормаПриСозданииНаСервере(Форма, Отказ,СтандартнаяОбработка);
		//>> Портал-Юг, Кондрашихин, 2024.09.13
	// << MRS #ERP-5380 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 22.09.25, ()
	ИначеЕсли Найти(ИмяФормы, "Документ.ВнутреннееПотребление.Форма.ФормаДокумента") <> 0 Тогда
		докВнутреннееПотреблениеПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	// >> MRS #ERP-5380 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 22.09.25, ()
	//// << MRS #ERP-5464 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 21.10.25, ()                                                                                     // пока отключено и скорее всего надо будет удалить
	//ИначеЕсли Найти(ИмяФормы, "Справочник.ВетеринарноСопроводительныйДокументВЕТИС.Форма.ФормаЭлемента") <> 0 Тогда
	//	спрВетеринарноСопроводительныйДокументВЕТИСПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	//// >> MRS #ERP-5464 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 21.10.25, ()
	Иначе
		// ничего не выполняем
	КонецЕсли;
	//>>===ПорталЮгКрым === Плотникова Н.Ю. 21.07.2021  
	
	//<<Портал-Юг, Каунов, 2019.04.14 [6.2.7. Ограничение на редактирование сводных документов для выгрузки в БП]
	// Условие, тут будут только формы документов, по которым есть смысл делать проверку.
	Если Форма.ИмяФормы = "Документ.ВнутреннееПотребление.Форма.ФормаДокумента" 
		ИЛИ Форма.ИмяФормы = "Документ.ВозвратТоваровОтКлиента.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.СписаниеНедостачТоваров.Форма.ФормаДокумента" 
		ИЛИ Форма.ИмяФормы = "Документ.ПеремещениеТоваров.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.ДвижениеПродукцииИМатериалов.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.ОтчетОРозничныхПродажах.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.ОприходованиеИзлишковТоваров.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.ПроизводствоБезЗаказа.Форма.ФормаДокумента"
		ИЛИ Форма.ИмяФормы = "Документ.ПередачаТоваровМеждуОрганизациями.Форма.ФормаДокумента" 
		ИЛИ Форма.ИмяФормы = "Документ.ПередачаМатериаловВПроизводство.Форма.ФормаДокумента" Тогда
		
		Объект = Форма.Объект;
		
		//<<===ПорталЮгКрым, Плотникова Н.Ю. 30.08.2021 [54348,SD55032] для Гаранта оставляем свертку на просмотр 
		//Если Объект.ПЛ_ДокументВыгрузкиВБП Тогда
		Если НЕ ПустаяСтрока(Объект.Ссылка) и Объект.ПЛ_ДокументВыгрузкиВБП и СокрЛП(Объект.Организация.ИНН)="9103007830" И НЕ Объект.ПометкаУдаления Тогда
			//<<===ПорталЮгКрым, Плотникова Н.Ю. 12.05.2021 [45792] поставлен обход по Если, чтобы по обмену ERP_БП мигрировали доки ВнутреннееПотребление, только
			//с операцией Перечисления.ХозяйственныеОперации.ПередачаВЭксплуатацию  
			Если (ТипЗнч(Объект.Ссылка)=Тип("ДокументСсылка.ВнутреннееПотребление") и Объект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаВЭксплуатацию) тогда 
			иначе
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Документ открыт в режиме просмотра. Создан обработкой свёртки для выгрузки в БП КОРП.'"), Объект.Ссылка);
				Форма.ТолькоПросмотр = Истина;
				//<<MRS, Топольский, 2021.04.05, устал через обработки править строки, даю доступ для полных прав..
				Если РольДоступна("ПолныеПрава") Тогда
					Форма.ТолькоПросмотр = Ложь;
				КонецЕсли;
				//>>
			КонецЕсли;
		//>>Швецов. HELP1C-6836	. Для обработки ВГО
		ИначеЕсли НЕ ПустаяСтрока(Объект.Ссылка) и Объект.ПЛ_ДокументВыгрузкиВБП и Объект.Комментарий = "#Помеченный на удаление обработкой создания межфирменных" 
		И Объект.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПеремещениеТоваров Тогда
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru = 'Документ открыт в режиме просмотра. Создан обработкой создания межфирменных.'"), Объект.Ссылка);
				Форма.ТолькоПросмотр = Истина;
				//<<MRS, Топольский, 2021.04.05, устал через обработки править строки, даю доступ для полных прав..
				Если РольДоступна("ПолныеПрава") Тогда
					Форма.ТолькоПросмотр = Ложь;
				КонецЕсли;
		
		//>>Швецов. HELP1C-6836	. Для выгрузки ВГО

			//>>===ПорталЮгКрым === Плотникова Н.Ю. 12.05.2021  
		КонецЕсли; //>>===ПорталЮгКрым === Плотникова Н.Ю. 30.08.2021     
		
		//<<===Портал-Юг Крым === Плотникова Н.Ю. 15.05.2020 [Inv#72]
		Если Форма.ИмяФормы = "Документ.ОприходованиеИзлишковТоваров.Форма.ФормаДокумента" тогда
			докОприходованиеИзлишковТоваровПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		КонецЕсли;
		
		Если Форма.ИмяФормы = "Документ.СписаниеНедостачТоваров.Форма.ФормаДокумента" тогда
			докСписаниеНедостачТоваровПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
		КонецЕсли;
		//>>===Портал-Юг Крым === Плотникова Н.Ю. 15.05.2020 [InvD#72]
		
	КонецЕсли;
	//>>Портал-Юг, Каунов, 2019.04.14	
	
	ПЛ_СобытияФорм.ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	
КонецПроцедуры //>> Портал-Юг Баринов 2019.02.08

//<<===Портал-Юг Крым === Плотникова Н.Ю. 15.05.2020 [TID#461]
Процедура докОприходованиеИзлишковТоваровПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_НЕУчитыватьВОтчетеАнализТочекПродаж", "Объект.ПЛ_НЕУчитыватьВОтчетеАнализТочекПродаж", "ДатаНомер", "");
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
КонецПроцедуры

Процедура докСписаниеНедостачТоваровПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_НЕУчитыватьВОтчетеАнализТочекПродаж", "Объект.ПЛ_НЕУчитыватьВОтчетеАнализТочекПродаж", "ДатаНомер", "");
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
КонецПроцедуры
//>>===Портал-Юг Крым === Плотникова Н.Ю. 15.05.2020 [TID#461] 

//<< Портал-Юг Баринов 2019.02.08 [Общие метаданные]
// Процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
// 	Форма - форма, из обработчика события которой происходит вызов процедуры.
//	см. справочную информацию по событиям управляемой формы.
//
Процедура ПриЧтенииНаСервере(Форма, ТекущийОбъект) Экспорт
	
	ИмяФормы = Форма.ИмяФормы;
	
	Если Ложь Тогда
		
	//<< Портал-Юг, Баринов, 2019.08.22 [9.09. Обособление продаж по открытой цене]
	ИначеЕсли Найти(ИмяФормы, "Документ.питВыпускБлюд.Форма.ФормаДокумента") <> 0 Тогда
		докПитВыпускБлюдФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект);
	//>> Портал-Юг, Баринов, 2019.08.22	
	
	//<< Портал-Юг, Баринов, 2019.08.29 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе] + Редактирование организации в заказе на перемещение
	ИначеЕсли Найти(ИмяФормы, "Документ.ЗаказНаПеремещение.Форма.ФормаДокумента") <> 0 Тогда
		докЗаказНаПеремещениеФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект);
	//>> Портал-Юг, Баринов, 2019.08.29
	
	//<<===Портал-Юг Крым === Плотникова Н.Ю. 27.02.2020 [Inv#80] 
	ИначеЕсли Найти(ИмяФормы, "Документ.ЗаказПоставщику.Форма.ФормаДокумента") <> 0 Тогда
		докЗаказПоставщикуФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект);
	//>>===Портал-Юг Крым === Плотникова Н.Ю. 27.02.2020 [Inv#80] 
	КонецЕсли;
	
КонецПроцедуры //>> Портал-Юг Баринов 2019.02.08

//<< Портал-Юг, Свинцов И.И., 2019.03.19 [Общие метаданные]
// Процедура - После записи на сервере
// Переопределяемая процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
//  Форма				 - Форма - форма, из обработчика события которой происходит вызов процедуры
//  ТекущийОбъект		 - Объект -  Записываемый объект
//  ПараметрыЗаписи		 - Структура - Структура, содержащая параметры записи
//
Процедура ПослеЗаписиНаСервере(Форма, ТекущийОбъект, ПараметрыЗаписи) Экспорт
	
	ИмяФормы = Форма.ИмяФормы;	
	
	Если Найти(ИмяФормы, "Документ.ПриобретениеТоваровУслуг.Форма.ФормаДокумента") <> 0 Тогда
		докПриобретениеТоваровУслугПослеЗаписиНаСервере(Форма, ТекущийОбъект, ПараметрыЗаписи);
	КонецЕсли;
	
	ПЛ_СобытияФорм.ПослеЗаписиНаСервере(Форма, ТекущийОбъект, ПараметрыЗаписи);
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.03.19

//<< Портал-Юг, Баринов, 2019.04.10 [Общие метаданные]
// Процедура - Перед записью на сервере
// Переопределяемая процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
//  Форма			- Форма - форма, из обработчика события которой происходит вызов процедуры
//  Отказ			- Булево - Стандартный параметр обработчика
//  ТекущийОбъект   - Булево - Стандартный параметр обработчика 
//  ПараметрыЗаписи - Булево - Стандартный параметр обработчика 
//
Процедура ПередЗаписьюНаСервере(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи) Экспорт
	
	ИмяФормы = Форма.ИмяФормы;
	
	Если Ложь Тогда
				
	//<< Портал-Юг, Баринов, 2019.04.10 [5.2.6 Автозаполнение упаковок по серии в документах]
	ИначеЕсли Найти(ИмяФормы, "Документ.ПеремещениеТоваров.Форма.ФормаДокумента") <> 0 Тогда
		докПеремещениеТоваровФормаДокументаПередЗаписьюНаСервере(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи);
	ИначеЕсли Найти(ИмяФормы, "Документ.ПриобретениеТоваровУслуг.Форма.ФормаДокумента") <> 0 Тогда
		докПриобретениеТоваровУслугФормаДокументаПередЗаписьюНаСервере(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи);
	//>> Портал-Юг, Баринов, 2019.04.10
	КонецЕсли;	
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.04.10

// << Портал-Юг, Баринов, 2019.05.20 [Общие метаданные]
// Процедура - При загрузке данных из настроек на сервере
// Переопределяемая процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
//  Форма		- Форма - форма, из обработчика события которой происходит вызов процедуры
//  Настройки	- Структура	 - Стандартный параметр обработчика
//
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Форма, Настройки) Экспорт

	ИмяФормы = Форма.ИмяФормы;
	
	Если Ложь Тогда
				
	//<< Портал-Юг, Баринов, 2019.05.20 [6.2.13 Регистр сведений «Соответствие с Front-системами»]
	ИначеЕсли Найти(ИмяФормы, "РегистрСведений.РезультатыОбменаДанными.Форма.Форма") <> 0 Тогда
		рсРезультатыОбменаДаннымиФормаСпискаПриЗагрузкеДанныхИзНастроекНаСервере(Форма, Настройки);
    //>> Портал-Юг, Баринов, 2019.05.20
	
	КонецЕсли;
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.05.20

#КонецОбласти

#Область СобытияЭлементовФорм
// Обработчики событий элементов форм, содержащие более одной строки
	
#КонецОбласти

//<< Портал-Юг, Баринов, 2019.08.29 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе] + Редактирование организации в заказе на перемещение
//
// Параметры:
//  Форма						 - Форма - Форма, содержащая элемент "Организация".
//  ТекущийОбъект				 - ДокументОбъект - Документ, содержащий реквизиты СкладОтправитель и СкладПолучатель
//  ОрганизацияСкладОтправитель	 - СправочникСсылка.Организации - Организация из склада отправителя
//  ОрганизацияСкладПолучатель	 - СправочникСсылка.Организации - Организация из склада получателя
//
Процедура УправлениеДоступностьюОрганизацииВПеремещении(Форма, ТекущийОбъект, ОрганизацияСкладОтправитель = "", ОрганизацияСкладПолучатель = "") Экспорт
	
	Если Форма.ТолькоПросмотр Тогда
		Возврат;
	КонецЕсли; 
	
	Если Пользователи.ЭтоПолноправныйПользователь(Пользователи.ТекущийПользователь()) Тогда
		Возврат;
	КонецЕсли;
	
	ТолькоПросмотр = Истина;
	
	Если ОрганизацияСкладОтправитель = "" ИЛИ ОрганизацияСкладПолучатель = "" Тогда
		// Параметры не были переданы - вычисляем
		
		МассивПроверяемыхЭлементов = Новый Массив;
		МассивПроверяемыхЭлементов.Добавить(ТекущийОбъект.СкладОтправитель);
		МассивПроверяемыхЭлементов.Добавить(ТекущийОбъект.СкладПолучатель);
		СоответствиеОрганизаций = ОбщегоНазначения.ЗначениеРеквизитаОбъектов(МассивПроверяемыхЭлементов, "ПЛ_Организация");
	
		ОрганизацияСкладОтправитель = СоответствиеОрганизаций.Получить(ТекущийОбъект.СкладОтправитель);
		ОрганизацияСкладПолучатель = СоответствиеОрганизаций.Получить(ТекущийОбъект.СкладПолучатель);
	КонецЕсли; 
	
	Если НЕ ЗначениеЗаполнено(ОрганизацияСкладОтправитель) И НЕ ЗначениеЗаполнено(ОрганизацияСкладПолучатель) Тогда
		ТолькоПросмотр = Ложь;
	КонецЕсли;
	
	Форма.Элементы.Организация.ТолькоПросмотр = ТолькоПросмотр;
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.29

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область СобытияФорм

//<<Портал-Юг, Давиденко 2019.02.11 [3.2.8 Редактирование цены в обработке «формирование заказов по потребностям»]
Процедура обрОбеспечениеПотребностейФормаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ДобавляемыеРеквизиты = Новый Массив;

	//<<Портал-Юг, Давиденко 2019.02.11 [3.2.7 Уточнения из заказов на перемещение для закупок]
	ТипЧисло15_2 = Новый ОписаниеТипов("Число",,, Новый КвалификаторыЧисла(15,2));
			
	//>>Портал-Юг, Давиденко 2019.02.11
	ТипСтрока50 = Новый ОписаниеТипов("Строка",,,, Новый КвалификаторыСтроки(50));
	ДобавитьРеквизитНаФорму(Форма, "ПЛ_Комментарий", ТипСтрока50, "Объект.ЗаказыКОбеспечению", НСтр("ru = 'Комментарий (Портал)'"),, ДобавляемыеРеквизиты);
	ДобавитьРеквизитНаФорму(Форма, "ПЛ_Заказ", "ДокументСсылка.ЗаказНаПеремещение", "Объект.ЗаказыКОбеспечению", НСтр("ru = 'Заказ (Портал)'"),, ДобавляемыеРеквизиты); 
	//<<Портал Юг, Финик, SD36870 18.02.2021
	ТипДата = Новый ОписаниеТипов("Дата",,,,,Новый КвалификаторыДаты(ЧастиДаты.Дата));
	ДобавитьРеквизитНаФорму(Форма,"пл_ДатаЗаказа",ТипДата,"Объект.ЗаказыКОбеспечению",НСтр("ru = 'Дата заказа'"),,ДобавляемыеРеквизиты);
	//>>Портал Юг, Финик, SD36870 18.02.2021
	Форма.ИзменитьРеквизиты(ДобавляемыеРеквизиты);
	
	//<<Портал-Юг, Давиденко 2019.02.11 [3.2.7 Уточнения из заказов на перемещение для закупок]
	// Типовой реквизит выведен на форму для возможности изменения цены вручную
	ТаблицаЗаказыКолонкаЦена = Форма.Элементы.Добавить("ЦенаВВалютеУправленческогоУчета", Тип("ПолеФормы"), Форма.Элементы.ЗаказыКОбеспечению);
	ТаблицаЗаказыКолонкаЦена.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаЗаказыКолонкаЦена.Заголовок = НСтр("ru = 'Цена (Портал)'");
	ТаблицаЗаказыКолонкаЦена.ПутьКДанным = "Объект.ЗаказыКОбеспечению.ЦенаВВалютеУправленческогоУчета";
	Форма.Элементы.Переместить(ТаблицаЗаказыКолонкаЦена,Форма.Элементы.ЗаказыКОбеспечению, Форма.Элементы["СпособОбеспеченияЗаказы"]);
	ТаблицаЗаказыКолонкаЦена.УстановитьДействие("ПриИзменении", "Подключаемый_ПЛ_ЗаказыКОбеспечениюЦенаПриИзменении");
	//>>Портал-Юг, Давиденко 2019.02.11
	
	ТаблицаЗаказыКолонкаКомментарий = Форма.Элементы.Добавить("ПЛ_Комментарий", Тип("ПолеФормы"), Форма.Элементы.ЗаказыКОбеспечению);
	ТаблицаЗаказыКолонкаКомментарий.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаЗаказыКолонкаКомментарий.ТолькоПросмотр = Истина;
	ТаблицаЗаказыКолонкаКомментарий.ПутьКДанным = "Объект.ЗаказыКОбеспечению.ПЛ_Комментарий";
	Форма.Элементы.Переместить(ТаблицаЗаказыКолонкаКомментарий,Форма.Элементы.ЗаказыКОбеспечению, Форма.Элементы["НоменклатураЗаказы"]);
	//<<Портал Юг, Финик, SD36870 18.02.2021
	ТаблицаЗаказыКолонкаДатаЗаказа = Форма.Элементы.Добавить("пл_Дата", Тип("ПолеФормы"), Форма.Элементы.ЗаказыКОбеспечению);
	ТаблицаЗаказыКолонкаДатаЗаказа.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаЗаказыКолонкаДатаЗаказа.ТолькоПросмотр = Истина;
	ТаблицаЗаказыКолонкаДатаЗаказа.Заголовок = "Дата заказа";
	ТаблицаЗаказыКолонкаДатаЗаказа.ПутьКДанным = "Объект.ЗаказыКОбеспечению.пл_ДатаЗаказа";
	Форма.Элементы.Переместить(ТаблицаЗаказыКолонкаДатаЗаказа,Форма.Элементы.ЗаказыКОбеспечению, Форма.Элементы["Требуется"]);
	//>>Портал Юг, Финик, SD36870 18.02.2021
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.11

//<<Портал-Юг, Давиденко 2019.02.11 [3.2.4 Колонка «уточнение» в документе «заказ на перемещение»]
Процедура докЗаказНаПеремещениеФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ТаблицаТоварыКолонкаКомментарий = Форма.Элементы.Добавить("ПЛ_Комментарий", Тип("ПолеФормы"), Форма.Элементы.Товары);
	ТаблицаТоварыКолонкаКомментарий.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаТоварыКолонкаКомментарий.ПутьКДанным = "Объект.Товары.ПЛ_Комментарий";
	Форма.Элементы.Переместить(ТаблицаТоварыКолонкаКомментарий,Форма.Элементы.Товары, Форма.Элементы["ТоварыХарактеристика"]);
	
	//<< Портал-Юг, Баринов, 2019.08.29 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе] + Редактирование организации в заказе на перемещение
 	// Перенёс в ПриЧтенииНаСервере
	////<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
	//СнятьДоступностьСОрганизации(Форма);
	////>>Портал-Юг, Давиденко 2019.02.12
	Если Не ЗначениеЗаполнено(Форма.Объект.Ссылка) Тогда
		УправлениеДоступностьюОрганизацииВПеремещении(Форма, Форма.Объект);
		
		//<<Портал-Юг, Гладкая Н. 09.03.2021,SD40699
		Если Не РольДоступна("ПолныеПрава") И РольДоступна("ПЛ_ФинДепартаментЗакупкиРучные") Тогда
			Сообщить("Нет прав для создания заказа на перемещение!");
			Отказ=Истина;
		КонецЕсли;
		//>>Портал-Юг, Гладкая Н. 09.03.2021
	КонецЕсли;	
	//>> Портал-Юг, Баринов, 2019.08.29
	
	//<< Портал-Юг, Кондрашихин, 2024.08.12 [9268, Обновление ERP 2.5.17]
	// выводит поле формы ПЛ_Отменитьраспределениезапасов
	ДобавитьПолеОтменитьРаспределениеЗапасовНаФорму(Форма, Отказ, СтандартнаяОбработка);
	//>> Портал-Юг, Кондрашихин, 2024.08.12
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.11

//<< Портал-Юг, Баринов, 2019.08.29 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе] + Редактирование организации в заказе на перемещение
Процедура докЗаказНаПеремещениеФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект);

	УправлениеДоступностьюОрганизацииВПеремещении(Форма, ТекущийОбъект);
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.29

//<<Портал-Юг, Давиденко 2019.02.11 [3.2.8 Редактирование цены в обработке «формирование заказов по потребностям»]
Процедура докЗаказПоставщикуФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	//<< Портал-Юг, Кондрашихин, 2024.08.12 [9268, Обновление ERP 2.5.17]
	// выводит поле формы ПЛ_Отменитьраспределениезапасов
	ДобавитьПолеОтменитьРаспределениеЗапасовНаФорму(Форма, Отказ, СтандартнаяОбработка);
	//>> Портал-Юг, Кондрашихин, 2024.08.12
	
	//<<===Портал-Юг Крым === Плотникова Н.Ю. 26.03.2020 [Inv#80]  перенесено в докЗаказПоставщикуФормаДокументаПриЧтенииНаСервере
	//ТаблицаТоварыКолонкаКомментарий = Форма.Элементы.Добавить("ПЛ_Комментарий", Тип("ПолеФормы"), Форма.Элементы.Товары);
	//ТаблицаТоварыКолонкаКомментарий.Вид = ВидПоляФормы.ПолеВвода;
	//ТаблицаТоварыКолонкаКомментарий.ПутьКДанным = "Объект.Товары.ПЛ_Комментарий";
	//Форма.Элементы.Переместить(ТаблицаТоварыКолонкаКомментарий,Форма.Элементы.Товары, Форма.Элементы["ТоварыХарактеристика"]);
	//
	//ГруппаЗаказ = Форма.Элементы.Добавить("ПЛ_ГруппаЗаказ", Тип("ГруппаФормы"), Форма.Элементы.Товары);
	//ГруппаЗаказ.Группировка = ГруппировкаКолонок.Горизонтальная;
	//Форма.Элементы.Переместить(ГруппаЗаказ, Форма.Элементы.Товары, Форма.Элементы["ТоварыНоменклатура"]);
	//
	//ТаблицаТоварыНадписьСклад = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Склад", "Объект.Товары.ПЛ_Заказ.СкладПолучатель", "ПЛ_ГруппаЗаказ");
	//ТаблицаТоварыНадписьСклад.АвтоОтметкаНезаполненного = Ложь;
	//ТаблицаТоварыКолонкаЗаказ = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Заказ", "Объект.Товары.ПЛ_Заказ", "ПЛ_ГруппаЗаказ");
	//
	////<< Портал-Юг, Свинцов И.И., 2019.08.27 [9.18 Закрытие заказов на перемещение при закрытии заказа поставщику]
	//нЭлемент = ДобавитьКнопкуНаФорму(Форма, "ПЛ_ЗакрытьЗаказыНаПеремещение", "Подключаемый_ПЛ_ЗакрытьЗаказыНаПеремещение", НСтр("ru = 'Закрыть заказы на перемещение'"), "ГруппаСтатусПриоритет", "ГруппаСостояниеЗаказа", "Гиперссылка");
	//нЭлемент.ГоризонтальноеПоложениеВГруппе = ГоризонтальноеПоложениеЭлемента.Лево;
	////>> Портал-Юг, Свинцов И.И., 2019.08.27
	//
	////<<Портал-Юг, Каунов, 2020.01.08 [INV#32 Заявка не попадает в формирование по потребностям]
	//нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ОтклоненНаДоработку", "Объект.ПЛ_ОтклоненНаДоработку", "ГруппаСтатусПриоритет", "ЗакрытьЗаказ");
	//нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
	////>>Портал-Юг, Каунов, 2020.01.08
	//>>===Портал-Юг Крым === Плотникова Н.Ю. 26.03.2020 [Inv#80]
	
	// << MRS #HELP1C-11848 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 24.02.25, ()
	стрРеквизитовТЧ = Новый Структура;
	стрРеквизитовТЧ.Вставить("ТоварыЦенаУст",ОписаниеТипаЧисло(15,2));
	СоздатьРеквизитыТаблицы(Форма,"Объект.Товары",стрРеквизитовТЧ);
	
	ТаблицаТовары = Форма.Элементы.Товары;
	НовыйРеквизит = Форма.Элементы.Вставить("ТоварыЦенаУст", Тип("ПолеФормы"), ТаблицаТовары, Форма.Элементы.ТоварыЦена);
	НовыйРеквизит.Заголовок = "Уст. Цена";
	НовыйРеквизит.Вид = ВидПоляФормы.ПолеВвода;
	НовыйРеквизит.ПутьКДанным = "Объект.Товары.ТоварыЦенаУст";
	//Форма.Объект.Товары
	Если Форма.Объект.Товары.Количество() Тогда
		ВидЦены = MRS_СлужебныеПараметрыПовтИсп.ПолучитьЗначение("ВидЦеныАвтоУстанвкиЦен", "Значение");
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЦеныНоменклатурыСрезПоследних.Номенклатура КАК Номенклатура,
		|	ЦеныНоменклатурыСрезПоследних.Цена КАК Цена
		|ИЗ
		|	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
		|			&ПериодДокумента,
		|			Номенклатура В (&Номенклатура)
		|				И ВидЦены = &ВидЦены) КАК ЦеныНоменклатурыСрезПоследних";
		ТЗ = Форма.Объект.Товары.Выгрузить();
		Номенклатура = ТЗ.ВыгрузитьКолонку("Номенклатура");
		Запрос.УстановитьПараметр("ВидЦены", ВидЦены);
		Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
		Запрос.УстановитьПараметр("ПериодДокумента", Форма.Объект.Дата);
		
		ТабЦен = Запрос.Выполнить().Выгрузить();
		Если ТабЦен.Количество() Тогда
			Для Каждого Строка ИЗ Форма.Объект.Товары Цикл
				НайденнаяСтрока = ТабЦен.Найти(Строка.Номенклатура, "Номенклатура");
				Если НЕ НайденнаяСтрока = Неопределено Тогда
					Строка.ТоварыЦенаУст = НайденнаяСтрока.Цена;
				КонецЕсли;
			КонецЦикла;
			ЭлементУсловногоОформления = Форма.УсловноеОформление.Элементы.Добавить();
			ОформляемоеПоле = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
			ОформляемоеПоле.Поле = Новый ПолеКомпоновкиДанных("ТоварыЦенаУст");
			ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных(НовыйРеквизит.ПутьКДанным);
			ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Меньше;
			ЭлементОтбора.ПравоеЗначение = Новый ПолеКомпоновкиДанных(Форма.Элементы.ТоварыЦена.ПутьКДанным);
			ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", WebЦвета.Красный);
			
			ЭлементУсловногоОформления = Форма.УсловноеОформление.Элементы.Добавить();
			ОформляемоеПоле = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
			ОформляемоеПоле.Поле = Новый ПолеКомпоновкиДанных("ТоварыЦенаУст");
			ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных(НовыйРеквизит.ПутьКДанным);
			ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.БольшеИлиРавно;
			ЭлементОтбора.ПравоеЗначение = Новый ПолеКомпоновкиДанных(Форма.Элементы.ТоварыЦена.ПутьКДанным);
			ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", WebЦвета.Зеленый);
		КонецЕсли;
	КонецЕсли;
	// >> MRS #HELP1C-11848 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 24.02.25, ()
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.11

//<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
Процедура спрСкладыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	ПЛ_Организация = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Организация", "Объект.ПЛ_Организация", "ГруппаПодразделение", "Подразделение");
	ПЛ_Организация.МаксимальнаяШирина = 35;// как у подразделения
	ПЛ_Организация.АвтоМаксимальнаяШирина = Ложь;
	
	// << MRS #ERP-4980 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 20.03.25, ()
	MRS_МОЛ_За_ТМЦ = ДобавитьПолеВводаНаФорму(Форма, "MRS_МОЛ_За_ТМЦ", "Объект.MRS_МОЛ_За_ТМЦ", "ГруппаМОЛ",);
	MRS_МОЛ_За_ТМЦ.МаксимальнаяШирина = 35;
	MRS_МОЛ_За_ТМЦ.АвтоМаксимальнаяШирина = Ложь;
	// >> MRS #ERP-4980 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 20.03.25, ()
	// << MRS #ERP-5419 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 23.09.25, ()
	MRS_ОтветственноеЛицо = ДобавитьПолеВводаНаФорму(Форма, "MRS_ОтветственноеЛицо", "MRS_ОтветственноеЛицо", "ГруппаМОЛ","ТекущаяДолжностьОтветственного");
	MRS_ОтветственноеЛицо.МаксимальнаяШирина = 35;
	MRS_ОтветственноеЛицо.АвтоМаксимальнаяШирина = Ложь;
	
	MRS_ТекущаяДолжностьОтветственного = ДобавитьПолеВводаНаФорму(Форма, "MRS_ТекущаяДолжностьОтветственного", "MRS_ТекущаяДолжностьОтветственного", "ГруппаМОЛ","ТекущаяДолжностьОтветственного");
	MRS_ТекущаяДолжностьОтветственного.МаксимальнаяШирина = 35;
	MRS_ТекущаяДолжностьОтветственного.АвтоМаксимальнаяШирина = Ложь;
	
	Если НЕ ПравоДоступа("Изменение", Метаданные.НайтиПоТипу(Тип("РегистрСведенийЗапись.MRS_ОтветственныеЛица"))) Тогда
		MRS_ОтветственноеЛицо.ТолькоПросмотр = Истина;
		MRS_ТекущаяДолжностьОтветственного.ТолькоПросмотр = Истина;
	КонецЕсли;
	MRS_ОтветственноеЛицо.УстановитьДействие("ОбработкаВыбора", "MRS_ОтветственноеЛицоОбработкаВыбора");
	Элементы.ТекущийОтветственный.Видимость = Ложь;
	MRS_ТекущаяДолжностьОтветственного.УстановитьДействие("ОбработкаВыбора", "MRS_ТекущаяДолжностьОтветственногоОбработкаВыбора");
	//Элементы.ТекущаяДолжностьОтветственного.Видимость = Ложь;      // Временно не прячем старую должность, так как она строка...
	// >> MRS #ERP-5419 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 23.09.25, ()
	
	//<< Портал-Юг, Свинцов И.И., 2019.02.20 [5.2.27 Закрытие заказов по алкогольной продукции]	
	
	//<< Портал-Юг, Кондрашихин, 2023.08.29 [Обновление ERP 2.5] // Описание: Смена имени группы от поставщика 
	
	//нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ИспользоватьПодменуАлкогольнойПродукции", "Объект.ПЛ_ИспользоватьПодменуАлкогольнойПродукции", "Контроль", "ГруппаКонтролироватьОбеспечение");
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ИспользоватьПодменуАлкогольнойПродукции", "Объект.ПЛ_ИспользоватьПодменуАлкогольнойПродукции", "Контроль", "ГруппаКонтролироватьКонтролироватьСвободныеОстатки");
	//>> Портал-Юг, Кондрашихин, 2023.08.29

	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
	//>> Портал-Юг, Свинцов И.И., 2019.02.20
	
	//<<Портал-Юг, Каунов, 2019.12.03 [Не выгружать в БП перемещения по спец. складу]
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_НеВыгружатьВБП", "Объект.ПЛ_НеВыгружатьВБП", "ГруппаПодразделение");
	//>>Портал-Юг, Каунов, 2019.12.03	

КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.12

//<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
Процедура докПеремещениеТоваровФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	СнятьДоступностьСОрганизации(Форма);
	
	//<< Портал-Юг, Татаринов Д., 10.06.2020 новые реквизиты для обмена с Elma
	ТаблицаТоварыКолонкаПринято = Форма.Элементы.Добавить("ПЛ_ПринятоELMA", Тип("ПолеФормы"), Форма.Элементы.Товары);
	ТаблицаТоварыКолонкаПринято.Вид = ВидПоляФормы.ПолеФлажка;
	ТаблицаТоварыКолонкаПринято.ПутьКДанным = "Объект.Товары.ПЛ_ПринятоELMA";
	
	//>> Портал-Юг, Татаринов Д., 10.06.2020
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.12

//<<Портал-Юг, Давиденко 2019.02.12 [3.2.1 Автоматическое заполнение организации по складу, указанному в документе]
Процедура СнятьДоступностьСОрганизации(Форма)
	
	// << MRS #ERP-5376 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 15.08.25, (Дублирование, переработано в самом документе с условиями)
	//Если Не Пользователи.ЭтоПолноправныйПользователь(Пользователи.ТекущийПользователь()) Тогда
	//	Форма.Элементы.Организация.ТолькоПросмотр = Истина;
	//КонецЕсли;
	// >> MRS #ERP-5376 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 15.08.25, ()
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.12

//<<Портал-Юг, Давиденко 2019.02.13 [4.2.3 Вид операции «Заборный лист» в документе «Выпуск блюд»]
Процедура докПитВыпускБлюдФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Номенклатура", "Объект.ПЛ_Номенклатура","ГруппаШапкаЛевая");
	Форма.Элементы.ПЛ_Номенклатура.АвтоОтметкаНезаполненного = Истина;
	Форма.Элементы.ПЛ_Номенклатура.АвтоМаксимальнаяШирина= Ложь; // как у остальных полей в группе
	Форма.Элементы.ПЛ_Номенклатура.МаксимальнаяШирина = 0;
	
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_ХозяйственнаяОперация", "Объект.ПЛ_ХозяйственнаяОперация", "ГруппаШапкаПравая", "ВидОперации");
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.АвтоМаксимальнаяШирина = Ложь; // как у остальных полей в группе
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.МаксимальнаяШирина = 0;
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.УстановитьДействие("ПриИзменении", "Подключаемый_ПЛ_ХозяйственнаяОперацияПриИзменении");
	
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.КнопкаВыпадающегоСписка = Истина;
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.КнопкаВыбора = Ложь;
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.РежимВыбораИзСписка = Истина;
	Форма.Элементы.ПЛ_ХозяйственнаяОперация.ЦветФона = Форма.Элементы.ВидОперации.ЦветФона;
	СписокВидовОпераций = Форма.Элементы.ВидОперации.СписокВыбора;
	СписокВидовОпераций.Добавить(Перечисления.питХозяйственныеОперации.ПЛ_ЗаборныйЛист);

	Для Каждого ВидОперации Из СписокВидовОпераций Цикл
		Форма.Элементы.ПЛ_ХозяйственнаяОперация.СписокВыбора.Добавить(ВидОперации.Значение); 
	КонецЦикла;
	
	СписокВидовОпераций = Неопределено;
	
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_Передано", "Объект.Товары.ПЛ_Передано", "Товары", "ТоварыКоличествоУпаковок");
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_Возвращено", "Объект.Товары.ПЛ_Возвращено", "Товары", "ТоварыКоличествоУпаковок");
	
	ГруппаВремя = Элементы.Добавить("ПЛ_ГруппаВремя", Тип("ГруппаФормы"), Элементы.Товары);
	Элементы.Переместить(ГруппаВремя, Элементы.Товары, Элементы.ТоварыЦена);
	ГруппаВремя.Вид = ВидГруппыФормы.ГруппаКолонок;
	ГруппаВремя.Заголовок = НСтр("ru = 'Время приготовления (Портал)'");
	ГруппаВремя.Группировка = ГруппировкаКолонок.Горизонтальная;

	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_ВремяПриготовления", "Объект.Товары.ПЛ_ВремяПриготовления", "ПЛ_ГруппаВремя");
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_ВремяПриготовления2", "Объект.Товары.ПЛ_ВремяПриготовления2", "ПЛ_ГруппаВремя");
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_ВремяПриготовления3", "Объект.Товары.ПЛ_ВремяПриготовления3", "ПЛ_ГруппаВремя");
	
	//<< Портал-Юг, Баринов, 2019.08.21 [Интерфейс]
	ДобавитьКнопкуНаФорму(Форма, "ПЛ_ЗаполнитьВремя", "Подключаемый_ПЛ_ЗаполнитьВремя", НСтр("ru = 'Заполнить время'"), "ТоварыЗаполнить");
	//>> Портал-Юг, Баринов, 2019.08.21
	
	Форма.Элементы.ПЛ_Передано.УстановитьДействие("ПриИзменении", "Подключаемый_ПЛ_ПереданоПриИзменении");
	Форма.Элементы.ПЛ_Возвращено.УстановитьДействие("ПриИзменении", "Подключаемый_ПЛ_ВозвращеноПриИзменении");
	
	//<<Портал-Юг, Давиденко 2019.02.19 [4.2.7 Нулевая цена и аналитика продаж в отчёте о розничных продажах и выпуске блюд]
	НовоеПоле = ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_Договор", "Объект.Товары.ПЛ_Договор", "Товары");
	Если НЕ ПравоДоступа("Проведение", Метаданные.НайтиПоТипу(Тип("ДокументСсылка.питВыпускБлюд"))) Тогда
		НовоеПоле.ТолькоПросмотр = Истина;
	//>>Портал-Юг, Давиденко 2019.02.19
	//<< Портал-Юг, Баринов, 2019.09.15 [9.20 Настройка доступа к документу «Выпуск блюд» для супервайзеров и поваров]
	 	Если ЗначениеЗаполнено(Форма.Объект.Ссылка) И Форма.Объект.ПЛ_ХозяйственнаяОперация = Перечисления.питХозяйственныеОперации.ВыпускПродукцииСРозничнойРеализацией Тогда
			Форма.Элементы.ПЛ_ХозяйственнаяОперация.ТолькоПросмотр = Истина;
			Форма.Элементы.ПЛ_Номенклатура.ТолькоПросмотр = Истина;
		КонецЕсли; 
	КонецЕсли;
	//>> Портал-Юг, Баринов, 2019.09.15
	
	//<<Портал-Юг, Давиденко 2019.04.02 [4.2.9 Особенности заполнения выпуска блюд по чекам]
	Форма.Элементы.ТоварыРецептура.ТолькоПросмотр = Ложь;
	//>>Портал-Юг, Давиденко 2019.04.02
	
	//<<Портал-Юг, Давиденко 2019.03.01 [4.2.3 Вид операции «Заборный лист» в документе «Выпуск блюд»]
	Форма.Элементы.СкладПолучатель.УстановитьДействие("ПриИзменении", "Подключаемый_ПЛ_СкладПриИзменении");	
	//>>Портал-Юг, Давиденко 2019.03.01
	
	//<< Портал-Юг, Баринов, 2019.08.23 [9.09. Обособление продаж по открытой цене]
	ДобавитьРеквизитНаФормуЕслиЕгоНет(Форма, "ПЛ_ЭтоОткрытаяЦена", "Булево");
	//>> Портал-Юг, Баринов, 2019.08.23
	
	//<< Портал-Юг, Кондрашихин, 2024.08.21 [9268, Обновление ERP 2.5.17]
	ПланМенюОснование = ДобавитьПолеВводаНаФорму(Форма, "Основание", "Объект.ДокументОснование","ГруппаМесто","Организация");
	//>> Портал-Юг, Кондрашихин, 2024.08.21

КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.13

//<< Портал-Юг, Баринов, 2019.08.22 [9.09. Обособление продаж по открытой цене]
Процедура докПитВыпускБлюдФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект)
	
	ЭлементыФормы = Форма.Элементы;
	
	ДобавитьРеквизитНаФормуЕслиЕгоНет(Форма, "ПЛ_ЭтоОткрытаяЦена", "Булево");
	
	Форма.ПЛ_ЭтоОткрытаяЦена = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ТекущийОбъект.ПЛ_Номенклатура, "питПродажаПоСвободнойЦене") = Истина;
	
	//<< Портал-Юг, Баринов, 2019.09.15 [9.20 Настройка доступа к документу «Выпуск блюд» для супервайзеров и поваров]
	Если ТекущийОбъект.ПЛ_ХозяйственнаяОперация = Перечисления.питХозяйственныеОперации.ВыпускПродукцииСРозничнойРеализацией И НЕ ПравоДоступа("Проведение", ТекущийОбъект.Метаданные()) Тогда
		// Всё должно быть недоступно, кроме нескольких реквизитов ТЧ товары и закладки "Производство".
		
		ДоступныеЭлементы = Новый Массив;
		ДоступныеРодители = Новый Массив;
		Если Форма.ПЛ_ЭтоОткрытаяЦена Тогда 
			ДоступныеЭлементы.Добавить("РежимРасчетаСписанияВПроизводство");
			ДоступныеЭлементы.Добавить("Товары");
			ДоступныеЭлементы.Добавить("ТоварыНоменклатура");
			ДоступныеЭлементы.Добавить("ТоварыХарактеристика");
			ДоступныеЭлементы.Добавить("ТоварыКоличествоУпаковок");
			ДоступныеЭлементы.Добавить("ТоварыУпаковка");
			ДоступныеЭлементы.Добавить("ТоварыРецептура");
			
			ДоступныеРодители.Добавить("Ингредиенты");
		КонецЕсли;
		ОбрабатываемыеТипы = Новый ОписаниеТипов("ПолеФормы, ПолеФлажкаФормы, ТаблицаФормы");
		
		Для каждого ЭлементФормы Из ЭлементыФормы Цикл
			
			ИмяРодителя = ?(ТипЗнч(ЭлементФормы.Родитель) = Тип("УправляемаяФорма"), "", ЭлементФормы.Родитель.Имя); 
			
			Если ОбрабатываемыеТипы.СодержитТип(ТипЗнч(ЭлементФормы))
				И ДоступныеЭлементы.Найти(ЭлементФормы.Имя) = Неопределено
				И ДоступныеРодители.Найти(ИмяРодителя) = Неопределено Тогда	
				
				ЭлементФормы.ТолькоПросмотр = Истина;
			КонецЕсли; 
		КонецЦикла;		
		
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "Товары", "ИзменятьСоставСтрок", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "Трудозатраты", "ИзменятьСоставСтрок", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "ПобочныеИзделия", "ИзменятьСоставСтрок", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "ТоварыПодменюПодбор", "Доступность", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "ТоварыЗаполнить", "Доступность", Ложь);
		ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(ЭлементыФормы, "ТоварыВставитьСтроки", "Видимость", Ложь);
			
	КонецЕсли; 
	//>> Портал-Юг, Баринов, 2019.09.15
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.22

//<<Портал-Юг, Давиденко 2019.02.14 [4.2.3 Вид операции «Заборный лист» в документе «Выпуск блюд»]
Процедура докПитВыпускБлюдФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ДобавитьПолеНаФорму("ПолеНадписи", Форма, "ПЛ_ХозяйственнаяОперация", "Список.Ссылка.ПЛ_ХозяйственнаяОперация", "Список", "Дата");
	ОбщегоНазначенияКлиентСервер.УстановитьСвойствоЭлементаФормы(Форма.Элементы, "ХозяйственнаяОперация", "Видимость", Ложь); 
	//<< Портал-Юг, Баринов, 2019.08.26 [б/н Интефейс]
	ДобавитьПолеНаФорму("ПолеНадписи", Форма, "ПЛ_Номенклатура", "Список.Ссылка.ПЛ_Номенклатура", "Список", "Организация");
	//>> Портал-Юг, Баринов, 2019.08.26
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.14

//<<Портал-Юг, Давиденко 2019.02.20 [4.2.7 Нулевая цена и аналитика продаж в отчёте о розничных продажах и выпуске блюд]
Процедура докОтчетОРозничныхПродажахФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_Договор", "Объект.Товары.ПЛ_Договор", "Товары");
	//<<  Портал-Юг Гладкая 28.02.2020 (добавим на форму реквизит ПЛ_ЧекОбщепита)
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_ЧекОбщепита", "Объект.Товары.ПЛ_ЧекОбщепита", "Товары");
	//>>
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.20

//<<Портал-Юг, Каунов, 2019.03.04 [6.2.4 Настройки выгрузки в БП по организациям]
Процедура спрОрганизацииФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)

	// << MRS #ERP-5021 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 17.04.25, ()
	MRS_МОЛ_За_ТМЦ = ДобавитьПолеВводаНаФорму(Форма, "MRS_УчетныйВидЦены", "Объект.MRS_УчетныйВидЦены", "ГруппаОбщаяИнформация",);
	MRS_МОЛ_За_ТМЦ.МаксимальнаяШирина = 28;
	MRS_МОЛ_За_ТМЦ.АвтоМаксимальнаяШирина = Ложь;
	// >> MRS #ERP-5021 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 17.04.25, ()

КонецПроцедуры //>>Портал-Юг, Каунов, 2019.03.04	

//<<Портал-Юг, Каунов, 2019.03.04 [6.2.4 Настройки выгрузки в БП по организациям]
Процедура пвхСтатьиРасходовФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_НеВыгружатьВБП", "Объект.ПЛ_НеВыгружатьВБП", "ГруппаСтраницаРеглУчет"); 
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;	
КонецПроцедуры //>>Портал-Юг, Каунов, 2019.03.04

//<<Портал-Юг, Каунов, 2019.03.04 [6.2.4 Настройки выгрузки в БП по организациям]
Процедура спрГруппыФинансовогоУчетаНоменклатурыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	нЭлемент = ДобавитьПолеВводаНаФорму(Форма,"ПЛ_КлассификаторВыгрузкиВБП", "Объект.ПЛ_КлассификаторВыгрузкиВБП", "ГруппаШапкаГоризонтальная"); 
	нЭлемент.Заголовок = НСтр("ru = 'Классификация в БП (Портал)'");	
КонецПроцедуры //>>Портал-Юг, Каунов, 2019.03.04

//<< Портал-Юг Баринов 2019.03.12 [6.2.14 Дополнительные реквизиты в чеке общепита]
Процедура докпитДанныеПродажФронтаФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ЭлементыФормы = Форма.Элементы;
	
	// Шапка
	ДобавитьПолеНаФорму("ПолеВвода", Форма, "ПЛ_ФронтСистема", "Объект.ПЛ_ФронтСистема", "ГруппаШапкаЛевая");
	
	ГруппаДатаОткрытия = ЭлементыФормы.Добавить("ПЛ_ГруппаДатаОткрытия", Тип("ГруппаФормы"), ЭлементыФормы.ГруппаШапкаПравая);
	ГруппаДатаОткрытия.Вид = ВидГруппыФормы.ОбычнаяГруппа; 
	ГруппаДатаОткрытия.ОтображатьЗаголовок = Ложь;
	СуммаВключаетНДС = ЭлементыФормы.Найти("СуммаВключаетНДС");
	Если СуммаВключаетНДС <> Неопределено Тогда 
		ЭлементыФормы.Переместить(СуммаВключаетНДС, ГруппаДатаОткрытия);
	КонецЕсли;		
	ПЛ_ДатаОткрытияЧека = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_ДатаОткрытияЧека", "Объект.ПЛ_ДатаОткрытияЧека", "ПЛ_ГруппаДатаОткрытия");
	
	ГруппаКоды = ЭлементыФормы.Добавить("ПЛ_ГруппаКоды", Тип("ГруппаФормы"), ЭлементыФормы.ГруппаШапкаПравая);
	ГруппаКоды.Вид = ВидГруппыФормы.ОбычнаяГруппа;
	ГруппаКоды.ОтображатьЗаголовок = Ложь;
	ГруппаКоды.Группировка = ГруппировкаПодчиненныхЭлементовФормы.ГоризонтальнаяВсегда;
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_КодТочкиПродажи", "Объект.ПЛ_КодТочкиПродажи", "ПЛ_ГруппаКоды");
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_КодСотрудника", "Объект.ПЛ_КодСотрудника", "ПЛ_ГруппаКоды");
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_КодКарточки", "Объект.ПЛ_КодКарточки", "ПЛ_ГруппаКоды");
	
	//>>Швецов. 05.03.2025. Признак фискализации на форме
	ДобавитьПолеВводаНаФорму(Форма, "MRS_Фискализирован", "Объект.MRS_Фискализирован", "ПЛ_ГруппаКоды");
	//>>Швецов. 05.03.2025
	
	//>> Швецов. ERP-5406. 23.09.25 Номер позиции в чеке из фронта
	ДобавитьПолеВводаНаФорму(Форма, "MRS_ПозицияВЧеке", "Объект.Товары.MRS_ПозицияВЧеке", "Товары");
	//<< 
	
	// Товары
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_КодКнопки", "Объект.Товары.ПЛ_КодКнопки", "Товары");
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_НаименованиеКнопки", "Объект.Товары.ПЛ_НаименованиеКнопки", "Товары");
	
	ДобавитьСтраницуMRS_УчетАлкоголя(Форма);
	
КонецПроцедуры //>> Портал-Юг Баринов 2019.03.12

// Добавляет страницу с табличной частью MRS_УчетАлкоголя на форму Чек общепита
// на странице марки из чеков с.вина
//
// Параметры:
//   Форма - ФормаКлиентскогоПриложения - Форма Чек общепита
//
Процедура ДобавитьСтраницуMRS_УчетАлкоголя(Форма)
	
	ТипПоля = Тип("ПолеФормы");
	
	// Создаем новую страницу
	НоваяСтраница = Форма.Элементы.Добавить("MRS_СтраницаУчетАлкоголяВЧеках", Тип("ГруппаФормы"), Форма.Элементы.ГруппаСтраницы); 
	НоваяСтраница.Вид = ВидГруппыФормы.Страница;
	НоваяСтраница.Заголовок = "Учет Алкоголя в чеках (mrs)";
	НоваяСтраница.Подсказка = "Учет Алкоголя в чеках (mrs)";
	
	// Создаем декорацию с пояснением
	Декорация = Форма.Элементы.Добавить("MRS_ДекорацияУчетАлкоголя", Тип("ДекорацияФормы"), НоваяСтраница);
	Декорация.Вид = ВидДекорацииФормы.Надпись;
	Декорация.АвтоМаксимальнаяШирина = Ложь;
	Декорация.ЦветТекста = WebЦвета.ЗеленыйЛес;
	Декорация.Заголовок = "Марки из чеков в диапазоне";
	
	// Создаем таблицу MRS_УчетАлкоголя
	ТаблицаMRS_УчетАлкоголя = Форма.Элементы.Добавить("MRS_УчетАлкоголя", Тип("ТаблицаФормы"), НоваяСтраница);
	ТаблицаMRS_УчетАлкоголя.ПутьКДанным = "Объект.MRS_УчетАлкоголя";
	
	// Добавляем колонки
	КолонкаНомерСтрокиОсновнойПозиции = Форма.Элементы.Добавить("MRS_УчетАлкоголя_НомерСтрокиОсновнойПозиции", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаНомерСтрокиОсновнойПозиции.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаНомерСтрокиОсновнойПозиции.ПутьКДанным = "Объект.MRS_УчетАлкоголя.НомерСтрокиОсновнойПозиции";
	КолонкаНомерСтрокиОсновнойПозиции.Заголовок = "Номер Строки Основной Позиции (mrs)";
	КолонкаНомерСтрокиОсновнойПозиции.Подсказка = "Номер Строки Основной Позиции (mrs)";
	
	КолонкаНоменклатура = Форма.Элементы.Добавить("MRS_УчетАлкоголя_Номенклатура", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаНоменклатура.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаНоменклатура.ПутьКДанным = "Объект.MRS_УчетАлкоголя.Номенклатура";
	КолонкаНоменклатура.Заголовок = "Номенклатура (mrs)";
	КолонкаНоменклатура.Подсказка = "Номенклатура (mrs)";
	
	КолонкаКоличество = Форма.Элементы.Добавить("MRS_УчетАлкоголя_Количество", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаКоличество.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаКоличество.ПутьКДанным = "Объект.MRS_УчетАлкоголя.Количество";
	КолонкаКоличество.Заголовок = "Количество (mrs)";
	КолонкаКоличество.Подсказка = "Количество (mrs)";
	
	КолонкаЕдиницаИзмерения = Форма.Элементы.Добавить("MRS_УчетАлкоголя_ЕдиницаИзмерения", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаЕдиницаИзмерения.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаЕдиницаИзмерения.ПутьКДанным = "Объект.MRS_УчетАлкоголя.ЕдиницаИзмерения";
	КолонкаЕдиницаИзмерения.Заголовок = "Единица Измерения (mrs)";
	КолонкаЕдиницаИзмерения.Подсказка = "Единица Измерения (mrs)";
	
	КолонкаКодАкциза = Форма.Элементы.Добавить("MRS_УчетАлкоголя_КодАкциза", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаКодАкциза.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаКодАкциза.ПутьКДанным = "Объект.MRS_УчетАлкоголя.КодАкциза";
	КолонкаКодАкциза.Заголовок = "Код Акциза (mrs)";
	КолонкаКодАкциза.Подсказка = "Код Акциза (mrs)";
	
	КолонкаШтрихкодУпаковки = Форма.Элементы.Добавить("MRS_УчетАлкоголя_ШтрихкодУпаковки", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаШтрихкодУпаковки.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаШтрихкодУпаковки.ПутьКДанным = "Объект.MRS_УчетАлкоголя.ШтрихкодУпаковки";
	КолонкаШтрихкодУпаковки.Заголовок = "Штрихкод Упаковки (mrs)";
	КолонкаШтрихкодУпаковки.Подсказка = "Штрихкод Упаковки (mrs)"; 
	
	КолонкаАлкогольнаяПродукция = Форма.Элементы.Добавить("MRS_УчетАлкоголя_АлкогольнаяПродукция", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаАлкогольнаяПродукция.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаАлкогольнаяПродукция.ПутьКДанным = "Объект.MRS_УчетАлкоголя.АлкогольнаяПродукция";
	КолонкаАлкогольнаяПродукция.Заголовок = "Алкогольная Продукция (mrs)";
	КолонкаАлкогольнаяПродукция.Подсказка = "Алкогольная Продукция (mrs)";
	
	КолонкаКоличествоВМЛ = Форма.Элементы.Добавить("MRS_УчетАлкоголя_КоличествоВМЛ", ТипПоля, ТаблицаMRS_УчетАлкоголя);
	КолонкаКоличествоВМЛ.Вид = ВидПоляФормы.ПолеВвода;
	КолонкаКоличествоВМЛ.ПутьКДанным = "Объект.MRS_УчетАлкоголя.КоличествоВМЛ";
	КолонкаКоличествоВМЛ.Заголовок = "КоличествоВМЛ (mrs)";
	КолонкаКоличествоВМЛ.Подсказка = "КоличествоВМЛ (mrs)";
	
КонецПроцедуры

//<<Портал-Юг, Давиденко 2019.03.31 [5.2.5 Связь серии и упаковки]
Процедура спрСерииНоменклатурыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Упаковка", "Объект.ПЛ_Упаковка", "ГруппаШапка");
	
	ВедутсяУпаковки = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Форма.Объект.ВидНоменклатуры, "ПЛ_Упаковка");
	
	Форма.Элементы.ПЛ_Упаковка.Видимость = ВедутсяУпаковки;
	Форма.Элементы.ПЛ_Упаковка.ТолькоПросмотр = Истина;
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.03.31

//<<Портал-Юг, Давиденко 2019.03.31 [5.2.5 Связь серии и упаковки]
Процедура спрВидыНоменклатурыФормаНастройкаСоставаРеквизитовСерииПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	ДобавитьРеквизитНаФорму(Форма, "ПЛ_Упаковка", Новый ОписаниеТипов("Булево"),, НСтр("ru = 'Упаковка (Портал)'"), Истина); 
	
	ПолеПЛ_Упаковка = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Упаковка", "ПЛ_Упаковка", "ИспользуемыеРеквизитыСерий");
	ПолеПЛ_Упаковка.Вид = ВидПоляФормы.ПолеФлажка;
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.03.31

//<< Портал-Юг Баринов 2019.02.08 [Общие метаданные] 
// Пример вставки
Процедура спрНоменклатураФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	//<< Портал-Юг, Свинцов И.И., 2019.02.11 [5.2.26 Сопоставление вскрытой и не вскрытой номенклатуры алкогольной продукции]  	
	//нЭлемент = ДобавитьПолеВводаНаФорму(Форма, "ИмяПоля", "РодительскийЭлемент",, "Объект.ИмяРеквизита"); 
	нЭлемент = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_НоменклатураВоВскрытойТаре", "Объект.ПЛ_НоменклатураВоВскрытойТаре", "СворачиваемаяГруппаАлкоголь", "ВидАлкогольнойПродукции"); 
	//<< Портал-Юг, Гребенюк В.В., 2023.05.29 [Обновление 2.5, поменяли имя группы]
	//нЭлемент.Видимость = Элементы.ГруппаЗаголовокАлкоголь.Видимость;
	нЭлемент.Видимость = Элементы.СворачиваемаяГруппаАлкоголь.Видимость;
	//>> Портал-Юг, Гребенюк В.В., 2023.05.29
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ИспользуетсяВЗаказах", "Объект.ПЛ_ИспользуетсяВЗаказах", "СворачиваемаяГруппаАлкоголь", "ВидАлкогольнойПродукции");
	//<< Портал-Юг, Гребенюк В.В., 2023.05.29 [Обновление 2.5, поменяли имя группы]
	//нЭлемент.Видимость = Элементы.ГруппаЗаголовокАлкоголь.Видимость;
	нЭлемент.Видимость = Элементы.СворачиваемаяГруппаАлкоголь.Видимость;
	//>> Портал-Юг, Гребенюк В.В., 2023.05.29
	
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
	//>> Портал-Юг, Свинцов И.И. 2019.02.11
	
	//<<===ПорталЮгКрым, Плотникова Н.Ю. 31.03.2021 [SD39851]   
	Если НЕ Форма.Параметры.Ключ.Пустая() и РольДоступна("ПЛ_ЗапретРедактированияНаименованийНоменклатуры") Тогда
	    Форма.Элементы.ГруппаНаименование.Доступность = Ложь;
	КонецЕсли; 
    //>>===ПорталЮгКрым === Плотникова Н.Ю. 31.03.2021  
	
КонецПроцедуры //>> Портал-Юг Баринов 2019.02.08

//<<Портал-Юг, Каунов, 2019.02.15 [6.2.3 Правила регистрации справочников в ERP]
Процедура поСинхронизацияДанныхЧерезУФФормаУзлаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ОбменСБПКорп", "Объект.ПЛ_ОбменСБПКорп", "ГруппаСоставПрочихНастроек", "ГруппаОтправлятьВидыЦенНоменклатуры"); 
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;

КонецПроцедуры //>>Портал-Юг, Каунов, 2019.02.15	

//<< Портал-Юг, Свинцов И.И., 2019.02.27 [5.2.31 Инвентаризация алкогольной продукции]
Процедура докПитИнвентаризацияТоваровФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	//<< ПорталЮгКрым Плотникова Н.Ю. 22.01.2020 Inv#50 
	мНашаКоманда=Форма.Команды.Добавить("ПЛ_ДобавитьОтсутствующиеТовары");
	мНашаКоманда.Действие="ПЛ_ДобавитьОтсутствующиеТовары";
	мКнопка=Форма.Элементы.Добавить("Товары_ПЛ_ДобавитьОтсутствующиеТовары",Тип("КнопкаФормы"),Форма.Элементы.КоманднаяПанельТовары);
	мКнопка.Заголовок="Дозаполнить товарами, имеющ.на остатке";
	мКнопка.ИмяКоманды="ПЛ_ДобавитьОтсутствующиеТовары";
	//>> ПорталЮгКрым Плотникова Н.Ю. 22.01.2020 Inv#50 
	
	//<< ПорталЮгКрым Плотникова Н.Ю. 23.01.2020 Inv#49 
	мНашаКоманда=Форма.Команды.Добавить("ПЛ_ДобавитьТоварыCОтрицОстатками");
	мНашаКоманда.Действие="ПЛ_ДобавитьТоварыCОтрицОстатками";
	мКнопка=Форма.Элементы.Добавить("Товары_ПЛ_ДобавитьТоварыCОтрицОстатками",Тип("КнопкаФормы"),Форма.Элементы.КоманднаяПанельТовары);
	мКнопка.Заголовок="Дозаполнить товарами, имеющ.отриц.остатки";
	мКнопка.ИмяКоманды="ПЛ_ДобавитьТоварыCОтрицОстатками";
	//>> ПорталЮгКрым Плотникова Н.Ю. 23.01.2020 Inv#49 
	
	//<< Портал-Юг, Свинцов И.И., 2019.03.21 [5.3.6 Чтение и изменение данных инвентаризации товаров]
	Если ПЛ_Сервер.ОграничениеНаПитИнвентаризацияТоваров() Тогда
		
		//<< Портал-Юг, Свинцов И.И., 2019.03.19 [5.3.7 Инвентаризация товаров сканером] 
		
		Элементы.Полуфабрикаты.Видимость = Ложь;
		Элементы.ГруппаПолуфабрикаты.Видимость = Ложь;
		
		Элементы.ГруппаТоварыШапка.Доступность = Ложь;
		Элементы.ГруппаТоварыШапка.Видимость = Ложь;
	
		Элементы.ТоварыКоличествоУпаковокИзПолуфабрикатов.Видимость = Ложь;
		Элементы.ТоварыНазначение.Видимость = Ложь;
		
		Элементы.ТоварыКоличествоУпаковокОтклонение.Видимость = Ложь;
		Элементы.ТоварыКоличествоУпаковок.Видимость = Ложь;
		
		// Добавим реквизит формы
		ДобавитьРеквизитНаФорму(Форма, "ПЛ_ТолькоДобавлениеИнвентаризацийТоваров", "Булево");
		Форма.ПЛ_ТолькоДобавлениеИнвентаризацийТоваров = Истина;
		
		//<< Портал-Юг, Свинцов И.И., 2019.10.29 [5.3.7 Инвентаризация товаров сканером] 
		Элементы.Товары.УстановитьДействие("ПередНачаломДобавления", "ТоварыПередНачаломДобавления");
		Элементы.Товары.УстановитьДействие("ПередНачаломИзменения", "ТоварыПередНачаломИзменения");
		
		Элементы.ОтборПересчетаНастройкиОтбор.Видимость = Ложь;
		ЭлементДекорация = Элементы.Добавить("ПЛ_НадписьСканер", Тип("ДекорацияФормы"), Элементы.УсловияПересчетаТоваров);
		ЭлементДекорация.Видимость = Ложь;
		ЭлементДекорация.АвтоМаксимальнаяШирина = Ложь;
		ЭлементДекорация.ГоризонтальноеПоложение = ГоризонтальноеПоложениеЭлемента.Центр;
		ЭлементДекорация.РастягиватьПоГоризонтали = Истина;
		ЭлементДекорация.Вид = ВидДекорацииФормы.Надпись;
		//>> Портал-Юг, Свинцов И.И., 2019.10.29
		 
		
	КонецЕсли;
	//>> Портал-Юг, Свинцов И.И., 2019.03.21

	// Кнопка "ПЛ_ДобавитьИзДокумента", добавим в командную панель
	ЗаголовокКнопка= НСтр("ru = 'Добавить из документа'");
	ЭлементКнопка = ДобавитьКнопкуНаФорму(Форма, "ПЛ_ДобавитьИзДокумента", "ПЛ_ДобавитьИзДокумента", ЗаголовокКнопка, "КоманднаяПанельТовары"); 
	
	//<< Портал-Юг, Свинцов И.И., 2019.05.01 [7.2.9 Создание серий в инвентаризации для алкогольной продукции] 
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_НачальныеОстаткиАлкогольнойПродукции", "Объект.ПЛ_НачальныеОстаткиАлкогольнойПродукции", "ШапкаПраво");
	//>> Портал-Юг, Свинцов И.И., 2019.05.01
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.02.27
 
//<< Портал-Юг, Свинцов И.И., 2019.03.01 [5.2.29 Автоматическая генерация серий и заполнение документа «Приобретение товаров и услуг»] 
Процедура докТТНВходящаяЕГАИСФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	Элементы.ТоварыСерия.АвтоОтметкаНезаполненного = Ложь;
	
	//<< Портал-Юг, Свинцов И.И., 2019.03.22 [5.3.5 Подтверждение ТТН ЕГАИС] 
	Если НЕ УправлениеДоступом.ЕстьРоль("ПЛ_ПодтверждениеТТНЕГАИС") Тогда
		Если Форма.СтатусЕГАИС <> Перечисления.СтатусыОбработкиТТНВходящейЕГАИС.ПринятИзЕГАИС Тогда
			Форма.ТолькоПросмотр = Истина;
		КонецЕсли;	
	КонецЕсли;
	//>> Портал-Юг, Свинцов И.И., 2019.03.22
	 
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.03.01

//<<Портал-Юг, Давиденко 2019.03.12 [6.2.10 Отражение производства услуг по СКЛ]
Процедура докПроизводствоБезЗаказаФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)

	ТаблицаВыходныеИзделияКолонка = Форма.Элементы.Добавить("ПЛ_ГруппаФинансовогоУчетаНоменклатуры_ВИ", Тип("ПолеФормы"), Форма.Элементы.ВыходныеИзделия);
	ТаблицаВыходныеИзделияКолонка.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаВыходныеИзделияКолонка.ПутьКДанным = "Объект.ВыходныеИзделия.ПЛ_ГруппаФинансовогоУчетаНоменклатуры";
	
	ТаблицаМатериалыИРаботыКолонка = Форма.Элементы.Добавить("ПЛ_ГруппаФинансовогоУчетаНоменклатуры_МР", Тип("ПолеФормы"), Форма.Элементы.МатериалыИРаботы);
	ТаблицаМатериалыИРаботыКолонка.Вид = ВидПоляФормы.ПолеВвода;
	ТаблицаМатериалыИРаботыКолонка.ПутьКДанным = "Объект.МатериалыИРаботы.ПЛ_ГруппаФинансовогоУчетаНоменклатуры";
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.03.12

//<< Портал-Юг, Баринов, 2019.04.10 [5.2.6 Автозаполнение упаковок по серии в документах]
Процедура докПеремещениеТоваровФормаДокументаПередЗаписьюНаСервере(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	ПЛ_Сервер.ЗаполнитьСерииПоУпаковкам(ТекущийОбъект, Отказ, Форма.ПараметрыУказанияСерий);
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.04.10

//<< Портал-Юг, Баринов, 2019.08.29 [б/н Сверка с оригиналом приобретения товаров]
Процедура докПриобретениеТоваровУслугФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	
	Заголовок = НСтр("ru = 'Сверить с оригиналом'");
	ДобавитьКнопкуНаФорму(Форма, "ПЛ_СверитьСОригиналом", "Подключаемый_СверитьСОригиналом", Заголовок, "ГруппаТоварыПодобратьТовары", "ТоварыПроверитьКоличествоВДокументе", "КнопкаКоманднойПанели");
	Команда = Форма.Команды["Подключаемый_СверитьСОригиналом"];
	Команда.Подсказка = Заголовок;
	Команда.Отображение = ОтображениеКнопки.Картинка;
	Команда.Картинка = БиблиотекаКартинок.ПоказатьОтличия;
	// << MRS #ERP-4945 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 18.02.25, ()
	стрРеквизитовТЧ = Новый Структура;
	стрРеквизитовТЧ.Вставить("ТоварыЦенаУст",ОписаниеТипаЧисло(15,2));
	СоздатьРеквизитыТаблицы(Форма,"Объект.Товары",стрРеквизитовТЧ);
	
	ТаблицаТовары = Форма.Элементы.Товары;
	НовыйРеквизит = Форма.Элементы.Вставить("ТоварыЦенаУст", Тип("ПолеФормы"), ТаблицаТовары, Форма.Элементы.ТоварыЦенаЗаказа);
	НовыйРеквизит.Заголовок = "Уст. Цена";
	НовыйРеквизит.Вид = ВидПоляФормы.ПолеВвода;
	НовыйРеквизит.ПутьКДанным = "Объект.Товары.ТоварыЦенаУст";
	//Форма.Объект.Товары
	Если Форма.Объект.Товары.Количество() Тогда
		Если ЗначениеЗаполнено(Форма.Объект.Склад) Тогда
			ВидЦены = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Форма.Объект.Склад, "УчетныйВидЦены");
		КонецЕсли;
		Если НЕ ЗначениеЗаполнено(ВидЦены) Тогда // На случай, если не смогли получить
			ВидЦены = MRS_СлужебныеПараметрыПовтИсп.ПолучитьЗначение("ВидЦеныАвтоУстанвкиЦен", "Значение");
		КонецЕсли;
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЦеныНоменклатурыСрезПоследних.Номенклатура КАК Номенклатура,
		|	ЦеныНоменклатурыСрезПоследних.Цена КАК Цена
		|ИЗ
		|	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
		|			&ПериодДокумента,
		|			Номенклатура В (&Номенклатура)
		|				И ВидЦены = &ВидЦены) КАК ЦеныНоменклатурыСрезПоследних";
		ТЗ = Форма.Объект.Товары.Выгрузить();
		Номенклатура = ТЗ.ВыгрузитьКолонку("Номенклатура");
		Запрос.УстановитьПараметр("ВидЦены", ВидЦены);
		Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
		Запрос.УстановитьПараметр("ПериодДокумента", Форма.Объект.Дата);
		
		ТабЦен = Запрос.Выполнить().Выгрузить();
		Если ТабЦен.Количество() Тогда
			Для Каждого Строка ИЗ Форма.Объект.Товары Цикл
				НайденнаяСтрока = ТабЦен.Найти(Строка.Номенклатура, "Номенклатура");
				Если НЕ НайденнаяСтрока = Неопределено Тогда
					Строка.ТоварыЦенаУст = НайденнаяСтрока.Цена;
				КонецЕсли;
			КонецЦикла;
			ЭлементУсловногоОформления = Форма.УсловноеОформление.Элементы.Добавить();
			ОформляемоеПоле = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
			ОформляемоеПоле.Поле = Новый ПолеКомпоновкиДанных("ТоварыЦенаУст");
			ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных(НовыйРеквизит.ПутьКДанным);
			ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Меньше;
			ЭлементОтбора.ПравоеЗначение = Новый ПолеКомпоновкиДанных(Форма.Элементы.ТоварыЦена.ПутьКДанным);
			ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", WebЦвета.Красный);
			
			ЭлементУсловногоОформления = Форма.УсловноеОформление.Элементы.Добавить();
			ОформляемоеПоле = ЭлементУсловногоОформления.Поля.Элементы.Добавить();
			ОформляемоеПоле.Поле = Новый ПолеКомпоновкиДанных("ТоварыЦенаУст");
			ЭлементОтбора = ЭлементУсловногоОформления.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных(НовыйРеквизит.ПутьКДанным);
			ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.БольшеИлиРавно;
			ЭлементОтбора.ПравоеЗначение = Новый ПолеКомпоновкиДанных(Форма.Элементы.ТоварыЦена.ПутьКДанным);
			ЭлементУсловногоОформления.Оформление.УстановитьЗначениеПараметра("ЦветТекста", WebЦвета.Зеленый);
		КонецЕсли;
	КонецЕсли;
	// >> MRS #ERP-4945 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 18.02.25, ()
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.29


//<< Портал-Юг, Баринов, 2019.04.10 [5.2.6 Автозаполнение упаковок по серии в документах]
Процедура докПриобретениеТоваровУслугФормаДокументаПередЗаписьюНаСервере(Форма, Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	ПЛ_Сервер.ЗаполнитьСерииПоУпаковкам(ТекущийОбъект, Отказ, Форма.ПараметрыУказанияСерий);
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.04.10

//<< Портал-Юг Баринов 2019.02.26 [6.2.13 Регистр сведений «Соответствие с Front-системами»]
Процедура рсРезультатыОбменаДаннымиФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Элементы = Форма.Элементы;
	
	ДобавитьРеквизитНаФорму(Форма, "ПЛ_СоответствияСФронтСистемами", "ДинамическийСписок");
	ДинамическийСписок = Форма.ПЛ_СоответствияСФронтСистемами;
	ДинамическийСписок.ОсновнаяТаблица = "РегистрСведений.ПЛ_СоответствиеСФронтСистемами";
	ДинамическийСписок.ДинамическоеСчитываниеДанных = Истина;
	ДинамическийСписок.АвтоматическоеСохранениеПользовательскихНастроек = Истина;
		
	// Страница
	Страница = Элементы.Добавить("ПЛ_СтраницаСоответствиеСФронтСистемами", Тип("ГруппаФормы"), Элементы.РезультатыОбменаДанными);
	Страница.Заголовок = НСтр("ru = 'Соответствие с фронт-системами (Портал)'");
	Страница.Вид = ВидГруппыФормы.Страница;
	
	// Пользовательские настройки
	ГруппаПользовательскиеНастройки = Элементы.Добавить("ПЛ_СтраницаСоответствиеГруппаПользовательскиеНастройки", Тип("ГруппаФормы"), Страница);
	ГруппаПользовательскиеНастройки.Вид = ВидГруппыФормы.ОбычнаяГруппа;
	ГруппаПользовательскиеНастройки.ОтображатьЗаголовок = Ложь;
		
	// Таблица
	Таблица = Элементы.Добавить("ПЛ_СоответствиеСФронтСистемами", Тип("ТаблицаФормы"), Страница);
	Таблица.ПутьКДанным = "ПЛ_СоответствияСФронтСистемами";
	Таблица.СоздатьЭлементыФормыПользовательскихНастроек(ГруппаПользовательскиеНастройки);
		
	МетаданныеРегистра = Метаданные.РегистрыСведений.ПЛ_СоответствиеСФронтСистемами;
	Поля = Новый Массив;
	Для каждого Поле Из МетаданныеРегистра.Измерения Цикл
		Поля.Добавить(Поле);
	КонецЦикла; 
	Для каждого Поле Из МетаданныеРегистра.Ресурсы Цикл
		Поля.Добавить(Поле);
	КонецЦикла; 
	Для каждого Поле Из МетаданныеРегистра.Реквизиты Цикл
		Поля.Добавить(Поле);
	КонецЦикла; 
	
	Для каждого Поле Из Поля Цикл
		ДобавитьПолеНадписиНаФорму(Форма, "ПЛ_Соответствия" + Поле.Имя, "ПЛ_СоответствияСФронтСистемами." + Поле.Имя, "ПЛ_СоответствиеСФронтСистемами");
	КонецЦикла; 
	
	//<< Портал-Юг, Баринов, 2019.04.03 [6.2.23 Функционал установки ссылочных типов в местах где указан код]
	ЗаголовокКнопки = НСтр("ru = 'Заполнить данные по соответствию'");
	ДобавитьКнопкуНаФорму(Форма, "ПЛ_ЗаполнитьПоСоответствию", "ПодключаемыйПЛ_ЗаполнитьПоСоответствию", ЗаголовокКнопки, "ПЛ_СоответствиеСФронтСистемамиКоманднаяПанель");
	//>> Портал-Юг, Баринов, 2019.04.03
	
КонецПроцедуры //>> Портал-Юг Баринов 2019.02.26

//<< Портал-Юг, Баринов, 2019.05.20 [6.2.13 Регистр сведений «Соответствие с Front-системами»]
Процедура рсРезультатыОбменаДаннымиФормаСпискаПриЗагрузкеДанныхИзНастроекНаСервере(Форма, Настройки)

	// Предопределённый отбор
	ПользовательскиеНастройки = Форма.ПЛ_СоответствияСФронтСистемами.КомпоновщикНастроек.ПользовательскиеНастройки;
	Отбор = Неопределено;
	Для каждого Отбор Из ПользовательскиеНастройки.Элементы Цикл
		Если ТипЗнч(Отбор) = Тип("ОтборКомпоновкиДанных") Тогда 
			Прервать;
		КонецЕсли;	
	КонецЦикла;
	
	ПредставлениеГруппы = НСтр("ru = 'Не сопоставленные'");
	Если ТипЗнч(Отбор) = Тип("ОтборКомпоновкиДанных") И ОбщегоНазначенияКлиентСервер.НайтиЭлементыИГруппыОтбора(Отбор,, ПредставлениеГруппы).Количество() = 0 Тогда
		ГруппаОтбора = ОбщегоНазначенияКлиентСервер.СоздатьГруппуЭлементовОтбора(Отбор.Элементы, ПредставлениеГруппы, ТипГруппыЭлементовОтбораКомпоновкиДанных.ГруппаИ);
		ГруппаОтбора.РежимОтображения = РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Обычный;
		ГруппаОтбора.ИдентификаторПользовательскойНастройки = "ПЛ_ГруппаНеСопоставленные";
		ГруппаОтбора.ПредставлениеПользовательскойНастройки = ПредставлениеГруппы;
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(ГруппаОтбора, "Объект",, ВидСравненияКомпоновкиДанных.НеЗаполнено);
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(ГруппаОтбора, "НеВлияетНаУчетТМЦ", Ложь);
	КонецЕсли;
		
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.05.20

//<< Портал-Юг, Свинцов И.И., 2019.03.19 [5.2.1 Автоматическое создание документа «перемещение товаров» на основании документа поступления]  
Процедура докПриобретениеТоваровУслугПослеЗаписиНаСервере(Форма, ТекущийОбъект, ПараметрыЗаписи)
	
	Если НЕ ТекущийОбъект.Проведен Тогда
		Возврат;
	КонецЕсли;	
	
	// Проверим, запускался ли механизм автоматического создания перемещений ранее
	ДопСвойство = ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоРеквизиту("Имя", "ПЛ_ПеремещенияСформированыАвтоматически"); 
	Если НЕ ЗначениеЗаполнено(ДопСвойство) Тогда
		ТекстСообщения = НСтр("ru='Для документа не определено дополнительное сведение ""Перемещения сформированы автоматически"". Обработка формирования перемещений запущена не будет.'");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, ТекущийОбъект.Ссылка); 
		Возврат;
	Иначе
		Если УправлениеСвойствами.ЗначениеСвойства(ТекущийОбъект.Ссылка, ДопСвойство) = Истина Тогда 	
			Возврат;
		КонецЕсли;	
	КонецЕсли;	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ПриобретениеТоваровУслугТовары.Номенклатура КАК Номенклатура,
	|	ПриобретениеТоваровУслугТовары.Количество КАК Количество,
	|	ПриобретениеТоваровУслугТовары.КодСтроки КАК КодСтроки,
	|	ЗаказПоставщикуТовары.Номенклатура КАК НоменклатураЗаказа,
	|	ВЫБОР
	|		КОГДА ПриобретениеТоваровУслугТовары.Номенклатура = ЗаказПоставщикуТовары.Номенклатура
	|			ТОГДА 1
	|		ИНАЧЕ ПриобретениеТоваровУслугТовары.Номенклатура.ОбъемДАЛ * 10
	|	КОНЕЦ КАК КоэфПересчета,
	|	ВЫБОР
	|		КОГДА ЗаказПоставщикуТовары.ПЛ_Заказ ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ТИПЗНАЧЕНИЯ(ЗаказПоставщикуТовары.Ссылка.ДокументОснование) = ТИП(Документ.ЗаказПоставщику)
	|						ТОГДА ЗаказПоставщикуТовары.Ссылка.ДокументОснование
	|					ИНАЧЕ ЗНАЧЕНИЕ(Документ.ЗаказНаПеремещение.ПустаяСсылка)
	|				КОНЕЦ
	|		ИНАЧЕ ЗаказПоставщикуТовары.ПЛ_Заказ
	|	КОНЕЦ КАК ЗаказНаПеремещение,
	|	ПриобретениеТоваровУслугТовары.Характеристика КАК Характеристика,
	|	ПриобретениеТоваровУслугТовары.Назначение КАК Назначение
	|ПОМЕСТИТЬ ВТ_ПриобретениеТиУ
	|ИЗ
	|	Документ.ПриобретениеТоваровУслуг.Товары КАК ПриобретениеТоваровУслугТовары
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ЗаказПоставщикуТовары
	|		ПО ПриобретениеТоваровУслугТовары.КодСтроки = ЗаказПоставщикуТовары.КодСтроки
	|			И ПриобретениеТоваровУслугТовары.ЗаказПоставщику = ЗаказПоставщикуТовары.Ссылка
	|ГДЕ
	|	ПриобретениеТоваровУслугТовары.Ссылка = &Ссылка
	|	И ПриобретениеТоваровУслугТовары.КодСтроки <> 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(ВТ_ПриобретениеТиУ.Количество * ВТ_ПриобретениеТиУ.КоэфПересчета) КАК Количество,
	|	ВТ_ПриобретениеТиУ.НоменклатураЗаказа КАК НоменклатураЗаказа,
	|	ВТ_ПриобретениеТиУ.Назначение КАК Назначение,
	|	ВТ_ПриобретениеТиУ.Характеристика КАК Характеристика,
	|	ВТ_ПриобретениеТиУ.Номенклатура КАК Номенклатура,
	|	МАКСИМУМ(ВТ_ПриобретениеТиУ.КоэфПересчета) КАК КоэфПересчета
	|ПОМЕСТИТЬ ВТ_ТоварыКОтгрузке
	|ИЗ
	|	ВТ_ПриобретениеТиУ КАК ВТ_ПриобретениеТиУ
	|ГДЕ
	|	ВТ_ПриобретениеТиУ.ЗаказНаПеремещение <> ЗНАЧЕНИЕ(Документ.ЗаказНаПеремещение.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ПриобретениеТиУ.Назначение,
	|	ВТ_ПриобретениеТиУ.Характеристика,
	|	ВТ_ПриобретениеТиУ.Номенклатура,
	|	ВТ_ПриобретениеТиУ.НоменклатураЗаказа
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗаказыНаПеремещениеОстатки.Номенклатура КАК Номенклатура,
	|	ЗаказыНаПеремещениеОстатки.Характеристика КАК Характеристика,
	|	ЗаказыНаПеремещениеОстатки.КодСтроки КАК КодСтроки,
	|	ЗаказыНаПеремещениеОстатки.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|	ЗаказыНаПеремещениеОстатки.ЗаказаноОстаток КАК ЗаказаноОстаток,
	|	ЗаказыНаПеремещениеОстатки.КОформлениюОстаток КАК КОформлениюОстаток
	|ПОМЕСТИТЬ ВТ_ЗаказыНаПеремещение
	|ИЗ
	|	РегистрНакопления.ЗаказыНаПеремещение.Остатки(
	|			,
	|			ЗаказНаПеремещение В
	|					(ВЫБРАТЬ
	|						ВТ_ПриобретениеТиУ.ЗаказНаПеремещение КАК ЗаказНаПеремещение
	|					ИЗ
	|						ВТ_ПриобретениеТиУ КАК ВТ_ПриобретениеТиУ)
	|				И Номенклатура В
	|					(ВЫБРАТЬ
	|						ВТ_ТоварыКОтгрузке.НоменклатураЗаказа КАК НоменклатураЗаказа
	|					ИЗ
	|						ВТ_ТоварыКОтгрузке КАК ВТ_ТоварыКОтгрузке)) КАК ЗаказыНаПеремещениеОстатки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ТоварыКОтгрузке.НоменклатураЗаказа КАК НоменклатураЗаказа,
	|	ВТ_ТоварыКОтгрузке.Назначение КАК Назначение,
	|	ВТ_ТоварыКОтгрузке.Характеристика КАК Характеристика,
	|	ВТ_ТоварыКОтгрузке.Номенклатура КАК Номенклатура,
	|	ВТ_ТоварыКОтгрузке.Количество КАК Количество,
	|	ВТ_ТоварыКОтгрузке.КоэфПересчета КАК КоэфПересчета
	|ИЗ
	|	ВТ_ТоварыКОтгрузке КАК ВТ_ТоварыКОтгрузке
	|ИТОГИ
	|	СУММА(Количество)
	|ПО
	|	НоменклатураЗаказа,
	|	Характеристика,
	|	Назначение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ЗаказыНаПеремещение.Номенклатура КАК Номенклатура,
	|	ВТ_ЗаказыНаПеремещение.Характеристика КАК Характеристика,
	|	ВТ_ЗаказыНаПеремещение.КодСтроки КАК КодСтроки,
	|	ВТ_ЗаказыНаПеремещение.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|	ВТ_ЗаказыНаПеремещение.ЗаказаноОстаток КАК Количество,
	|	ЗаказНаПеремещениеТовары.НомерСтроки КАК НомерСтроки,
	|	ИСТИНА КАК Использовать,
	|	ЗаказНаПеремещениеТовары.Ссылка.СкладПолучатель КАК СкладПолучатель
	|ИЗ
	|	ВТ_ЗаказыНаПеремещение КАК ВТ_ЗаказыНаПеремещение
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение.Товары КАК ЗаказНаПеремещениеТовары
	|		ПО ВТ_ЗаказыНаПеремещение.ЗаказНаПеремещение = ЗаказНаПеремещениеТовары.Ссылка
	|			И ВТ_ЗаказыНаПеремещение.КодСтроки = ЗаказНаПеремещениеТовары.КодСтроки
	|
	|УПОРЯДОЧИТЬ ПО
	|	ЗаказНаПеремещениеТовары.Ссылка.Дата,
	|	ЗаказНаПеремещениеТовары.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ПриобретениеТоваровУслугСерии.Номенклатура КАК Номенклатура,
	|	ПриобретениеТоваровУслугСерии.Характеристика КАК Характеристика,
	|	ПриобретениеТоваровУслугСерии.Назначение КАК НазначениеОтправителя,
	|	СУММА(-ПриобретениеТоваровУслугСерии.Количество) КАК Количество
	|ИЗ
	|	Документ.ПриобретениеТоваровУслуг.Серии КАК ПриобретениеТоваровУслугСерии
	|ГДЕ
	|	ПриобретениеТоваровУслугСерии.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	ПриобретениеТоваровУслугСерии.Номенклатура,
	|	ПриобретениеТоваровУслугСерии.Характеристика,
	|	ПриобретениеТоваровУслугСерии.Назначение";
	
	МассивПеремещений = Новый Массив;
	СтруктураПересчетаСуммы = ОбработкаТабличнойЧастиКлиентСервер.ПараметрыПересчетаСуммыНДСВСтрокеТЧ(ТекущийОбъект);
	
	СтруктураДействий = Новый Структура;
	СтруктураДействий.Вставить("ПересчитатьКоличествоУпаковок");
		
	СоответствиеЗаказовПеремещения = Новый Соответствие;
	
	МассивСкладов = Новый Массив;
	ИспользоватьПеремещениеПоНесколькимЗаказам = ПолучитьФункциональнуюОпцию("ИспользоватьПеремещениеПоНесколькимЗаказам");
	
	ТЗ_ПодменнаяНоменклатура = Новый ТаблицаЗначений;
	ТЗ_ПодменнаяНоменклатура.Колонки.Добавить("ЗаказНаПеремещение");
	ТЗ_ПодменнаяНоменклатура.Колонки.Добавить("КодСтроки");
	ТЗ_ПодменнаяНоменклатура.Колонки.Добавить("Номенклатура");
	ТЗ_ПодменнаяНоменклатура.Колонки.Добавить("КоэфПересчета");
	ТЗ_ПодменнаяНоменклатура.Колонки.Добавить("НоменклатураЗаказа");
		
	Запрос.УстановитьПараметр("Ссылка", ТекущийОбъект.Ссылка);
	
	УстановитьПривилегированныйРежим(Истина);
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	ТЗ_Заказы = РезультатЗапроса[4].Выгрузить();
	
	ВыборкаНоменклатураЗаказа = РезультатЗапроса[3].Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	
	НоменклатураССериямиИзПоступления = РезультатЗапроса[5].Выгрузить();
		
	НачатьТранзакцию();
	Попытка
		
		Пока ВыборкаНоменклатураЗаказа.Следующий() Цикл
			ВыборкаХарактеристика = ВыборкаНоменклатураЗаказа.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока ВыборкаХарактеристика.Следующий() Цикл
				ВыборкаНазначение = ВыборкаХарактеристика.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
				Пока ВыборкаНазначение.Следующий() Цикл
					
					ВДЗ = ВыборкаНазначение.Выбрать();
					Пока ВДЗ.Следующий() Цикл
						
						НераспределенноеКоличество = ВДЗ.Количество;
						
						СтруктураПоиска = Новый Структура();
						СтруктураПоиска.Вставить("Номенклатура",   ВДЗ.НоменклатураЗаказа);
						СтруктураПоиска.Вставить("Характеристика", ВДЗ.Характеристика);
						СтруктураПоиска.Вставить("Использовать", Истина);
						
						
						НайденныеСтроки = ТЗ_Заказы.НайтиСтроки(СтруктураПоиска);
						
						Для Каждого ТекСтрока Из НайденныеСтроки Цикл
							
							ЗаказНаПеремещение = СоответствиеЗаказовПеремещения.Получить(ТекСтрока.ЗаказНаПеремещение);
							Если  ЗаказНаПеремещение = Неопределено Тогда
								ЗаказНаПеремещение  = ТекСтрока.ЗаказНаПеремещение.ПолучитьОбъект();
								ЗаказНаПеремещение.Заблокировать();
								СоответствиеЗаказовПеремещения.Вставить(ТекСтрока.ЗаказНаПеремещение, ЗаказНаПеремещение); 
								
								Если МассивСкладов.Найти(ТекСтрока.СкладПолучатель) = Неопределено Тогда
									МассивСкладов.Добавить(ТекСтрока.СкладПолучатель);
								КонецЕсли;
								
							КонецЕсли;
							
							СтрокаТовары = ЗаказНаПеремещение.Товары[ТекСтрока.НомерСтроки-1];
							НоваяДатаНачалаОтгрузки = ЗаказНаПеремещение.Дата;
							Если СтрокаТовары.Количество = НераспределенноеКоличество Тогда
								
								// К отгрузке всю строку
								СтрокаТовары.ВариантОбеспечения = ?(ЗначениеЗаполнено(ВДЗ.Назначение), Перечисления.ВариантыОбеспечения.УдалитьОтгрузитьОбособленно, Перечисления.ВариантыОбеспечения.Отгрузить);
								СтрокаТовары.НачалоОтгрузки = ?(СтрокаТовары.НачалоОтгрузки = Дата(1,1,1), НоваяДатаНачалаОтгрузки, СтрокаТовары.НачалоОтгрузки); 
								ТекСтрока.Использовать = Ложь;
								НераспределенноеКоличество = 0;
								
							ИначеЕсли СтрокаТовары.Количество > НераспределенноеКоличество Тогда
								
								// Разбиваем строку на 2 части:
								// К отгрузке - НераспределенноеКоличество
								// Обеспечение - Разница 
								Разница = СтрокаТовары.Количество - НераспределенноеКоличество;
								
								НоваяСтрокаТовары = ЗаказНаПеремещение.Товары.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрокаТовары, СтрокаТовары);
								ЗаказНаПеремещение.МаксимальныйКодСтроки = ЗаказНаПеремещение.МаксимальныйКодСтроки + 1;
								НоваяСтрокаТовары.КодСтроки = ЗаказНаПеремещение.МаксимальныйКодСтроки;
								НоваяСтрокаТовары.Количество = Разница;
								
								// Заполним текущую строку новыми значениями для дальнейшего использования
								ЗаполнитьЗначенияСвойств(ТекСтрока, НоваяСтрокаТовары);
								
								
								СтрокаТовары.ВариантОбеспечения = ?(ЗначениеЗаполнено(ВДЗ.Назначение), Перечисления.ВариантыОбеспечения.УдалитьОтгрузитьОбособленно, Перечисления.ВариантыОбеспечения.Отгрузить);
								СтрокаТовары.НачалоОтгрузки = ?(СтрокаТовары.НачалоОтгрузки = Дата(1,1,1), НоваяДатаНачалаОтгрузки, СтрокаТовары.НачалоОтгрузки);
								СтрокаТовары.Количество = НераспределенноеКоличество;
								НераспределенноеКоличество = 0;
								
								// Пересчитаем реквизиты строк
								ОбработкаТабличнойЧастиСервер.ОбработатьСтрокуТЧ(НоваяСтрокаТовары, СтруктураДействий, Неопределено);
								ОбработкаТабличнойЧастиСервер.ОбработатьСтрокуТЧ(СтрокаТовары, СтруктураДействий, Неопределено);
								
							ИначеЕсли СтрокаТовары.Количество < НераспределенноеКоличество Тогда
								
								// К отгрузке всю строку
								СтрокаТовары.ВариантОбеспечения = ?(ЗначениеЗаполнено(ВДЗ.Назначение), Перечисления.ВариантыОбеспечения.УдалитьОтгрузитьОбособленно, Перечисления.ВариантыОбеспечения.Отгрузить);
								СтрокаТовары.НачалоОтгрузки = ?(СтрокаТовары.НачалоОтгрузки = Дата(1,1,1), НоваяДатаНачалаОтгрузки, СтрокаТовары.НачалоОтгрузки);
								ТекСтрока.Использовать = Ложь;
								НераспределенноеКоличество = НераспределенноеКоличество - СтрокаТовары.Количество;
								
							КонецЕсли;
							
							// Заменять ведь нужно будет только там, где номенклатура отличается
							Если ВДЗ.Номенклатура <> ВДЗ.НоменклатураЗаказа Тогда 
								СтрокаНоменклатура  = ТЗ_ПодменнаяНоменклатура.Добавить();
								СтрокаНоменклатура.ЗаказНаПеремещение = ТекСтрока.ЗаказНаПеремещение;
								СтрокаНоменклатура.КодСтроки = СтрокаТовары.КодСтроки;
								СтрокаНоменклатура.Номенклатура = ВДЗ.Номенклатура; 
								СтрокаНоменклатура.КоэфПересчета = ВДЗ.КоэфПересчета;
								СтрокаНоменклатура.НоменклатураЗаказа = ВДЗ.НоменклатураЗаказа;
							КонецЕсли;
													
							Если НераспределенноеКоличество = 0 Тогда
								Прервать;
							КонецЕсли;
							
						КонецЦикла;
					КонецЦикла;
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		
		// ИспользоватьПеремещениеПоНесколькимЗаказам;
		// По каждому складу на основании  ПТиУ создаем перемещение
		// Распределяем по заказам на премещение автоматически
		// Удаляем из перемещения строки без заказа, сохраняем и в массив для вывода документа пользователю
	// Для каждого нового склада перемещение на основании ПТиУ за вычетом ранне распределенной номенклатуры
	Если ИспользоватьПеремещениеПоНесколькимЗаказам Тогда
		
		// Подготовка таблицы строк ПТУ с учетом распределения
		ТЗ_СтрокиПТУ = Новый ТаблицаЗначений;
		ТЗ_СтрокиПТУ.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов("Число"));
		ТЗ_СтрокиПТУ.Колонки.Добавить("Номенклатура");
		ТЗ_СтрокиПТУ.Колонки.Добавить("Характеристика");
		ТЗ_СтрокиПТУ.Колонки.Добавить("Назначение");
		ТЗ_СтрокиПТУ.Колонки.Добавить("КоличествоВсего", Новый ОписаниеТипов("Число"));
		ТЗ_СтрокиПТУ.Колонки.Добавить("КоличествоИспользовано", Новый ОписаниеТипов("Число"));
		
		НомерСтроки = 0;
		Для Каждого СтрокаПТУ Из ТекущийОбъект.Товары Цикл
			НоваяСтрока = ТЗ_СтрокиПТУ.Добавить();
			НоваяСтрока.НомерСтроки = НомерСтроки;
			НоваяСтрока.Номенклатура = СтрокаПТУ.Номенклатура;
			НоваяСтрока.Характеристика = СтрокаПТУ.Характеристика;
			НоваяСтрока.Назначение = СтрокаПТУ.Назначение;
			НоваяСтрока.КоличествоВсего = СтрокаПТУ.Количество;
			НоваяСтрока.КоличествоИспользовано = 0;
			НомерСтроки = НомерСтроки + 1;
		КонецЦикла;
		
		// Для каждого склада создаем перемещение с распределением товаров по заказам
		Для Каждого элСклад Из МассивСкладов Цикл
			
			// Шаг 1: Получить заказы для этого склада
			МассивЗаказовНаПеремещение = Новый Массив;
			СписокЗаказовОбъектов = Новый Массив;
			
			Для Каждого элЗаказПеремещение Из СоответствиеЗаказовПеремещения Цикл
				Если элЗаказПеремещение.Значение.СкладПолучатель = элСклад Тогда
					элЗаказПеремещение.Значение.Статус = Перечисления.СтатусыВнутреннихЗаказов.КВыполнению;
					элЗаказПеремещение.Значение.Записать(РежимЗаписиДокумента.Проведение);
					МассивЗаказовНаПеремещение.Добавить(элЗаказПеремещение.Ключ);
					СписокЗаказовОбъектов.Добавить(элЗаказПеремещение.Значение);
				КонецЕсли;
			КонецЦикла;
			
			Если МассивЗаказовНаПеремещение.Количество() = 0 Тогда
				Продолжить;
			КонецЕсли;
			
			// Шаг 2: Построить карту распределения товаров по заказам
			ТЗ_РаспределениеПоЗаказам = Новый ТаблицаЗначений;
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("ЗаказНаПеремещение");
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("КодСтрокиЗаказа", Новый ОписаниеТипов("Число"));
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("Номенклатура");
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("Характеристика");
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("Назначение");
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("КоличествоВЗаказе", Новый ОписаниеТипов("Число"));
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("КоличествоРаспределено", Новый ОписаниеТипов("Число"));
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("НоменклатураПТУ");
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("КоэфПересчета", Новый ОписаниеТипов("Число"));
			ТЗ_РаспределениеПоЗаказам.Колонки.Добавить("ДатаЗаказа", Новый ОписаниеТипов("Дата"));
			
			// Заполняем из ТЗ_Заказы (уже отсортирована по дате)
			СтруктураПоиска = Новый Структура("СкладПолучатель", элСклад);
			СтрокиЗаказов = ТЗ_Заказы.НайтиСтроки(СтруктураПоиска);
			
			Для Каждого СтрокаЗаказа Из СтрокиЗаказов Цикл
				НоваяСтрока = ТЗ_РаспределениеПоЗаказам.Добавить();
				НоваяСтрока.ЗаказНаПеремещение = СтрокаЗаказа.ЗаказНаПеремещение;
				НоваяСтрока.КодСтрокиЗаказа = СтрокаЗаказа.КодСтроки;
				НоваяСтрока.Номенклатура = СтрокаЗаказа.Номенклатура;
				НоваяСтрока.Характеристика = СтрокаЗаказа.Характеристика;
				НоваяСтрока.КоличествоВЗаказе = СтрокаЗаказа.Количество;
				НоваяСтрока.КоличествоРаспределено = 0;
				НоваяСтрока.ДатаЗаказа = СтрокаЗаказа.ЗаказНаПеремещение.Дата;
				
				// Найти номенклатуру ПТУ (может отличаться при подмене)
				СтруктураПоискаПодмены = Новый Структура("ЗаказНаПеремещение, КодСтроки");
				СтруктураПоискаПодмены.ЗаказНаПеремещение = СтрокаЗаказа.ЗаказНаПеремещение;
				СтруктураПоискаПодмены.КодСтроки = СтрокаЗаказа.КодСтроки;
				
				СтрокиПодмены = ТЗ_ПодменнаяНоменклатура.НайтиСтроки(СтруктураПоискаПодмены);
				Если СтрокиПодмены.Количество() > 0 Тогда
					НоваяСтрока.НоменклатураПТУ = СтрокиПодмены[0].Номенклатура;
					НоваяСтрока.КоэфПересчета = СтрокиПодмены[0].КоэфПересчета;
				Иначе
					НоваяСтрока.НоменклатураПТУ = СтрокаЗаказа.Номенклатура;
					НоваяСтрока.КоэфПересчета = 1;
				КонецЕсли;
			КонецЦикла;
			
			// Сортируем по дате заказа (уже должны быть отсортированы из запроса, но для надежности)
			ТЗ_РаспределениеПоЗаказам.Сортировать("ДатаЗаказа, КодСтрокиЗаказа");
			
			// Шаг 3: Распределить товары из ПТУ по заказам (локальное распределение для этого склада)
			ТЗ_ЛокальноеИспользовано = Новый ТаблицаЗначений;
			ТЗ_ЛокальноеИспользовано.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов("Число"));
			ТЗ_ЛокальноеИспользовано.Колонки.Добавить("Номенклатура");
			ТЗ_ЛокальноеИспользовано.Колонки.Добавить("Характеристика");
			ТЗ_ЛокальноеИспользовано.Колонки.Добавить("Назначение");
			ТЗ_ЛокальноеИспользовано.Колонки.Добавить("КоличествоИспользовано", Новый ОписаниеТипов("Число"));
			
			Для Каждого СтрокаПТУ Из ТЗ_СтрокиПТУ Цикл
				ДоступноеКоличество = СтрокаПТУ.КоличествоВсего - СтрокаПТУ.КоличествоИспользовано;
				
				Если ДоступноеКоличество <= 0 Тогда
					Продолжить;
				КонецЕсли;
				
				ЛокальноИспользовано = 0;
				
				// Найти строки заказов для этой номенклатуры
				СтруктураПоискаЗаказов = Новый Структура("НоменклатураПТУ, Характеристика, Назначение");
				СтруктураПоискаЗаказов.НоменклатураПТУ = СтрокаПТУ.Номенклатура;
				СтруктураПоискаЗаказов.Характеристика = СтрокаПТУ.Характеристика;
				СтруктураПоискаЗаказов.Назначение = СтрокаПТУ.Назначение;
				
				НайденныеСтрокиЗаказов = ТЗ_РаспределениеПоЗаказам.НайтиСтроки(СтруктураПоискаЗаказов);
				
				// Распределяем по приоритету (уже отсортировано по дате)
				Для Каждого СтрокаЗаказа Из НайденныеСтрокиЗаказов Цикл
					НеобеспеченноеКоличество = СтрокаЗаказа.КоличествоВЗаказе - СтрокаЗаказа.КоличествоРаспределено;
					
					Если НеобеспеченноеКоличество <= 0 Тогда
						Продолжить;
					КонецЕсли;
					
					// Количество с учетом коэффициента пересчета
					ДоступноеКоличествоВЕдиницахЗаказа = ДоступноеКоличество * СтрокаЗаказа.КоэфПересчета;
					КоличествоДляЗаказа = Мин(ДоступноеКоличествоВЕдиницахЗаказа, НеобеспеченноеКоличество);
					
					// Записать распределение
					СтрокаЗаказа.КоличествоРаспределено = СтрокаЗаказа.КоличествоРаспределено + КоличествоДляЗаказа;
					
					// Пересчитываем в единицы ПТУ
					КоличествоИзПТУ = КоличествоДляЗаказа / СтрокаЗаказа.КоэфПересчета;
					ЛокальноИспользовано = ЛокальноИспользовано + КоличествоИзПТУ;
					ДоступноеКоличество = ДоступноеКоличество - КоличествоИзПТУ;
					
					Если ДоступноеКоличество <= 0 Тогда
						Прервать;
					КонецЕсли;
				КонецЦикла;
				
				// Сохранить локально использованное количество
				Если ЛокальноИспользовано > 0 Тогда
					СтрокаЛокальной = ТЗ_ЛокальноеИспользовано.Добавить();
					СтрокаЛокальной.НомерСтроки = СтрокаПТУ.НомерСтроки;
					СтрокаЛокальной.Номенклатура = СтрокаПТУ.Номенклатура;
					СтрокаЛокальной.Характеристика = СтрокаПТУ.Характеристика;
					СтрокаЛокальной.Назначение = СтрокаПТУ.Назначение;
					СтрокаЛокальной.КоличествоИспользовано = ЛокальноИспользовано;
				КонецЕсли;
			КонецЦикла;
			
			// Шаг 4: Обработка излишков (только для текущего склада)
			Для Каждого СтрокаПТУ Из ТЗ_СтрокиПТУ Цикл
				ДоступноеКоличество = СтрокаПТУ.КоличествоВсего - СтрокаПТУ.КоличествоИспользовано;
				
				СтруктураПоискаЛокальной = Новый Структура("НомерСтроки", СтрокаПТУ.НомерСтроки);
				НайденныеЛокальные = ТЗ_ЛокальноеИспользовано.НайтиСтроки(СтруктураПоискаЛокальной);
				Если НайденныеЛокальные.Количество() > 0 Тогда
					ДоступноеКоличество = ДоступноеКоличество - НайденныеЛокальные[0].КоличествоИспользовано;
				КонецЕсли;
				
				Если ДоступноеКоличество > 0 Тогда
					
					// Определить приоритетный заказ для излишков
					ПриоритетныйЗаказ = Неопределено;
					
					// Ищем склад без организации
					Для Каждого ЗаказОбъект Из СписокЗаказовОбъектов Цикл
						ОргСклада = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ЗаказОбъект.СкладПолучатель, "ПЛ_Организация");
						Если НЕ ЗначениеЗаполнено(ОргСклада) Тогда
							ПриоритетныйЗаказ = ЗаказОбъект.Ссылка;
							Прервать;
						КонецЕсли;
					КонецЦикла;
					
					// Если не нашли склад без организации, берем самый ранний заказ
					Если ПриоритетныйЗаказ = Неопределено И СписокЗаказовОбъектов.Количество() > 0 Тогда
						МинимальнаяДата = Дата(3999, 12, 31);
						Для Каждого ЗаказОбъект Из СписокЗаказовОбъектов Цикл
							Если ЗаказОбъект.Дата < МинимальнаяДата Тогда
								МинимальнаяДата = ЗаказОбъект.Дата;
								ПриоритетныйЗаказ = ЗаказОбъект.Ссылка;
							КонецЕсли;
						КонецЦикла;
					КонецЕсли;
					
					Если ПриоритетныйЗаказ <> Неопределено Тогда
						
						// Найти или создать строку распределения для излишков
						СтруктураПоискаИзлишков = Новый Структура();
						СтруктураПоискаИзлишков.Вставить("ЗаказНаПеремещение", ПриоритетныйЗаказ);
						СтруктураПоискаИзлишков.Вставить("НоменклатураПТУ", СтрокаПТУ.Номенклатура);
						СтруктураПоискаИзлишков.Вставить("Характеристика", СтрокаПТУ.Характеристика);
						СтруктураПоискаИзлишков.Вставить("Назначение", СтрокаПТУ.Назначение);
						
						НайденныеСтроки = ТЗ_РаспределениеПоЗаказам.НайтиСтроки(СтруктураПоискаИзлишков);
						
						СтрокаРаспределения = Неопределено;
						Если НайденныеСтроки.Количество() > 0 Тогда
							СтрокаРаспределения = НайденныеСтроки[0];
						Иначе
							// Создаем новую строку для излишков
							СтрокаРаспределения = ТЗ_РаспределениеПоЗаказам.Добавить();
							СтрокаРаспределения.ЗаказНаПеремещение = ПриоритетныйЗаказ;
							СтрокаРаспределения.КодСтрокиЗаказа = 0;
							СтрокаРаспределения.Номенклатура = СтрокаПТУ.Номенклатура;
							СтрокаРаспределения.Характеристика = СтрокаПТУ.Характеристика;
							СтрокаРаспределения.Назначение = СтрокаПТУ.Назначение;
							СтрокаРаспределения.НоменклатураПТУ = СтрокаПТУ.Номенклатура;
							СтрокаРаспределения.КоличествоВЗаказе = 0;
							СтрокаРаспределения.КоличествоРаспределено = 0;
							СтрокаРаспределения.КоэфПересчета = 1;
						КонецЕсли;
						
						// Добавляем излишек
						ИзлишекВЕдиницахЗаказа = ДоступноеКоличество * СтрокаРаспределения.КоэфПересчета;
						СтрокаРаспределения.КоличествоРаспределено = СтрокаРаспределения.КоличествоРаспределено + ИзлишекВЕдиницахЗаказа;
						
						// Обновляем локальное использование
						Если НайденныеЛокальные.Количество() > 0 Тогда
							НайденныеЛокальные[0].КоличествоИспользовано = НайденныеЛокальные[0].КоличествоИспользовано + ДоступноеКоличество;
						Иначе
							СтрокаЛокальной = ТЗ_ЛокальноеИспользовано.Добавить();
							СтрокаЛокальной.НомерСтроки = СтрокаПТУ.НомерСтроки;
							СтрокаЛокальной.Номенклатура = СтрокаПТУ.Номенклатура;
							СтрокаЛокальной.Характеристика = СтрокаПТУ.Характеристика;
							СтрокаЛокальной.Назначение = СтрокаПТУ.Назначение;
							СтрокаЛокальной.КоличествоИспользовано = ДоступноеКоличество;
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
			КонецЦикла;
			
			// Шаг 5: Создать документ перемещения
			ТЗ_СтрокиПеремещения = ТЗ_РаспределениеПоЗаказам.Скопировать();
			
			// Убираем строки с нулевым распределением
			НомерСтроки = ТЗ_СтрокиПеремещения.Количество() - 1;
			Пока НомерСтроки >= 0 Цикл
				Если ТЗ_СтрокиПеремещения[НомерСтроки].КоличествоРаспределено = 0 Тогда
					ТЗ_СтрокиПеремещения.Удалить(НомерСтроки);
				КонецЕсли;
				НомерСтроки = НомерСтроки - 1;
			КонецЦикла;
			
			// Если нет строк для перемещения - пропускаем этот склад
			Если ТЗ_СтрокиПеремещения.Количество() = 0 Тогда
				Продолжить;
			КонецЕсли;
			
			// Создаем документ перемещения
			ДокПеремещение = Документы.ПеремещениеТоваров.СоздатьДокумент();
			ДокПеремещение.Дата = ТекущаяДатаСеанса();
			ДокПеремещение.СкладОтправитель = ТекущийОбъект.Склад;
			ДокПеремещение.СкладПолучатель = элСклад;
			ДокПеремещение.Организация = МассивЗаказовНаПеремещение[0].Организация;
			ДокПеремещение.ЗаказНаПеремещение = МассивЗаказовНаПеремещение[0];
			ДокПеремещение.ПеремещениеПоЗаказам = Истина;
			ДокПеремещение.Сделка = Справочники.СделкиСКлиентами.ПустаяСсылка();
			
			// Заполняем ТЧ Товары
			Для Каждого СтрокаРаспр Из ТЗ_СтрокиПеремещения Цикл
				
				// Найти исходную строку ПТУ для копирования реквизитов
				СтруктураПоискаПТУ = Новый Структура("Номенклатура, Характеристика, Назначение");
				СтруктураПоискаПТУ.Номенклатура = СтрокаРаспр.НоменклатураПТУ;
				СтруктураПоискаПТУ.Характеристика = СтрокаРаспр.Характеристика;
				СтруктураПоискаПТУ.Назначение = СтрокаРаспр.Назначение;
				
				СтрокиПТУНайденные = ТЗ_СтрокиПТУ.НайтиСтроки(СтруктураПоискаПТУ);
				Если СтрокиПТУНайденные.Количество() = 0 Тогда
					Продолжить;
				КонецЕсли;
				
				НомерСтрокиПТУ = СтрокиПТУНайденные[0].НомерСтроки;
				СтрокаПТУИсходная = ТекущийОбъект.Товары[НомерСтрокиПТУ];
				
				НоваяСтрока = ДокПеремещение.Товары.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаПТУИсходная);
				
				НоваяСтрока.ЗаказНаПеремещение = СтрокаРаспр.ЗаказНаПеремещение;
				НоваяСтрока.КодСтроки = СтрокаРаспр.КодСтрокиЗаказа;
				НоваяСтрока.Количество = СтрокаРаспр.КоличествоРаспределено / СтрокаРаспр.КоэфПересчета;
				НоваяСтрока.Номенклатура = СтрокаРаспр.НоменклатураПТУ;
			КонецЦикла;
			
			// Обработка серий
			ИндексСтрокиСерии = ДокПеремещение.Серии.Количество();
			Если ИндексСтрокиСерии > 0 Тогда
				КолонкиКлюч = "Номенклатура, Характеристика, НазначениеОтправителя";
				КлючиСерий = ДокПеремещение.Серии.Выгрузить(, КолонкиКлюч);
				КлючиСерий.Свернуть(КолонкиКлюч);
				
				ТоварыИтоги = НоменклатураССериямиИзПоступления.Скопировать();
				СтруктураПоискаДляСерий = Новый Структура(КолонкиКлюч);
				
				Для Каждого КлючСерий Из КлючиСерий Цикл
					ЗаполнитьЗначенияСвойств(СтруктураПоискаДляСерий, КлючСерий);
					СтрокиТоваров = ДокПеремещение.Товары.НайтиСтроки(СтруктураПоискаДляСерий);
					Для Каждого СтрокаТоваров Из СтрокиТоваров Цикл
						ЗаполнитьЗначенияСвойств(ТоварыИтоги.Добавить(), СтрокаТоваров);
					КонецЦикла;
				КонецЦикла;
				
				ТоварыИтоги.Свернуть(КолонкиКлюч, "Количество");
				
				Для Каждого КлючСерий Из КлючиСерий Цикл
					ЗаполнитьЗначенияСвойств(СтруктураПоискаДляСерий, КлючСерий);
					СтрокиТоваров = ТоварыИтоги.НайтиСтроки(СтруктураПоискаДляСерий);
					Если СтрокиТоваров.Количество() = 1 И СтрокиТоваров[0].Количество = 0 Тогда
						Продолжить;
					КонецЕсли;
					СтрокиСерий = ДокПеремещение.Серии.НайтиСтроки(СтруктураПоискаДляСерий);
					Для Каждого СтрокаСерий Из СтрокиСерий Цикл
						ДокПеремещение.Серии.Удалить(СтрокаСерий);
					КонецЦикла;
				КонецЦикла;
			КонецЕсли;
			
			// Пересчет и заполнение
			Документы.ПеремещениеТоваров.ОбновитьЗависимыеРеквизитыТабличнойЧасти(ДокПеремещение.Товары, Неопределено);
			ПараметрыУказанияСерий = Новый ФиксированнаяСтруктура(НоменклатураСервер.ПараметрыУказанияСерий(ДокПеремещение, Документы.ПеремещениеТоваров));
			НоменклатураСервер.ЗаполнитьСтатусыУказанияСерий(ДокПеремещение, ПараметрыУказанияСерий);
			ЗаполнитьСлужебныеРеквизитыПоНоменклатуре(ДокПеремещение);
			
			// Записываем документ
			ДокПеремещение.Записать();
			МассивПеремещений.Добавить(ДокПеремещение.Ссылка);
			
			// Обновляем глобальное КоличествоИспользовано на основе локального распределения
			Для Каждого СтрокаЛокальной Из ТЗ_ЛокальноеИспользовано Цикл
				СтрокаПТУГлобальная = ТЗ_СтрокиПТУ[СтрокаЛокальной.НомерСтроки];
				СтрокаПТУГлобальная.КоличествоИспользовано = СтрокаПТУГлобальная.КоличествоИспользовано + СтрокаЛокальной.КоличествоИспользовано;
			КонецЦикла;
			
		КонецЦикла;
						
		Иначе	
			Для каждого элЗаказПеремещение Из СоответствиеЗаказовПеремещения Цикл
				
				// Запишем заказ на перемещение
				элЗаказПеремещение.Значение.Статус = Перечисления.СтатусыВнутреннихЗаказов.КВыполнению;
				элЗаказПеремещение.Значение.Записать(РежимЗаписиДокумента.Проведение);	
				
				// Создаем перемещение на основании заказа на перемещение
				// Для заказа на перемещение необходимо передавать структурой параметры в обработку заполнения перемещения
				ПараметрыОткрытия = СозданиеНаОснованииУТВызовСервера.ПараметрыОткрытияФормыНакладнойНаОснованииЗаказа(элЗаказПеремещение.Ключ, "ПеремещениеТоваров");
				ДокПеремещение = Документы.ПеремещениеТоваров.СоздатьДокумент();
				ДокПеремещение.Дата = ТекущаяДатаСеанса();
				ДокПеремещение.Заполнить(ПараметрыОткрытия.ПараметрыФормы.Основание); 
				
				ДокПеремещение.ДокументОснование = ТекущийОбъект.Ссылка;
				Если ДокПеремещение.Товары.Количество() Тогда
					
					// Подменим вскрытую на закрытую номенклатуру
					// И пересчитаем количество
					Для каждого текСтрока  Из ДокПеремещение.Товары Цикл
						
						СтруктураПоиска = Новый Структура();
						СтруктураПоиска.Вставить("ЗаказНаПеремещение", элЗаказПеремещение.Ключ);
						СтруктураПоиска.Вставить("КодСтроки", текСтрока.КодСтроки);
						НайденныеСтроки = ТЗ_ПодменнаяНоменклатура.НайтиСтроки(СтруктураПоиска);
						
						Если НайденныеСтроки.Количество() Тогда
							текСтрока.Количество =  текСтрока.Количество / НайденныеСтроки[0].КоэфПересчета;
							текСтрока.Номенклатура = НайденныеСтроки[0].Номенклатура;	
							
							ОбработкаТабличнойЧастиСервер.ОбработатьСтрокуТЧ(текСтрока, СтруктураДействий, Неопределено);
						КонецЕсли;	
						
					КонецЦикла;

					ПараметрыУказанияСерий = Новый ФиксированнаяСтруктура(НоменклатураСервер.ПараметрыУказанияСерий(ДокПеремещение, Документы.ПеремещениеТоваров));
					НоменклатураСервер.ЗаполнитьСтатусыУказанияСерий(ДокПеремещение, ПараметрыУказанияСерий);
									
					// Запишем перемещение и добавим в массив созданных перемещений, который потом откроем на клиенте
					ДокПеремещение.Записать();
					МассивПеремещений.Добавить(ДокПеремещение.Ссылка);
					
				КонецЕсли;	
				
			КонецЦикла;
			
		КонецЕсли;
	
		Если МассивПеремещений.Количество() Тогда
			// Пометим, что обработка формирования перемещений сработала.
			МассивСтруктур = Новый Массив;
			МассивСтруктур.Добавить(Новый Структура("Свойство, Значение", ДопСвойство, Истина));
			
			ЗначенияДополнительныхРеквизитов = Новый ТаблицаЗначений;
			
			ЗначенияДополнительныхРеквизитов.Колонки.Добавить("Свойство");
			ЗначенияДополнительныхРеквизитов.Колонки.Добавить("Значение");
			
			Для каждого Реквизит Из МассивСтруктур Цикл
				
			ЗаполнитьЗначенияСвойств(ЗначенияДополнительныхРеквизитов.Добавить(), Реквизит);	
				
			КонецЦикла;
			
			УправлениеСвойствами.ЗаписатьСвойстваУОбъекта(ТекущийОбъект.Ссылка, ЗначенияДополнительныхРеквизитов);
		КонецЕсли;
		
		ЗафиксироватьТранзакцию();
		
	Исключение
		
		ОтменитьТранзакцию();
		
		МассивПеремещений.Очистить();
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
		КраткоеПредставлениеОшибки(ИнформацияОбОшибке()));
		
	КонецПопытки;
	
	УстановитьПривилегированныйРежим(Ложь);
	
	Если МассивПеремещений.Количество() Тогда
		// Передадим массив перемещений для дальнейшего открытия
		ПараметрыЗаписи.Вставить("МассивПеремещений", МассивПеремещений);
	КонецЕсли;	
		
	// Проверим остатки по заказу и запишем в документ очередь на создание задачи
	УстановитьПривилегированныйРежим(Истина);
	СоздаватьЗадачу = Константы.ПЛ_СоздаватьЗадачуНаЗакрытиеЗаказаПоставщику.Получить();
	УстановитьПривилегированныйРежим(Ложь);
	Если СоздаватьЗадачу Тогда
		РегистрыСведений.ПЛ_ОчередьЗаказовДляСозданияЗадач.ДобавитьПоступлениеВОчередьДляСозданияЗадачПоЗаказам(ТекущийОбъект.Ссылка);
	КонецЕсли;

КонецПроцедуры

//<< Портал-Юг, Кондрашихин, 2024.08.28 [9268, Обновление ERP 2.5.17]
// Записывает документы в регистр для отложенного проведения
// добавлено из-за ошибки https://bugboard.v8.1c.ru/error/000158049. 
// Для дальнешего использования сли будут проблемы
Процедура ОбновитьОчередьОтложенногоПроведенияЗаказов(Документ) Экспорт

	// Пока что не выполняем
	Возврат;
	
	Если Документ = Неопределено Тогда 
		Возврат;
	КонецЕсли;
	
	Если ОбщегоНазначения.ЭтоСсылка(Документ) Тогда  
		ОбъектСсылка = Документ;
	Иначе 
		ОбъектСсылка = Документ.Ссылка;
	КонецЕсли;

	Если ТипЗнч(Документ) = Тип("ДокументСсылка.ЗаказНаПеремещение") Тогда 
		
	ДанныеЗаполнения = Новый Структура;
	ДанныеЗаполнения.Вставить("Статус", Перечисления.СтатусыВнутреннихЗаказов.КВыполнению);

	ЗаполнитьЗначенияСвойств(Документ, ДанныеЗаполнения);
	
	Документ.ОбменДанными.Загрузка = Истина;
	Документ.Записать(РежимЗаписиДокумента.Запись);
	
	Иначе 
	// ничего не выполняем.	
	КонецЕсли;
	
	ЗначенияСвойствНабора = Новый Структура;
	ЗначенияСвойствНабора.Вставить("ОбъектСсылка", ОбъектСсылка);
	
	НаборЗаписей = РегистрыСведений.ПЛ_ОчередьЗаказовКОтложенномуПроведению.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Заказ.Установить(ОбъектСсылка);
	НоваяЗапись = НаборЗаписей.Добавить();
	ЗаполнитьЗначенияСвойств(НоваяЗапись, ЗначенияСвойствНабора);
	НаборЗаписей.Записать();
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.03.19

//<< Портал-Юг, Свинцов И.И., 2019.08.01 [5.2.1 Автоматическое создание документа «перемещение товаров» на основании документа поступления] 
// Функция дублирует функцию из объекта "Документ.ПеремещениеТоваров.ФормаДокумента" - ОбновитьОтклоненияОтЗаказаВСтроке(ТекущаяСтрока, ПеремещениеПоЗаказам)
Процедура ОбновитьОтклоненияОтЗаказаВСтроке(ТекущаяСтрока, ПеремещениеПоЗаказам)
	
	Если ПеремещениеПоЗаказам Тогда
		Если ТекущаяСтрока.КодСтроки = 0 Тогда
			ТекущаяСтрока.РасхождениеЗаказ = 1;
		Иначе
			ТекущаяСтрока.РасхождениеЗаказ = 0;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.08.01

//<< Портал-Юг, Свинцов И.И., 2019.08.01 [5.2.1 Автоматическое создание документа «перемещение товаров» на основании документа поступления]  
// Функция дублирует функцию из объекта "Документ.ПеремещениеТоваров.ФормаДокумента" - ЗаполнитьСлужебныеРеквизитыПоНоменклатуре()
Процедура ЗаполнитьСлужебныеРеквизитыПоНоменклатуре(Объект)
	
	//<< Портал-Юг, Баринов, 2019.08.18 [5.2.1 Автоматическое создание документа «перемещение товаров» на основании документа поступления]
	// Процедура имеет смысл только в форме
	//Для Каждого СтрокаТовар Из Объект.Товары Цикл
	//	ОбновитьОтклоненияОтЗаказаВСтроке(СтрокаТовар, Объект.ПеремещениеПоЗаказам);
	//КонецЦикла;
	//>> Портал-Юг, Баринов, 2019.08.18
	
	ПараметрыЗаполненияРеквизитов = Новый Структура;
	ПараметрыЗаполненияРеквизитов.Вставить("ЗаполнитьПризнакХарактеристикиИспользуются",
											Новый Структура("Номенклатура", "ХарактеристикиИспользуются"));
	ПараметрыЗаполненияРеквизитов.Вставить("ЗаполнитьПризнакАртикул",
											Новый Структура("Номенклатура", "Артикул"));
	ПараметрыЗаполненияРеквизитов.Вставить("ЗаполнитьПризнакТипНоменклатуры",
											Новый Структура("Номенклатура", "ТипНоменклатуры"));
	
КонецПроцедуры //>> Портал-Юг, Свинцов И.И., 2019.08.01

//<< Портал-Юг, Свинцов И.И., 2019.08.01 [5.2.1 Автоматическое создание документа «перемещение товаров» на основании документа поступления] 
// Функция дублирует функцию из объекта "Документ.ПеремещениеТоваров.ФормаДокумента" - ПривязатьСтрокиКЗаказамНаПеремещение(ОтобратьПоЗаказу = Ложь)
// Добавлен отбор по заказам на перемещение
Функция ПривязатьСтрокиКЗаказамНаПеремещение(Объект, МассивЗаказовНаПеремещение)
	
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	Товары.Номенклатура КАК Номенклатура,
	|	Товары.Характеристика КАК Характеристика
	|ПОМЕСТИТЬ Товары
	|ИЗ
	|	&Товары КАК Товары
	|ГДЕ
	|	Товары.КодСтроки = 0
	|	И Товары.ЗаказНаПеремещение = ЗНАЧЕНИЕ(Документ.ЗаказНаПеремещение.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТаблицаЗаказы.ЗаказНаПеремещение.Сделка КАК Сделка,
	|	ТаблицаЗаказы.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|	ТаблицаЗаказы.Номенклатура КАК Номенклатура,
	|	ТаблицаЗаказы.Характеристика КАК Характеристика,
	|	ТаблицаЗаказы.КодСтроки КАК КодСтроки,
	|	СУММА(ТаблицаЗаказы.КОформлению) КАК КОформлениюОстаток
	|ПОМЕСТИТЬ ЗаказыНаПеремещениеБезНазначений
	|ИЗ
	|	(ВЫБРАТЬ
	|		Заказы.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|		Заказы.Номенклатура КАК Номенклатура,
	|		Заказы.Характеристика КАК Характеристика,
	|		Заказы.КодСтроки КАК КодСтроки,
	|		Заказы.КОформлениюОстаток КАК КОформлению
	|	ИЗ
	|		РегистрНакопления.ЗаказыНаПеремещение.Остатки(
	|				,
	|				ЗаказНаПеремещение В (&ЗаказыНаПеремещение)
	|					И (Номенклатура, Характеристика) В
	|						(ВЫБРАТЬ
	|							Товары.Номенклатура КАК Номенклатура,
	|							Товары.Характеристика КАК Характеристика
	|						ИЗ
	|							Товары КАК Товары)) КАК Заказы
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		Заказы.ЗаказНаПеремещение,
	|		Заказы.Номенклатура,
	|		Заказы.Характеристика,
	|		Заказы.КодСтроки,
	|		ВЫБОР
	|			КОГДА Заказы.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	|				ТОГДА -Заказы.КОформлению
	|			ИНАЧЕ Заказы.КОформлению
	|		КОНЕЦ
	|	ИЗ
	|		РегистрНакопления.ЗаказыНаПеремещение КАК Заказы
	|	ГДЕ
	|		Заказы.Регистратор = &Регистратор
	|		И Заказы.ЗаказНаПеремещение В (&ЗаказыНаПеремещение)
	|		И Заказы.Активность
	|		И (Заказы.Номенклатура, Заказы.Характеристика) В
	|				(ВЫБРАТЬ
	|					Товары.Номенклатура КАК Номенклатура,
	|					Товары.Характеристика КАК Характеристика
	|				ИЗ
	|					Товары КАК Товары)) КАК ТаблицаЗаказы
	|
	|СГРУППИРОВАТЬ ПО
	|	ТаблицаЗаказы.Номенклатура,
	|	ТаблицаЗаказы.Характеристика,
	|	ТаблицаЗаказы.КодСтроки,
	|	ТаблицаЗаказы.ЗаказНаПеремещение,
	|	ТаблицаЗаказы.ЗаказНаПеремещение.Сделка
	|
	|ИМЕЮЩИЕ
	|	СУММА(ТаблицаЗаказы.КОформлению) > 0
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТаблицаЗаказы.ЗаказНаПеремещение.Сделка КАК Сделка,
	|	ТаблицаЗаказы.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|	ТаблицаЗаказы.Номенклатура КАК Номенклатура,
	|	ТаблицаЗаказы.Характеристика КАК Характеристика,
	|	ТаблицаЗаказы.КодСтроки КАК КодСтроки,
	|	ТаблицаТовары.НачалоОтгрузки КАК НачалоОтгрузки,
	|	ТаблицаТовары.НомерСтроки КАК НомерСтроки,
	|	ТаблицаЗаказы.КОформлениюОстаток КАК КОформлениюОстаток,
	|	ВЫБОР
	|		КОГДА ТаблицаТовары.ВариантОбеспечения = ЗНАЧЕНИЕ(Перечисление.ВариантыОбеспечения.УдалитьОтгрузитьОбособленно)
	|			ТОГДА ВЫБОР
	|					КОГДА ТаблицаТовары.Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|							ИЛИ ТаблицаТовары.Ссылка.ОбосабливатьПоНазначениюЗаказа
	|								И ТаблицаТовары.Назначение.ТипНазначения = ЗНАЧЕНИЕ(Перечисление.ТипыНазначений.Собственное)
	|						ТОГДА ТаблицаТовары.Ссылка.Назначение
	|					ИНАЧЕ ТаблицаТовары.Назначение
	|				КОНЕЦ
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)
	|	КОНЕЦ КАК НазначениеОтправителя,
	|	ТаблицаТовары.Назначение КАК Назначение
	|ПОМЕСТИТЬ ЗаказыНаПеремещение
	|ИЗ
	|	ЗаказыНаПеремещениеБезНазначений КАК ТаблицаЗаказы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаПеремещение.Товары КАК ТаблицаТовары
	|		ПО (ТаблицаТовары.Ссылка = ТаблицаЗаказы.ЗаказНаПеремещение)
	|			И (ТаблицаТовары.КодСтроки = ТаблицаЗаказы.КодСтроки)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	КОЛИЧЕСТВО(*) КАК КоличествоДублей,
	|	ЗаказыНаПеремещение.Номенклатура КАК Номенклатура,
	|	ЗаказыНаПеремещение.Характеристика КАК Характеристика,
	|	ЗаказыНаПеремещение.НазначениеОтправителя КАК НазначениеОтправителя,
	|	ЗаказыНаПеремещение.Назначение КАК Назначение
	|ПОМЕСТИТЬ ДублиТоваров
	|ИЗ
	|	ЗаказыНаПеремещение КАК ЗаказыНаПеремещение
	|
	|СГРУППИРОВАТЬ ПО
	|	ЗаказыНаПеремещение.Номенклатура,
	|	ЗаказыНаПеремещение.Характеристика,
	|	ЗаказыНаПеремещение.НазначениеОтправителя,
	|	ЗаказыНаПеремещение.Назначение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Заказы.Сделка КАК Сделка,
	|	Заказы.ЗаказНаПеремещение КАК ЗаказНаПеремещение,
	|	Заказы.Номенклатура КАК Номенклатура,
	|	Заказы.Характеристика КАК Характеристика,
	|	Заказы.КодСтроки КАК КодСтроки,
	|	Заказы.НазначениеОтправителя КАК НазначениеОтправителя,
	|	Заказы.Назначение КАК Назначение,
	|	Заказы.КОформлениюОстаток КАК КОформлениюОстаток,
	|	0 КАК Распределено,
	|	ДублиТоваров.КоличествоДублей КАК КоличествоДублей
	|ИЗ
	|	ЗаказыНаПеремещение КАК Заказы
	|		ЛЕВОЕ СОЕДИНЕНИЕ ДублиТоваров КАК ДублиТоваров
	|		ПО Заказы.Номенклатура = ДублиТоваров.Номенклатура
	|			И Заказы.Характеристика = ДублиТоваров.Характеристика
	|			И Заказы.НазначениеОтправителя = ДублиТоваров.НазначениеОтправителя
	|			И Заказы.Назначение = ДублиТоваров.Назначение
	|
	|УПОРЯДОЧИТЬ ПО
	|	Номенклатура,
	|	Характеристика,
	|	Назначение,
	|	НазначениеОтправителя,
	|	Заказы.НачалоОтгрузки,
	|	ЗаказНаПеремещение,
	|	Заказы.НомерСтроки");
	
	Запрос.УстановитьПараметр("Заказ",            Объект.ЗаказНаПеремещение);
	Запрос.УстановитьПараметр("Организация",      Объект.Организация);
	Запрос.УстановитьПараметр("СкладОтправитель", Объект.СкладОтправитель);
	Запрос.УстановитьПараметр("СкладПолучатель",  Объект.СкладПолучатель);
	Запрос.УстановитьПараметр("Регистратор",      Объект.Ссылка);
	Запрос.УстановитьПараметр("ВариантПриемкиТоваров", Объект.ВариантПриемкиТоваров);
	//<< Портал-Юг, Свинцов И.И., 2019.08.01 [] 
	// Отбор по заказам
	Запрос.УстановитьПараметр("ЗаказыНаПеремещение", МассивЗаказовНаПеремещение);
	//>> Портал-Юг, Свинцов И.И., 2019.08.01
	
	Запрос.УстановитьПараметр("Товары", Объект.Товары.Выгрузить(,"КодСтроки,Номенклатура,Характеристика,ЗаказНаПеремещение"));
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат Ложь;
	КонецЕсли;
	
	Выборка = РезультатЗапроса[4].Выбрать();
	
	ТаблицаНераспределенныхТоваров = Новый ТаблицаЗначений();
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("Номенклатура");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("Характеристика");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("ЗаказНаПеремещение");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("Назначение");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("НазначениеОтправителя");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("КодСтроки");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("Количество");
	ТаблицаНераспределенныхТоваров.Колонки.Добавить("Сделка");
	
	Пока Выборка.Следующий() Цикл
		
		СтруктураПоиска = Новый Структура();
		СтруктураПоиска.Вставить("Номенклатура",          Выборка.Номенклатура);
		СтруктураПоиска.Вставить("Характеристика",        Выборка.Характеристика);
		СтруктураПоиска.Вставить("НазначениеОтправителя", Выборка.НазначениеОтправителя);
		СтруктураПоиска.Вставить("Назначение",            Выборка.Назначение);
		СтруктураПоиска.Вставить("КодСтроки",      0);
		
		НайденныеСтроки = Объект.Товары.НайтиСтроки(СтруктураПоиска);
		НераспределенноеКоличество = Выборка.КОформлениюОстаток;
		
		// Если дублей нет, распределяем строку заказа по строкам накладной
		Если Выборка.КоличествоДублей < 2 Тогда
		
			Для Каждого ТекСтрока Из НайденныеСтроки Цикл
				
				Если ТекСтрока.Количество > НераспределенноеКоличество Тогда
					
					НоваяСтрока = Объект.Товары.Добавить();
					ЗаполнитьЗначенияСвойств(НоваяСтрока, ТекСтрока);
					НоваяСтрока.Количество = ТекСтрока.Количество - НераспределенноеКоличество;
					ТекСтрока.Количество = НераспределенноеКоличество;
					
				КонецЕсли;
				
				ЗаполнитьЗначенияСвойств(ТекСтрока, Выборка, "КодСтроки,ЗаказНаПеремещение,Назначение,НазначениеОтправителя,Сделка");
				НераспределенноеКоличество = НераспределенноеКоличество - ТекСтрока.Количество;
				
				Если НераспределенноеКоличество <= 0 Тогда
					Прервать;
				КонецЕсли;
			
			КонецЦикла;
			
		// Если дубли есть, распределяем строки заказов по строкам накладной с учетом количества.
		Иначе
			
			// На первом проходе заполним только если количество в строке заказа и накладной совпадают.
			
			НайденаПодходящаяСтрока = Ложь;
			
			Для Каждого ТекСтрока Из НайденныеСтроки Цикл
				
				Если ТекСтрока.Количество = Выборка.КОформлениюОстаток Тогда
					
					НайденаПодходящаяСтрока = Истина;
					ЗаполнитьЗначенияСвойств(ТекСтрока, Выборка, "КодСтроки,ЗаказНаПеремещение,Назначение,НазначениеОтправителя,Сделка");
					
					Прервать;
					
				КонецЕсли;
				
			КонецЦикла;
			
			Если Не НайденаПодходящаяСтрока Тогда
				
				НоваяСтрока = ТаблицаНераспределенныхТоваров.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, Выборка);
				НоваяСтрока.Количество = НераспределенноеКоличество;
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	// Распределим дубли товаров, нераспределенные на первом проходе
	Если ТаблицаНераспределенныхТоваров.Количество() > 0 Тогда
	
		СтруктураПоиска = Новый Структура();
		СтруктураПоиска.Вставить("КодСтроки", 0);
		СтруктураПоиска.Вставить("ЗаказНаПеремещение", Документы.ЗаказНаПеремещение.ПустаяСсылка());
		
		СтрокиТовары = Объект.Товары.НайтиСтроки(СтруктураПоиска);
		ВсегоСтрокДляОбработки = СтрокиТовары.Количество();
		
		Индекс = 0;
		Пока Индекс < ВсегоСтрокДляОбработки Цикл
			
			СтрокаТовары = СтрокиТовары[Индекс];
			
			// Найдем нужные строки в таблице нераспределенных товаров
			СтруктураПоиска = Новый Структура();
			СтруктураПоиска.Вставить("Номенклатура",          СтрокаТовары.Номенклатура);
			СтруктураПоиска.Вставить("Характеристика",        СтрокаТовары.Характеристика);
			СтруктураПоиска.Вставить("НазначениеОтправителя", СтрокаТовары.НазначениеОтправителя);
			СтруктураПоиска.Вставить("Назначение",            СтрокаТовары.Назначение);
			
			НайденныеСтроки = ТаблицаНераспределенныхТоваров.НайтиСтроки(СтруктураПоиска);
			
			Для Каждого ТекСтрока Из НайденныеСтроки Цикл
				Если ТекСтрока.Номенклатура = СтрокаТовары.Номенклатура
					И ТекСтрока.Характеристика = СтрокаТовары.Характеристика
					И ТекСтрока.Количество > 0 Тогда
					
					КоличествоЗаполнить = Мин(ТекСтрока.Количество, СтрокаТовары.Количество);
					Если КоличествоЗаполнить < СтрокаТовары.Количество Тогда
						
						НоваяСтрока = Объект.Товары.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТовары);
						НоваяСтрока.Количество = СтрокаТовары.Количество - КоличествоЗаполнить;
						СтрокиТовары.Добавить(НоваяСтрока);
						ВсегоСтрокДляОбработки = ВсегоСтрокДляОбработки + 1;
						
					КонецЕсли;
					СтрокаТовары.Количество = КоличествоЗаполнить;
					
					ЗаполнитьЗначенияСвойств(СтрокаТовары, ТекСтрока, "КодСтроки,ЗаказНаПеремещение,Назначение,НазначениеОтправителя,Сделка");
					
					// Уменьшим нераспределенное количество в таблице
					ТекСтрока.Количество = ТекСтрока.Количество - СтрокаТовары.Количество;
					
					Прервать;
					
				КонецЕсли;
				
			КонецЦикла;
			
			Индекс = Индекс + 1;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Для Каждого ТекСтрока Из Объект.Товары Цикл
		Если Не ЗначениеЗаполнено(ТекСтрока.КодСтроки) Или Не ЗначениеЗаполнено(ТекСтрока.ЗаказНаПеремещение) Тогда
			ТекСтрока.КодСтроки = 0;
			ТекСтрока.ЗаказНаПеремещение = Объект.ЗаказНаПеремещение;
		КонецЕсли;
	КонецЦикла;
	
	ТаблицаТоваров = Объект.Товары.Выгрузить();
	ТаблицаТоваров.Свернуть("Номенклатура,Характеристика,Упаковка,КодСтроки,СтатусУказанияСерий,
		|ЗаказНаПеремещение,Сделка,Назначение,НазначениеОтправителя,Серия,ИдентификаторСтроки",
		"Количество");
	Объект.Товары.Загрузить(ТаблицаТоваров);
	Возврат Истина;
	
КонецФункции //>> Портал-Юг, Свинцов И.И., 2019.08.01

//<< Портал-Юг, Баринов, 2019.08.01 [ТП Нулевая цена по кассе ККМ] 
Процедура спрКассыККМФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_РазрешитьПродажуПоНулевойЦене", "Объект.ПЛ_РазрешитьПродажуПоНулевойЦене");
	нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
	нНадпись = Форма.Элементы.Добавить("ПЛ_НадписьРазрешитьПродажуПоНулевойЦене", Тип("ДекорацияФормы"));
	нНадпись.Заголовок = НСтр("ru = 'Отключает проверку заполнения цены в выпуске блюд и отчёте о розничных продажах.'");
	нНадпись.ЦветТекста = ЦветаСтиля.ПоясняющийТекст;
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.01
//<<Портал-Юг, Гладкая Н. 20.11.2020,SD33228
Процедура здчЗадачаИсполнителяПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	Если ТипЗнч( Форма.Объект.Предмет)<>Тип("ДокументСсылка.ЗаказПоставщику") Тогда
		Возврат;
	КонецЕсли;
	
	ДобавитьРеквизитНаФорму(Форма, "ПЛ_ТабличныйДокумент", Новый ОписаниеТипов("ТабличныйДокумент"), , "Остатки по заказу", );
	нЭлемент = ДобавитьПолеНаФорму("ПолеТабличногоДокумента",Форма, "ПЛ_ТабличныйДокумент","ПЛ_ТабличныйДокумент","ГруппаСодержание");
	нЭлемент.Заголовок = НСтр("ru = 'Остатки по заказу.'");
		
	нЭлемент = ДобавитьКнопкуНаФорму(Форма, "ПЛ_ЗакрытьЗаказ", "Подключаемый_ПЛ_ЗакрытьЗаказ", НСтр("ru = 'Закрыть заказ'"), "ГруппаСодержание", "ПЛ_ТабличныйДокумент", "Гиперссылка");
	нЭлемент.ГоризонтальноеПоложениеВГруппе = ГоризонтальноеПоложениеЭлемента.Лево;
	
	// выведем в таб.документ остатки по заказу
	ВывестиОстаткиЗаказаВТабличныДокумент( Форма.Объект.Предмет, Форма["ПЛ_ТабличныйДокумент"]);
КонецПроцедуры
//>>Портал-Юг, Гладкая Н. 20.11.2020

//<<Портал-Юг, Гладкая Н. 22.05.2020 
Процедура спрПартнерыФормаЭлементаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
		
	ПЛ_КодВБП = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_КодВБПиElma", "Объект.ПЛ_КодВБПиElma", "ГруппаДополнительнаяИнформация");
	
КонецПроцедуры//>>Портал-Юг, Давиденко 2019.02.12
//<< Портал-Юг, Гладкая  Н., 18.11.2020, [SD33228 Закрытие заказов с высоким процентом поставки ("недовоза")]
Процедура ПроверитьОстаткиЗаказовПоставщикам( ДокументПоступления)
	// проверим остатки по заказу
	УстановитьПривилегированныйРежим(Истина);
	
	ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров =
		Константы.ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров.Получить();
		
	ИспользуетсяСтатусЗакрыт = ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыПоставщикамБезПолногоПоступления")
								ИЛИ ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыПоставщикамБезПолнойОплаты");

		

	МассивЗаказов=ДокументПоступления.Товары.ВыгрузитьКолонку("ЗаказПоставщику");
			
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	ЗаказПоставщику.Ссылка КАК ЗаказПоставщику,
	|	ЗаказПоставщику.Менеджер КАК Менеджер
	|ИЗ
	|	Документ.ЗаказПоставщику КАК ЗаказПоставщику
	|ГДЕ
	|	ЗаказПоставщику.Ссылка В(&ЗаказыПоставщикам)
	|	И ЗаказПоставщику.Статус <> ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Закрыт)
	//|	И &ИспользоватьСтатусЗакрыт
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Остатки.ЗаказПоставщику КАК Заказ,
	|	Остатки.Номенклатура КАК Номенклатура,
	|	Остатки.Характеристика КАК Характеристика,
	|	Остатки.Склад КАК Склад,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(Остатки.ЗаказПоставщику КАК Документ.ЗаказПоставщику).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
	|			ТОГДА Остатки.КОформлениюКонечныйОстаток
	|		ИНАЧЕ Остатки.ЗаказаноКонечныйОстаток
	|	КОНЕЦ КАК Количество,
	|	Остатки.ЗаказаноПриход КАК Заказано
	|ИЗ
	|	РегистрНакопления.ЗаказыПоставщикам.ОстаткиИОбороты(
	|			&НачПериодЗаказыПоставщикам,
	|			&КонПериодЗаказыПоставщикам,
	|			,
	|			,
	|			ЗаказПоставщику В (&ЗаказыПоставщикам)
	|				И ЗаказПоставщику.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаКомиссию)
	|				И ЗаказПоставщику.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаХранениеСПравомПродажи)) КАК Остатки
	|ГДЕ
	|	(Остатки.КОформлениюКонечныйОстаток <> 0
	|			ИЛИ Остатки.ЗаказаноКонечныйОстаток <> 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТоварыКПоступлению.Номенклатура КАК Номенклатура,
	|	ТоварыКПоступлению.Характеристика КАК Характеристика,
	|	ТоварыКПоступлению.Склад КАК Склад,
	|	ТоварыКПоступлению.ЗаказПоставщику КАК Заказ,
	|	СУММА(ТоварыКПоступлению.КОформлениюПриход * (&ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров / 100)) КАК ДопустимоеОтклонение
	|ИЗ
	|	РегистрНакопления.ЗаказыПоставщикам.Обороты(&НачПериодЗаказыПоставщикам, &КонПериодЗаказыПоставщикам, , ЗаказПоставщику В (&ЗаказыПоставщикам)) КАК ТоварыКПоступлению
	|ГДЕ
	|	ТоварыКПоступлению.Номенклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины В(&МерныеТипыЕдиницИзмерений)
	|
	|СГРУППИРОВАТЬ ПО
	|	ТоварыКПоступлению.Номенклатура,
	|	ТоварыКПоступлению.Характеристика,
	|	ТоварыКПоступлению.Склад,
	|	ТоварыКПоступлению.ЗаказПоставщику");
	
		
	Запрос.УстановитьПараметр("ЗаказыПоставщикам", МассивЗаказов);
		
	Запрос.УстановитьПараметр("ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров",
		ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров);
	Запрос.УстановитьПараметр("МерныеТипыЕдиницИзмерений",
		Справочники.УпаковкиЕдиницыИзмерения.МерныеТипыЕдиницИзмерений());
	
	Запрос.УстановитьПараметр("ИспользоватьСтатусЗакрыт", ИспользуетсяСтатусЗакрыт);
	
	ГраницыОборотов = ОбщегоНазначенияУТ.ГраницыОборотовРегистра("ЗаказыПоставщикам",
																"ЗаказПоставщику В (&ЗаказыПоставщикам)",
																Запрос.Параметры);
	
	Запрос.УстановитьПараметр("НачПериодЗаказыПоставщикам", ГраницыОборотов.МинимальнаяДата);
	Запрос.УстановитьПараметр("КонПериодЗаказыПоставщикам", ГраницыОборотов.МаксимальнаяДата);
	
	Результат = Запрос.ВыполнитьПакет();
	УстановитьПривилегированныйРежим(Ложь);
	
	ВыборкаЗаказы = Результат[0].Выбрать();
	ТаблицаТоварыКОтмене = Результат[1].Выгрузить();
	
	ДопустимыеОтклонения = Результат[2].Выгрузить();
		
	СтруктураПоиска = Новый Структура("Номенклатура, Характеристика, Склад, Заказ");
	МерныеТоварыККорректировке=ВыделитьМерныеТовары(ТаблицаТоварыКОтмене, ДопустимыеОтклонения, СтруктураПоиска);
	// 23.12.2020
	//Если ВыборкаЗаказы.Количество() = 0
	//	И ТаблицаТоварыКОтмене.Количество() = 0
	//	И МерныеТоварыККорректировке.Количество() = 0 Тогда
	Если ТаблицаТоварыКОтмене.Количество() = 0
		И МерныеТоварыККорректировке.Количество() = 0 Тогда
		ЗаказыЗакрыты = Истина;
		Возврат;
	КонецЕсли;
	
	// создадим задачи на менеджеров
	//СтруктураОтбора = Новый Структура("Заказ");
	УстановитьПривилегированныйРежим(Истина);
	Пока ВыборкаЗаказы.Следующий() Цикл
		//СтруктураОтбора.Вставить("Заказ",ВыборкаЗаказы.ЗаказПоставщику); 
		//СтрокиПоЗаказу=ТаблицаТоварыКОтмене.НайтиСтроки(СтруктураОтбора);
		//СтрокиПоЗаказуДопустимыеОтклонения=МерныеТоварыККорректировке.НайтиСтроки(СтруктураОтбора);
		Попытка
			НоваяЗадача=Задачи.ЗадачаИсполнителя.СоздатьЗадачу();
			НоваяЗадача.Автор=Пользователи.АвторизованныйПользователь();
			НоваяЗадача.ДатаНачала=ТекущаяДата();
			НоваяЗадача.Исполнитель=ВыборкаЗаказы.Менеджер;
			НоваяЗадача.Предмет=ВыборкаЗаказы.ЗаказПоставщику;
			НоваяЗадача.Описание="Закрыть заказ поставщику "+ ВыборкаЗаказы.ЗаказПоставщику;
			НоваяЗадача.Дата=ТекущаяДата();
			НоваяЗадача.Наименование="Закрыть заказ поставщику "+ ВыборкаЗаказы.ЗаказПоставщику;
			НоваяЗадача.Записать();
		Исключение
			Сообщить(ОписаниеОшибки());
		КонецПопытки;
	КонецЦикла;
	УстановитьПривилегированныйРежим(Ложь);
КонецПроцедуры
Функция ВыделитьМерныеТовары(ТоварыКОтмене, ДопустимыеОтклонения, СтруктураПоиска)
	МерныеТоварыККорректировке=Новый ТаблицаЗначений;
	МерныеТоварыККорректировке.Колонки.Добавить("Номенклатура", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
	МерныеТоварыККорректировке.Колонки.Добавить("Характеристика", Новый ОписаниеТипов("СправочникСсылка.ХарактеристикиНоменклатуры"));
	МерныеТоварыККорректировке.Колонки.Добавить("Склад", Новый ОписаниеТипов("СправочникСсылка.Склады"));
	МерныеТоварыККорректировке.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
	МерныеТоварыККорректировке.Колонки.Добавить("ХарактеристикиИспользуются", Новый ОписаниеТипов("Булево"));
	МерныеТоварыККорректировке.Колонки.Добавить("ТипНоменклатуры", Новый ОписаниеТипов("ПеречислениеСсылка.ТипыНоменклатуры"));
	МерныеТоварыККорректировке.Колонки.Добавить("Серия", Новый ОписаниеТипов("СправочникСсылка.СерииНоменклатуры"));
	МерныеТоварыККорректировке.Колонки.Добавить("Заказано", Новый ОписаниеТипов("Число",,,Новый КвалификаторыЧисла(15,3)));
	МерныеТоварыККорректировке.Колонки.Добавить("ЭтоОтгрузка", Новый ОписаниеТипов("Булево"));
	МерныеТоварыККорректировке.Колонки.Добавить("Заказ", Новый ОписаниеТипов("ДокументСсылка.ЗаказПоставщику"));

	
	Сч = ТоварыКОтмене.Количество()-1;
	Пока Сч >= 0 Цикл
		
		СтрокаОстатков = ТоварыКОтмене[сч];
		
		ЗаполнитьЗначенияСвойств(СтруктураПоиска, СтрокаОстатков);
		
		СтрокиДопустимыхОтклонений = ДопустимыеОтклонения.НайтиСтроки(СтруктураПоиска);
		
		Если СтрокаОстатков.Количество < 0 Тогда //превышение распоряжения
			
			Если СтрокиДопустимыхОтклонений.Количество() > 0 Тогда
				
				ДопустимоеОтклонение = СтрокиДопустимыхОтклонений[0].ДопустимоеОтклонение;
				
				Если -СтрокаОстатков.Количество <= ДопустимоеОтклонение Тогда
					НовСтр = МерныеТоварыККорректировке.Добавить();
					ЗаполнитьЗначенияСвойств(НовСтр, СтрокаОстатков);
					НовСтр.Количество = -НовСтр.Количество;
				КонецЕсли;
				
			КонецЕсли;
			
			ТоварыКОтмене.Удалить(сч);
			
		ИначеЕсли СтрокаОстатков.Количество > 0 Тогда
			
			Если СтрокиДопустимыхОтклонений.Количество() > 0 Тогда
				
				ДопустимоеОтклонение = СтрокиДопустимыхОтклонений[0].ДопустимоеОтклонение;
				
				Если СтрокаОстатков.Количество <= ДопустимоеОтклонение Тогда
					НовСтр = МерныеТоварыККорректировке.Добавить();
					ЗаполнитьЗначенияСвойств(НовСтр,СтрокаОстатков);
					НовСтр.Количество = -НовСтр.Количество;
					ТоварыКОтмене.Удалить(Сч);
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЕсли;
		
		Сч = Сч - 1;
		
	КонецЦикла;
	Возврат МерныеТоварыККорректировке;
КонецФункции
Процедура ВывестиОстаткиЗаказаВТабличныДокумент( ЗаказПоставщику, ТабличныйДокумент)
	// проверим остатки по заказу
	УстановитьПривилегированныйРежим(Истина);
	
	ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров =
		Константы.ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров.Получить();
		
	ИспользуетсяСтатусЗакрыт = ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыПоставщикамБезПолногоПоступления")
								ИЛИ ПолучитьФункциональнуюОпцию("НеЗакрыватьЗаказыПоставщикамБезПолнойОплаты");

		

	МассивЗаказов=Новый Массив;
	МассивЗаказов.Добавить(ЗаказПоставщику);
			
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	ЗаказПоставщику.Ссылка КАК ЗаказПоставщику,
	|	ЗаказПоставщику.Менеджер КАК Менеджер
	|ИЗ
	|	Документ.ЗаказПоставщику КАК ЗаказПоставщику
	|ГДЕ
	|	ЗаказПоставщику.Ссылка В(&ЗаказыПоставщикам)
	|	И ЗаказПоставщику.Статус <> ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Закрыт)
	//|	И &ИспользоватьСтатусЗакрыт
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Остатки.ЗаказПоставщику КАК Заказ,
	|	Остатки.Номенклатура КАК Номенклатура,
	|	Остатки.Характеристика КАК Характеристика,
	|	Остатки.Склад КАК Склад,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(Остатки.ЗаказПоставщику КАК Документ.ЗаказПоставщику).Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыЗаказовПоставщикам.Подтвержден)
	|			ТОГДА Остатки.КОформлениюКонечныйОстаток
	|		ИНАЧЕ Остатки.ЗаказаноКонечныйОстаток
	|	КОНЕЦ КАК Количество,
	|	Остатки.ЗаказаноПриход КАК Заказано
	|ИЗ
	|	РегистрНакопления.ЗаказыПоставщикам.ОстаткиИОбороты(
	|			&НачПериодЗаказыПоставщикам,
	|			&КонПериодЗаказыПоставщикам,
	|			,
	|			,
	|			ЗаказПоставщику В (&ЗаказыПоставщикам)
	|				И ЗаказПоставщику.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаКомиссию)
	|				И ЗаказПоставщику.ХозяйственнаяОперация <> ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПриемНаХранениеСПравомПродажи)) КАК Остатки
	|ГДЕ
	|	(Остатки.КОформлениюКонечныйОстаток <> 0
	|			ИЛИ Остатки.ЗаказаноКонечныйОстаток <> 0)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТоварыКПоступлению.Номенклатура КАК Номенклатура,
	|	ТоварыКПоступлению.Характеристика КАК Характеристика,
	|	ТоварыКПоступлению.Склад КАК Склад,
	|	ТоварыКПоступлению.ЗаказПоставщику КАК Заказ,
	|	СУММА(ТоварыКПоступлению.КОформлениюПриход * (&ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров / 100)) КАК ДопустимоеОтклонение
	|ИЗ
	|	РегистрНакопления.ЗаказыПоставщикам.Обороты(&НачПериодЗаказыПоставщикам, &КонПериодЗаказыПоставщикам, , ЗаказПоставщику В (&ЗаказыПоставщикам)) КАК ТоварыКПоступлению
	|ГДЕ
	|	ТоварыКПоступлению.Номенклатура.ЕдиницаИзмерения.ТипИзмеряемойВеличины В(&МерныеТипыЕдиницИзмерений)
	|
	|СГРУППИРОВАТЬ ПО
	|	ТоварыКПоступлению.Номенклатура,
	|	ТоварыКПоступлению.Характеристика,
	|	ТоварыКПоступлению.Склад,
	|	ТоварыКПоступлению.ЗаказПоставщику");
	
		
	Запрос.УстановитьПараметр("ЗаказыПоставщикам", МассивЗаказов);
		
	Запрос.УстановитьПараметр("ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров",
		ДопустимоеОтклонениеОтгрузкиПриемкиМерныхТоваров);
	Запрос.УстановитьПараметр("МерныеТипыЕдиницИзмерений",
		Справочники.УпаковкиЕдиницыИзмерения.МерныеТипыЕдиницИзмерений());
	
	Запрос.УстановитьПараметр("ИспользоватьСтатусЗакрыт", ИспользуетсяСтатусЗакрыт);
	
	ГраницыОборотов = ОбщегоНазначенияУТ.ГраницыОборотовРегистра("ЗаказыПоставщикам",
																"ЗаказПоставщику В (&ЗаказыПоставщикам)",
																Запрос.Параметры);
	
	Запрос.УстановитьПараметр("НачПериодЗаказыПоставщикам", ГраницыОборотов.МинимальнаяДата);
	Запрос.УстановитьПараметр("КонПериодЗаказыПоставщикам", ГраницыОборотов.МаксимальнаяДата);
	
	Результат = Запрос.ВыполнитьПакет();
	УстановитьПривилегированныйРежим(Ложь);
	
	ВыборкаЗаказы = Результат[0].Выбрать();
	ТаблицаТоварыКОтмене = Результат[1].Выгрузить();
	
	ДопустимыеОтклонения = Результат[2].Выгрузить();
		
	СтруктураПоиска = Новый Структура("Номенклатура, Характеристика, Склад, Заказ");
	МерныеТоварыККорректировке=ВыделитьМерныеТовары(ТаблицаТоварыКОтмене, ДопустимыеОтклонения, СтруктураПоиска);
	
	Если ВыборкаЗаказы.Количество() = 0
		И ТаблицаТоварыКОтмене.Количество() = 0
		И МерныеТоварыККорректировке.Количество() = 0 Тогда
		ЗаказыЗакрыты = Истина;
		Возврат;
	КонецЕсли;
	
	// формируем табличный документ
	ТаблицаТоварыКОтмене.Колонки.Удалить("Заказ");
	МерныеТоварыККорректировке.Колонки.Удалить("Заказ");
	МерныеТоварыККорректировке.Колонки.Удалить("ХарактеристикиИспользуются");
	МерныеТоварыККорректировке.Колонки.Удалить("ТипНоменклатуры");
	МерныеТоварыККорректировке.Колонки.Удалить("Серия");
	МерныеТоварыККорректировке.Колонки.Удалить("ЭтоОтгрузка");
	
	ТаблицаТоварыКОтмене.Колонки.Добавить("ЭтоМерныеТовары", НОвый ОписаниеТипов("Булево"));
	Для КАждого Ст ИЗ МерныеТоварыККорректировке Цикл
		Нс=ТаблицаТоварыКОтмене.Добавить();
		ЗаполнитьЗначенияСвойств(Нс,Ст );
		Нс.ЭтоМерныеТовары=Истина;
	КонецЦикла;
	
	
	// Сформировать отчет
    КомпоновщикМакета=Новый КомпоновщикМакетаКомпоновкиДанных;
    СхемаКомпоновкиДанных = Задачи.ЗадачаИсполнителя.ПолучитьМакет("ПЛ_ДляЗадачиПоЗаказуПоставщику");

    ДанныеРасшифровки = Новый ДанныеРасшифровкиКомпоновкиДанных;
    Настройки=СхемаКомпоновкиДанных.НастройкиПоУмолчанию;
    МакетКомпоновки=КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,Настройки,ДанныеРасшифровки);

    ВнешниеНаборыДанных=Новый структура;
    ВнешниеНаборыДанных.Вставить("ОстаткиПоЗаказу",ТаблицаТоварыКОтмене);

    ПроцессорКомпоновки=Новый ПроцессорКомпоновкиДанных;

    ПроцессорКомпоновки.Инициализировать(МакетКомпоновки,ВнешниеНаборыДанных,ДанныеРасшифровки,Истина);
    
    ПроцессорВывода=Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
    ПроцессорВывода.УстановитьДокумент(ТабличныйДокумент);
    ПроцессорВывода.Вывести(ПроцессорКомпоновки);
КонецПроцедуры
//<< Портал-Юг, Гладкая  Н., 18.11.2020, [SD33228

//<<Портал-Юг, Гладкая Н. 01.03.2021,SD40699
Процедура докЗаказНаПеремещениеФормаСпискаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка);
	Если Не РольДоступна("ПолныеПрава") И РольДоступна("ПЛ_ФинДепартаментЗакупкиРучные") Тогда
		// уберём видимость команд создания
		Если Форма.Элементы.Найти("ФормаСоздать")<> Неопределено Тогда
			Форма.Элементы.ФормаСоздать.Видимость = Ложь;
		КонецЕсли;
		Если Форма.Элементы.Найти("СписокСоздать")<> Неопределено Тогда
			Форма.Элементы.СписокСоздать.Видимость = Ложь;
		КонецЕсли;
		Если Форма.Элементы.Найти("ГруппаСоздать")<> Неопределено Тогда
			Форма.Элементы.ГруппаСоздать.Видимость = Ложь;
		КонецЕсли;
		Если Форма.Элементы.Найти("СписокСкопировать")<> Неопределено Тогда
			Форма.Элементы.СписокСкопировать.Видимость = Ложь;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры
//>>Портал-Юг, Гладкая Н. 01.03.2021

// << MRS #ERP-5380 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 22.09.25, ()
Процедура докВнутреннееПотреблениеПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)

	ТаблицаТовары = Форма.Элементы.Товары;
	НовыйРеквизит = Форма.Элементы.Вставить("ТоварыMRS_ПричиныСписания", Тип("ПолеФормы"), ТаблицаТовары, Форма.Элементы.ТоварыСтатьяРасходов);
	НовыйРеквизит.Заголовок = "Причины списания (MRS)";
	НовыйРеквизит.Вид = ВидПоляФормы.ПолеВвода;
	НовыйРеквизит.ПутьКДанным = "Объект.Товары.MRS_ПричиныСписания";
	
КонецПроцедуры
// >> MRS #ERP-5380 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 22.09.25, ()

//// << MRS #ERP-5464 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 21.10.25, ()          // пока отключено, скорее всего всё удалить будет надо
//Процедура спрВетеринарноСопроводительныйДокументВЕТИСПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
//	
//	нЭлемент = ДобавитьПолеНаФорму("ПолеВвода", Форма, "MRS_Дата", "Объект.MRS_Дата", "ГруппаОсновноеШапка");
//	нЭлемент.Доступность = Ложь;
//	
//КонецПроцедуры
//// >> MRS #ERP-5464 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 21.10.25, ()

#КонецОбласти

//<< Портал-Юг, Баринов, 2019.08.23 [9.09. Обособление продаж по открытой цене]
//
Процедура ДобавитьРеквизитНаФормуЕслиЕгоНет(Форма, ИмяРеквизита, Тип, ДобавляемыеРеквизиты = Неопределено)
	
	НетРеквизита = Истина;
	Реквизиты = Форма.ПолучитьРеквизиты();
	Для каждого Реквизит Из Реквизиты Цикл
		Если Реквизит.Имя = ИмяРеквизита Тогда
			НетРеквизита = Ложь;
			Прервать;
		КонецЕсли; 
	КонецЦикла; 
	
	Если НетРеквизита Тогда
		ДобавитьРеквизитНаФорму(Форма, ИмяРеквизита, Тип, ДобавляемыеРеквизиты);
	КонецЕсли;
	
КонецПроцедуры //>> Портал-Юг, Баринов, 2019.08.23

#Область Универсальные

//<<Портал-Юг, Каунов, 2016.02.16
// Добавляет новый реквизит в форму
// Использовать только в случае добавления единственного реквизита.
// При добавлении нескольких реквизитов вызов "ИзменитьРеквизиты" должен быть единственным. Вызвать с установленным параметром "ДобавляемыеРеквизиты".
Процедура ДобавитьРеквизитНаФорму(Форма, ИмяРеквизита, Знач ТипРеквизита, ПутьРеквизита = "", ЗаголовокРеквизита = "", Сохранять = Ложь, ДобавляемыеРеквизиты = Неопределено)
	
	ЕдинственныйРеквизит = Ложь;
	
	Если ДобавляемыеРеквизиты = Неопределено Тогда
		ДобавляемыеРеквизиты = Новый Массив;
		ЕдинственныйРеквизит = Истина;
	КонецЕсли;
	
	Если ТипЗнч(ТипРеквизита) = Тип("Строка") Тогда 
		ТипРеквизита = Новый ОписаниеТипов(ТипРеквизита);
	КонецЕсли;	
	
	Реквизит = Новый РеквизитФормы(ИмяРеквизита, ТипРеквизита, ПутьРеквизита, ЗаголовокРеквизита, Сохранять);
	ДобавляемыеРеквизиты.Добавить(Реквизит);
	
	Если ЕдинственныйРеквизит Тогда 
		Форма.ИзменитьРеквизиты(ДобавляемыеРеквизиты);
	КонецЕсли;	
		
КонецПроцедуры //>>Портал-Юг, Каунов, 2016.02.16

//<<Портал-Юг, Каунов, 2016.02.16 
// Добавляет кнопку в форму
//<< Портал-Юг, Свинцов И.И., 2019.02.27 [н/д] 
//Функция ДобавитьКнопкуНаФорму(Форма, ИмяКнопки, ИмяКоманды, РодительСтр = "", ВставитьПеред = "", ВидКнопки = "ОбычнаяКнопка")
Функция ДобавитьКнопкуНаФорму(Форма, ИмяКнопки, ИмяКоманды, Заголовок, РодительСтр = "", ВставитьПеред = "", ВидКнопки = "ОбычнаяКнопка")
//>> Портал-Юг, Свинцов И.И., 2019.02.27
 	
	Родитель = ?(РодительСтр = "", Форма, Форма.Элементы[РодительСтр]);
	нЭлемент = Форма.Элементы.Добавить(ИмяКнопки, Тип("КнопкаФормы"), Родитель);
	нЭлемент.Вид = ВидКнопкиФормы[ВидКнопки];
	
	//<< Портал-Юг, Свинцов И.И., 2019.02.27 [н/д] 
	Команда = Форма.Команды.Добавить(ИмяКоманды);
	Команда.Действие = ИмяКоманды;
	Команда.Заголовок = Заголовок;
	//>> Портал-Юг, Свинцов И.И., 2019.02.27
 
	нЭлемент.ИмяКоманды = ИмяКоманды;
	Если ВставитьПеред <> "" Тогда
		Форма.Элементы.Переместить(нЭлемент,Родитель, Форма.Элементы[ВставитьПеред]); 
	КонецЕсли; 
	
	Возврат нЭлемент;
	
КонецФункции //>>Портал-Юг, Каунов, 2016.02.16

//<<Портал-Юг, Каунов, 2016.02.16
Функция ДобавитьПолеВводаНаФорму(Форма, ИмяПоля, ПутьКДанным, РодительСтр = "", ВставитьПеред = "")
	
	Возврат ДобавитьПолеНаФорму("ПолеВвода", Форма, ИмяПоля, ПутьКДанным, РодительСтр, ВставитьПеред);
	
КонецФункции //>>Портал-Юг, Каунов, 2016.02.16
	
//<<Портал-Юг, Каунов, 2016.02.16
Функция ДобавитьПолеНадписиНаФорму(Форма, ИмяПоля, ПутьКДанным, РодительСтр = "", ВставитьПеред = "", Заголовок = "")
	
	ПолеНадписи = ДобавитьПолеНаФорму("ПолеНадписи", Форма, ИмяПоля, ПутьКДанным, РодительСтр, ВставитьПеред);
	ПолеНадписи.Заголовок = Заголовок;
	Возврат ПолеНадписи;
	
КонецФункции //>>Портал-Юг, Каунов, 2016.02.16

//<<Портал-Юг, Каунов, 2016.02.16
Функция ДобавитьПолеНаФорму(ВидПоля, Форма, ИмяПоля, ПутьКДанным, РодительСтр = "", ВставитьПеред = "")
	
	Родитель = ?(РодительСтр = "", Форма, Форма.Элементы[РодительСтр]);
	нЭлемент = Форма.Элементы.Добавить(ИмяПоля, Тип("ПолеФормы"), Родитель);
	нЭлемент.Вид = ВидПоляФормы[ВидПоля];
	нЭлемент.ПутьКДанным = ПутьКДанным;
	Если ВставитьПеред <> "" Тогда
		Форма.Элементы.Переместить(нЭлемент,Родитель, Форма.Элементы[ВставитьПеред]); 
	КонецЕсли; 
	
	Возврат нЭлемент;
	
КонецФункции //>>Портал-Юг, Каунов, 2016.02.16

//<<===Портал-Юг Крым === Плотникова Н.Ю. 26.03.2020 [Inv#80]
Процедура УстановитьДоступностьПросмотрЭлемента(мТекущийЭлемент) Экспорт
	
	//мИмяЭлемента = мТекущийЭлемент.Имя;
	//мТипЗнч = ТипЗнч(мТекущийЭлемент);
	//
	//Если мИмяЭлемента="НадписьЭтапыОплаты" или мИмяЭлемента="Расчеты" Тогда
	//      ааа=1;
	//КонецЕсли; 
	
	Если ТипЗнч(мТекущийЭлемент)=Тип("ДекорацияФормы") тогда
		Если мТекущийЭлемент.Гиперссылка тогда
			мТекущийЭлемент.Доступность = Ложь;
		КонецЕсли;
	иначеЕсли ТипЗнч(мТекущийЭлемент)=Тип("ГруппаФормы") тогда
		
		//Если СтрНайти(мТекущийЭлемент.Имя,"Создать")>0 тогда
		//	мТекущийЭлемент.Доступность = Ложь;
		//КонецЕсли;	
		
		мАнализИмени = ?(мТекущийЭлемент.Вид = ВидГруппыФормы.КоманднаяПанель,Истина,Ложь);
			
		Для каждого мПодчиненныйЭлемент из мТекущийЭлемент.ПодчиненныеЭлементы цикл
				Если мАнализИмени тогда
					ааа=1;
					Если СтрНайти(мПодчиненныйЭлемент.Имя,"Печать")>0 или СтрНайти(мПодчиненныйЭлемент.Имя,"Отчеты")>0 тогда
					иначе	
						УстановитьДоступностьПросмотрЭлемента(мПодчиненныйЭлемент);	
					КонецЕсли;
				иначе
					УстановитьДоступностьПросмотрЭлемента(мПодчиненныйЭлемент);	
				КонецЕсли;	
		КонецЦикла;	
			
	иначеЕсли ТипЗнч(мТекущийЭлемент)= Тип("ДополнениеЭлементаФормы") тогда
		Если мТекущийЭлемент.ПодчиненныеЭлементы.Количество()>0 тогда
			Для каждого мПодчиненныйЭлемент из мТекущийЭлемент.ПодчиненныеЭлементы цикл
				УстановитьДоступностьПросмотрЭлемента(мПодчиненныйЭлемент);	
			КонецЦикла;	
		иначе	
			мТекущийЭлемент.Доступность = Ложь;
		КонецЕсли;
	//<<===Портал-Юг Крым === Плотникова Н.Ю. 25.06.2020  	
	иначеЕсли ТипЗнч(мТекущийЭлемент)=Тип("ПолеФормы") тогда
			мТекущийЭлемент.ТолькоПросмотр = Истина;
			мТекущийЭлемент.Доступность = Ложь;
	иначеЕсли ТипЗнч(мТекущийЭлемент)=Тип("КнопкаФормы") тогда
	//		мТекущийЭлемент.ТолькоПросмотр = Истина;
	//иначе
			мТекущийЭлемент.Доступность = Ложь;
	КонецЕсли;	
	
КонецПроцедуры

Процедура докЗаказПоставщикуФормаДокументаПриЧтенииНаСервере(Форма, ТекущийОбъект)
	
	Если Форма.Элементы.Найти("ПЛ_Комментарий") = Неопределено Тогда
		ТаблицаТоварыКолонкаКомментарий = Форма.Элементы.Добавить("ПЛ_Комментарий", Тип("ПолеФормы"), Форма.Элементы.Товары);
		ТаблицаТоварыКолонкаКомментарий.Вид = ВидПоляФормы.ПолеВвода;
		ТаблицаТоварыКолонкаКомментарий.ПутьКДанным = "Объект.Товары.ПЛ_Комментарий";
		Форма.Элементы.Переместить(ТаблицаТоварыКолонкаКомментарий,Форма.Элементы.Товары, Форма.Элементы["ТоварыХарактеристика"]);
		
		ГруппаЗаказ = Форма.Элементы.Добавить("ПЛ_ГруппаЗаказ", Тип("ГруппаФормы"), Форма.Элементы.Товары);
		ГруппаЗаказ.Группировка = ГруппировкаКолонок.Горизонтальная;
		Форма.Элементы.Переместить(ГруппаЗаказ, Форма.Элементы.Товары, Форма.Элементы["ТоварыНоменклатура"]);
		
		ТаблицаТоварыНадписьСклад = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Склад", "Объект.Товары.ПЛ_Заказ.СкладПолучатель", "ПЛ_ГруппаЗаказ");
		ТаблицаТоварыНадписьСклад.АвтоОтметкаНезаполненного = Ложь;
		ТаблицаТоварыКолонкаЗаказ = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Заказ", "Объект.Товары.ПЛ_Заказ", "ПЛ_ГруппаЗаказ");
		
		//<< Портал-Юг, Свинцов И.И., 2019.08.27 [9.18 Закрытие заказов на перемещение при закрытии заказа поставщику]
		нЭлемент = ДобавитьКнопкуНаФорму(Форма, "ПЛ_ЗакрытьЗаказыНаПеремещение", "Подключаемый_ПЛ_ЗакрытьЗаказыНаПеремещение", НСтр("ru = 'Закрыть заказы на перемещение'"), "ГруппаСтатусПриоритет", "ГруппаСостояниеЗаказа", "Гиперссылка");
		нЭлемент.ГоризонтальноеПоложениеВГруппе = ГоризонтальноеПоложениеЭлемента.Лево;
		//>> Портал-Юг, Свинцов И.И., 2019.08.27
		
		//<<Портал-Юг, Каунов, 2020.01.08 [INV#32 Заявка не попадает в формирование по потребностям]
		нЭлемент = ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ОтклоненНаДоработку", "Объект.ПЛ_ОтклоненНаДоработку", "ГруппаСтатусПриоритет", "ЗакрытьЗаказ");
		нЭлемент.ПоложениеЗаголовка = ПоложениеЗаголовкаЭлементаФормы.Право;
		//>>Портал-Юг, Каунов, 2020.01.08
		
			Если РольДоступна("ДобавлениеИзменениеПричинОтменыЗаказовПоставщикам") или Пользователи.ЭтоПолноправныйПользователь() тогда    //=== только Администраторы НСИ (ПОртал) или ПолныеПрава 
			иначе
				Если (ТекущийОбъект.Статус = Перечисления.СтатусыЗаказовПоставщикам.Подтвержден или 
					ТекущийОбъект.Статус = Перечисления.СтатусыЗаказовПоставщикам.Закрыт) и ТекущийОбъект.ПЛ_ОтклоненНаДоработку = Ложь тогда
					Для каждого мЭлемент из Форма.Элементы Цикл
						УстановитьДоступностьПросмотрЭлемента(мЭлемент);						
					КонецЦикла;	
				КонецЕсли;
			КонецЕсли;
			
		//<<===Портал-Юг Крым === Плотникова Н.Ю. 17.12.2020 [34760]
		ПЛ_ГруппаДоп = Форма.Элементы.Добавить("ПЛ_ГруппаДоп", Тип("ГруппаФормы"), Форма.Элементы.ГруппаОсновное);
		ПЛ_ГруппаДоп.Вид = ВидГруппыФормы.ОбычнаяГруппа;
		ПЛ_ГруппаДоп.Группировка = ГруппировкаПодчиненныхЭлементовФормы.Вертикальная;
		Форма.Элементы.Переместить(Форма.Элементы.Комментарий,ПЛ_ГруппаДоп,);
		
		НовыйЭлемент = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_Заметки", "Объект.ПЛ_Заметки", "ПЛ_ГруппаДоп",);
		//НовыйЭлемент.КнопкаОчистки = Истина;
		Если РольДоступна("ПЛ_ОтделКонтроляЗакупокПросмотрКомментария") тогда     
	    	НовыйЭлемент.ТолькоПросмотр = Истина;
		КонецЕсли;
		//>>===Портал-Юг Крым === Плотникова Н.Ю. 17.12.2020 [34760] 
	
	КонецЕсли;
	
КонецПроцедуры		
//>>===Портал-Юг Крым === Плотникова Н.Ю. 26.03.2020 [Inv#80] 

Процедура докпитПланМенюФормаДокументаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	НовыйРеквизит = Форма.Элементы.Добавить("ПЛ_ВидПитания", Тип("ПолеФормы"), Форма.Элементы.ШапкаПраво);
	НовыйРеквизит.Заголовок = "Вид питания";
	НовыйРеквизит.Вид = ВидПоляФормы.ПолеВвода;
	НовыйРеквизит.ПутьКДанным = "Объект.ПЛ_ВидПитания";	
	НовыйРеквизит.КнопкаОчистки  = Истина;	
	
	//<< Портал-Юг, Кондрашихин, 2024.08.21 [9268, Обновление ERP 2.5.17]
	ВыпускБлюдЭлемент = ДобавитьПолеВводаНаФорму(Форма, "ПЛ_ВыпускБлюд", "Объект.ПЛ_ВыпускБлюд","Группа1","Организация");
	ВыпускБлюдЭлемент.Заголовок = (НСтр("ru = 'Создан выпуск блюд (пл)'"));
	
	ЭлементКнопка = ДобавитьКнопкуНаФорму(
	Форма, 
	"ПЛ_АнализВыполненияПланаМеню", 
	"Подключаемый_ОткрытьВнешнийОтчетСКДсПараметром", 
	"Анализ выполнения (пл)", "ФормаГлобальныеКоманды"); 

	//>> Портал-Юг, Кондрашихин, 2024.08.21
	
КонецПроцедуры	

//<< Портал-Юг, Кондрашихин, 2024.08.12 [9268, Обновление ERP 2.5.17]
Процедура ДобавитьПолеОтменитьРаспределениеЗапасовНаФорму(Форма, Отказ, СтандартнаяОбработка)

	ПЛ_ОтменитьРаспределениеЗапасов =  ДобавитьПолеНаФорму("ПолеФлажка", Форма, "ПЛ_ОтменитьРаспределениеЗапасов", "Объект.ПЛ_ОтменитьРаспределениеЗапасов", "ГруппаДополнительно");
	
КонецПроцедуры //>> Портал-Юг, Кондрашихин, 2024.08.12

// << MRS #ERP-4945 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 18.02.25, ()

#Область ОписаниеТипов

//////////////////////////////////////////////////////////////////////////////////
//Создание описание типов

// Создание описания типа Строка
//
// Параметры:
//  ДлинаСтроки - Число - длина строки
//
Функция ОписаниеТипаСтрока(ДлинаСтроки = 0) Экспорт
	Возврат Новый ОписаниеТипов("Строка",,кСтрока(ДлинаСтроки));
КонецФункции

// Создание описания типа Число
//
// Параметры:
//  ДлинаЧисла - Число - общая длина числа
//	ТочностьЧисла - Число - количество символов после запятой
//
Функция ОписаниеТипаЧисло(ДлинаЧисла = 15,ТочностьЧисла = 2) Экспорт
	Возврат Новый ОписаниеТипов("Число",кЧисло(ДлинаЧисла,ТочностьЧисла));
КонецФункции

// Создание описания типа ДатаВремя
//
// Параметры:
//  ДатаВремя - Строка - Варианты: "ДатаВремя", "Дата" или "Время"
//
Функция ОписаниеТипаДатаВремя(ДатаВремя = "ДатаВремя") Экспорт
	Возврат Новый ОписаниеТипов("Дата",,,кДатаВремя(ДатаВремя));
КонецФункции

// Создание типа "Таблица значений"
Функция ОписаниеТипаТаблицаЗначений() Экспорт
	
	МассивТипаВыбора = Новый Массив;
	МассивТипаВыбора.Добавить(Тип("ТаблицаЗначений"));
	Возврат Новый ОписаниеТипов(МассивТипаВыбора);	
	
КонецФункции

// Создание типа "Динамический список"
Функция ОписаниеТипаДинамическийСписок() Экспорт
	
	МассивТипаВыбора = Новый Массив;
	МассивТипаВыбора.Добавить(Тип("ДинамическийСписок"));
	Возврат Новый ОписаниеТипов(МассивТипаВыбора);	
	
КонецФункции

// Создание типа "Булево"
Функция ОписаниеТипаБулево() Экспорт
	
	Возврат Новый ОписаниеТипов("Булево");	
	
КонецФункции

// Создание описания ссылочного типа справочника
//
// Параметры:
//  ИмяДокумента - Строка - Имя документа в дереве метаданных
//
Функция ОписаниеТипаДокумент(ИмяДокумента) Экспорт
	
	Возврат Новый ОписаниеТипов("ДокументСсылка." + ИмяДокумента);	
	
КонецФункции

// Создание описания ссылочного типа справочника
//
// Параметры:
//  ИмяСправочника - Строка - Имя справочника в дереве метаданных
//
Функция ОписаниеТипаСправочник(ИмяСправочника) Экспорт
	
	Возврат Новый ОписаниеТипов("СправочникСсылка." + ИмяСправочника);	
	
КонецФункции

// Создание описания типа перечисление
//
// Параметры:
//  ИмяПеречисления - Строка - Имя перечисления в дереве метаданных
//
Функция ОписаниеТипаПеречисление(ИмяПеречисления) Экспорт
	
	Возврат Новый ОписаниеТипов("ПеречислениеСсылка." + ИмяПеречисления);	
	
КонецФункции

///////////////////////////////////////////////////////////////////////////////////
//Создание квалификаторов

// Создание квалификатора для типа Строка
//
// Параметры:
//  ДлинаСтроки - Число - длина строки
//
Функция кСтрока(ДлинаСтроки = 0) Экспорт
	Возврат Новый КвалификаторыСтроки(ДлинаСтроки);
КонецФункции

// Создание квалификатора для типа Число
//
// Параметры:
//  ДлинаЧисла - Число - общая длина числа
//	ТочностьЧисла - Число - количество символов после запятой
//
Функция кЧисло(ДлинаЧисла = 15,ТочностьЧисла = 2) Экспорт
	Возврат Новый КвалификаторыЧисла(ДлинаЧисла,ТочностьЧисла);
КонецФункции

// Создание квалификатора для типа ДатаВремя
//
// Параметры:
//  ДатаВремя - Строка - Варианты: "ДатаВремя", "Дата" или "Время"
//
Функция кДатаВремя(ДатаВремя = "ДатаВремя") Экспорт
	Возврат Новый КвалификаторыДаты(ЧастиДаты[ДатаВремя]);
КонецФункции

#КонецОбласти
// Создание одного реквизита
//
// Параметры:
//	Форма - ФормаКлиентскогоПриложения - Форма на которой создаются элементы
//  ИмяРеквизита - Строка - Имя реквизита
//	ОписаниеТипа - ОписаниеТипа - Описание типа реквизита
//
Процедура СоздатьРеквизит(Форма,ИмяРеквизита,ОписаниеТипа) Экспорт
	
	структураРеквизитов = Новый Структура;
	структураРеквизитов.Вставить(ИмяРеквизита,ОписаниеТипа);
	СоздатьРеквизиты(Форма,структураРеквизитов); 
	
КонецПроцедуры

// Создание реквизитов
//
// Параметры:
//	Форма - ФормаКлиентскогоПриложения - Форма на которой создаются элементы 
//  структураРеквизитов - Структура - Где ключ это Имя реквизита, а значение это описание типа реквизита
//
Процедура СоздатьРеквизиты(Форма,структураРеквизитов) Экспорт
	
	ДобавляемыеРеквизиты = Новый Массив;
	Для Каждого тРеквизит Из структураРеквизитов Цикл 
		НовыйРеквизит = Новый РеквизитФормы(тРеквизит.Ключ,тРеквизит.Значение); 
		ДобавляемыеРеквизиты.Добавить(НовыйРеквизит); 
	КонецЦикла;
	Форма.ИзменитьРеквизиты(ДобавляемыеРеквизиты); 
	
КонецПроцедуры

// Создание реквизитов для таблицы
//
// Параметры:
//	Форма - ФормаКлиентскогоПриложения - Форма на которой создаются элементы 
//	ИмяТаблицы - Строка - Имя таблицы куда добавляете реквизиты
//  структураРеквизитов - Структура - Где ключ это Имя реквизита, а значение это описание типа реквизита
//
Процедура СоздатьРеквизитыТаблицы(Форма,ИмяТаблицы,структураРеквизитов) Экспорт
	
	ДобавляемыеРеквизиты = Новый Массив;
	Для Каждого тРеквизит Из структураРеквизитов Цикл 
		НовыйРеквизит = Новый РеквизитФормы(тРеквизит.Ключ,тРеквизит.Значение,ИмяТаблицы); 
		ДобавляемыеРеквизиты.Добавить(НовыйРеквизит); 
	КонецЦикла;
	Форма.ИзменитьРеквизиты(ДобавляемыеРеквизиты); 
	
КонецПроцедуры

// >> MRS #ERP-4945 ДенисламовАД <Adel.Denislamov@mriyaresort.com> 18.02.25, ()

#КонецОбласти

#КонецОбласти

//<< Портал-Юг, Кондрашихин, 2024.09.16 [9268, Обновление ERP 2.5.17]
// добавляет команду
Процедура обрПитОбеспечениепотребностейФормаПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка)
	
	Кнопка = ДобавитьКнопкуНаФорму(Форма, "ПЛ_ВернутьПланМенюДляПовторнойОбработки",
	"Подключаемый_ПЛ_ВернутьПланМенюДляПовторнойОбработки",
	Нстр("ru = 'Вернуть план-меню для повторной обработки (пл)'"),"ГруппаПараметрыОбеспеченияПотребностей",,"гиперссылка");
	
КонецПроцедуры //>> Портал-Юг, Кондрашихин, 2024.09.16


		
