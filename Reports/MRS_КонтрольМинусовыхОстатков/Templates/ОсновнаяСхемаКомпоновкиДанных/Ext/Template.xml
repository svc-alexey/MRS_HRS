<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>Организация</dataPath>
			<field>Организация</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Склад</dataPath>
			<field>Склад</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Склад</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроцентОтФактического</dataPath>
			<field>ПроцентОтФактического</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Процент от фактического (дата инв.)</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаМинусов</dataPath>
			<field>СуммаМинусов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Сумма минусов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СреднедневнойЗапас</dataPath>
			<field>СреднедневнойЗапас</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Среднедневной запас</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ФактическийОстаток</dataPath>
			<field>ФактическийОстаток</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Фактический остаток (дата инв.)</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>АналитикаУчетаНоменклатуры</dataPath>
			<field>АналитикаУчетаНоменклатуры</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПроцентОтСреднегоЗапаса</dataPath>
			<field>ПроцентОтСреднегоЗапаса</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Процент от среднего запаса</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВидЗапасов</dataPath>
			<field>ВидЗапасов</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НомерГТД</dataPath>
			<field>НомерГТД</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>РазделУчета</dataPath>
			<field>РазделУчета</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОрганизацияМинус</dataPath>
			<field>ОрганизацияМинус</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Организация минус</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:dimension>true</dcscom:dimension>
			</role>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ОрганизацияФакт</dataPath>
			<field>ОрганизацияФакт</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Организация факт</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СкладОрганизация</dataPath>
			<field>СкладОрганизация</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Склад организация</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КоличествоМинусов</dataPath>
			<field>КоличествоМинусов</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Количество минусов</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ФактическийОстатокКоличество</dataPath>
			<field>ФактическийОстатокКоличество</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Фактический остаток количество</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СреднедневнойЗапасКоличество</dataPath>
			<field>СреднедневнойЗапасКоличество</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Среднедневной запас количество</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Признак</dataPath>
			<field>Признак</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Признак</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	СтоимостьСС.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	СтоимостьСС.Организация КАК Организация,
	СтоимостьСС.Стоимость КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоАналитикеОрг
ИЗ
	РегистрСведений.СтоимостьТоваров.СрезПоследних({(&amp;ДатаОстатков)}, ) КАК СтоимостьСС
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СтоимостьСС.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	СтоимостьСС.Стоимость КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоАналитике
ИЗ
	РегистрСведений.СтоимостьТоваров.СрезПоследних({(&amp;ДатаОстатков)}, ) КАК СтоимостьСС

СГРУППИРОВАТЬ ПО
	СтоимостьСС.АналитикаУчетаНоменклатуры,
	СтоимостьСС.Стоимость
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
	СтоимостьВнеш.Организация КАК Организация,
	МАКСИМУМ(СтоимостьВнеш.Стоимость) КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоНомСкладОрг
ИЗ
	РегистрСведений.СтоимостьТоваров КАК СтоимостьВнеш
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			СтоимостьВн.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
			СтоимостьВн.Организация КАК Организация,
			МАКСИМУМ(СтоимостьВн.Период) КАК МаксПериод
		ИЗ
			РегистрСведений.СтоимостьТоваров КАК СтоимостьВн
		ГДЕ
			СтоимостьВн.Период &lt;= &amp;ДатаОстатковСтоимость
		
		СГРУППИРОВАТЬ ПО
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура,
			СтоимостьВн.АналитикаУчетаНоменклатуры.МестоХранения,
			СтоимостьВн.Организация) КАК МаксДата
		ПО СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура = МаксДата.Номенклатура
			И СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения = МаксДата.МестоХранения
			И СтоимостьВнеш.Организация = МаксДата.Организация
			И СтоимостьВнеш.Период = МаксДата.МаксПериод

СГРУППИРОВАТЬ ПО
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура,
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения,
	СтоимостьВнеш.Организация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
	МАКСИМУМ(СтоимостьВнеш.Стоимость) КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоНомСклад
ИЗ
	РегистрСведений.СтоимостьТоваров КАК СтоимостьВнеш
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			СтоимостьВн.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
			МАКСИМУМ(СтоимостьВн.Период) КАК МаксПериод
		ИЗ
			РегистрСведений.СтоимостьТоваров КАК СтоимостьВн
		ГДЕ
			СтоимостьВн.Период &lt;= &amp;ДатаОстатковСтоимость
		
		СГРУППИРОВАТЬ ПО
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура,
			СтоимостьВн.АналитикаУчетаНоменклатуры.МестоХранения) КАК МаксДата
		ПО СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура = МаксДата.Номенклатура
			И СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения = МаксДата.МестоХранения
			И СтоимостьВнеш.Период = МаксДата.МаксПериод

СГРУППИРОВАТЬ ПО
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура,
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.МестоХранения
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	СтоимостьВнеш.Организация КАК Организация,
	МАКСИМУМ(СтоимостьВнеш.Стоимость) КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоНомОрг
ИЗ
	РегистрСведений.СтоимостьТоваров КАК СтоимостьВнеш
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			СтоимостьВн.Организация КАК Организация,
			МАКСИМУМ(СтоимостьВн.Период) КАК МаксПериод
		ИЗ
			РегистрСведений.СтоимостьТоваров КАК СтоимостьВн
		ГДЕ
			СтоимостьВн.Период &lt;= &amp;ДатаОстатковСтоимость
		
		СГРУППИРОВАТЬ ПО
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура,
			СтоимостьВн.Организация) КАК МаксДата
		ПО СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура = МаксДата.Номенклатура
			И СтоимостьВнеш.Организация = МаксДата.Организация
			И СтоимостьВнеш.Период = МаксДата.МаксПериод

СГРУППИРОВАТЬ ПО
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура,
	СтоимостьВнеш.Организация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
	МАКСИМУМ(СтоимостьВнеш.Стоимость) КАК Стоимость
ПОМЕСТИТЬ ВТ_СтоимостьПоНом
ИЗ
	РегистрСведений.СтоимостьТоваров КАК СтоимостьВнеш
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура КАК Номенклатура,
			МАКСИМУМ(СтоимостьВн.Период) КАК МаксПериод
		ИЗ
			РегистрСведений.СтоимостьТоваров КАК СтоимостьВн
		ГДЕ
			СтоимостьВн.Период &lt;= &amp;ДатаОстатковСтоимость
		
		СГРУППИРОВАТЬ ПО
			СтоимостьВн.АналитикаУчетаНоменклатуры.Номенклатура) КАК МаксДата
		ПО СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура = МаксДата.Номенклатура
			И СтоимостьВнеш.Период = МаксДата.МаксПериод

СГРУППИРОВАТЬ ПО
	СтоимостьВнеш.АналитикаУчетаНоменклатуры.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Остатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
	Остатки.Организация КАК Организация,
	ЕСТЬNULL(СтАО.Стоимость, ЕСТЬNULL(СтА.Стоимость, ЕСТЬNULL(СтНСО.Стоимость, ЕСТЬNULL(СтНС.Стоимость, ЕСТЬNULL(СтНО.Стоимость, ЕСТЬNULL(СтН.Стоимость, 0)))))) КАК Стоимость
ПОМЕСТИТЬ ВТ_Стоимость
ИЗ
	(ВЫБРАТЬ РАЗЛИЧНЫЕ
		Остатки.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		Остатки.Организация КАК Организация
	ИЗ
		РегистрНакопления.ТоварыОрганизаций.Остатки({(&amp;ДатаОстатков)}, ) КАК Остатки) КАК Остатки
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоАналитикеОрг КАК СтАО
		ПО Остатки.АналитикаУчетаНоменклатуры = СтАО.АналитикаУчетаНоменклатуры
			И Остатки.Организация = СтАО.Организация
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоАналитике КАК СтА
		ПО Остатки.АналитикаУчетаНоменклатуры = СтА.АналитикаУчетаНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоНомСкладОрг КАК СтНСО
		ПО Остатки.АналитикаУчетаНоменклатуры.Номенклатура = СтНСО.Номенклатура
			И Остатки.АналитикаУчетаНоменклатуры.МестоХранения = СтНСО.МестоХранения
			И Остатки.Организация = СтНСО.Организация
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоНомСклад КАК СтНС
		ПО Остатки.АналитикаУчетаНоменклатуры.Номенклатура = СтНС.Номенклатура
			И Остатки.АналитикаУчетаНоменклатуры.МестоХранения = СтНС.МестоХранения
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоНомОрг КАК СтНО
		ПО Остатки.АналитикаУчетаНоменклатуры.Номенклатура = СтНО.Номенклатура
			И Остатки.Организация = СтНО.Организация
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СтоимостьПоНом КАК СтН
		ПО Остатки.АналитикаУчетаНоменклатуры.Номенклатура = СтН.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ДанныеМинусов.Склад КАК Склад,
	ДанныеМинусов.СкладОрганизация КАК СкладОрганизация,
	ДанныеМинусов.ОрганизацияМинус КАК ОрганизацияМинус,
	ВЫБОР
		КОГДА ДанныеМинусов.СкладОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА ДанныеМинусов.СуммаМинусов / 2
		ИНАЧЕ ДанныеМинусов.СуммаМинусов
	КОНЕЦ КАК СуммаМинусов,
	ВЫБОР
		КОГДА ДанныеМинусов.СкладОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА ДанныеМинусов.КоличествоМинусов / 2
		ИНАЧЕ ДанныеМинусов.КоличествоМинусов
	КОНЕЦ КАК КоличествоМинусов
ПОМЕСТИТЬ ВТ_Минусы
ИЗ
	(ВЫБРАТЬ
		Остатки.АналитикаУчетаНоменклатуры.МестоХранения КАК Склад,
		Остатки.АналитикаУчетаНоменклатуры.МестоХранения.ПЛ_Организация КАК СкладОрганизация,
		Остатки.Организация КАК ОрганизацияМинус,
		СУММА(-Остатки.КоличествоОстаток * ВТ_Стоимость.Стоимость) КАК СуммаМинусов,
		СУММА(-Остатки.КоличествоОстаток) КАК КоличествоМинусов
	ИЗ
		РегистрНакопления.ТоварыОрганизаций.Остатки({(&amp;ДатаОстатков)}, ) КАК Остатки
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Стоимость КАК ВТ_Стоимость
			ПО Остатки.АналитикаУчетаНоменклатуры = ВТ_Стоимость.АналитикаУчетаНоменклатуры
				И Остатки.Организация = ВТ_Стоимость.Организация
	ГДЕ
		Остатки.КоличествоОстаток &lt; 0
	
	СГРУППИРОВАТЬ ПО
		Остатки.АналитикаУчетаНоменклатуры.МестоХранения,
		Остатки.АналитикаУчетаНоменклатуры.МестоХранения.ПЛ_Организация,
		Остатки.Организация) КАК ДанныеМинусов
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	ВТ_Минусы.Склад КАК Склад
ПОМЕСТИТЬ ВТ_СкладыСМинусами
ИЗ
	ВТ_Минусы КАК ВТ_Минусы
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Остатки.АналитикаУчетаНоменклатуры.МестоХранения КАК Склад,
	Остатки.Организация КАК ОрганизацияФакт,
	СУММА(Остатки.КоличествоОстаток * ВТ_Стоимость.Стоимость) КАК СуммаФактОстаток,
	СУММА(Остатки.КоличествоОстаток) КАК КоличествоФактОстаток
ПОМЕСТИТЬ ВТ_ФактОстатки
ИЗ
	РегистрНакопления.ТоварыОрганизаций.Остатки({(&amp;ДатаИнвентаризации)}, ) КАК Остатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СкладыСМинусами КАК ВТ_СкладыСМинусами
		ПО Остатки.АналитикаУчетаНоменклатуры.МестоХранения = ВТ_СкладыСМинусами.Склад
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Стоимость КАК ВТ_Стоимость
		ПО Остатки.АналитикаУчетаНоменклатуры = ВТ_Стоимость.АналитикаУчетаНоменклатуры
			И Остатки.Организация = ВТ_Стоимость.Организация
ГДЕ
	Остатки.КоличествоОстаток &gt; 0
	И Остатки.АналитикаУчетаНоменклатуры.МестоХранения.ПЛ_Организация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)

СГРУППИРОВАТЬ ПО
	Остатки.АналитикаУчетаНоменклатуры.МестоХранения,
	Остатки.Организация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Остатки.АналитикаУчетаНоменклатуры.МестоХранения КАК Склад,
	СУММА(Остатки.КоличествоОстаток * ВТ_Стоимость.Стоимость) КАК СуммаФактОстаток,
	СУММА(Остатки.КоличествоОстаток) КАК КоличествоФактОстаток
ПОМЕСТИТЬ ВТ_ФактОстаткиИтого
ИЗ
	РегистрНакопления.ТоварыОрганизаций.Остатки({(&amp;ДатаИнвентаризации)}, ) КАК Остатки
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СкладыСМинусами КАК ВТ_СкладыСМинусами
		ПО Остатки.АналитикаУчетаНоменклатуры.МестоХранения = ВТ_СкладыСМинусами.Склад
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Стоимость КАК ВТ_Стоимость
		ПО Остатки.АналитикаУчетаНоменклатуры = ВТ_Стоимость.АналитикаУчетаНоменклатуры
			И Остатки.Организация = ВТ_Стоимость.Организация
ГДЕ
	Остатки.КоличествоОстаток &gt; 0
	И Остатки.АналитикаУчетаНоменклатуры.МестоХранения.ПЛ_Организация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)

СГРУППИРОВАТЬ ПО
	Остатки.АналитикаУчетаНоменклатуры.МестоХранения
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОстаткиПоДням.МестоХранения КАК Склад,
	СРЕДНЕЕ(ОстаткиПоДням.СтоимостнойОстаток) КАК СреднедневнойЗапас,
	СРЕДНЕЕ(ОстаткиПоДням.КоличественныйОстаток) КАК СреднедневнойЗапасКоличество
ПОМЕСТИТЬ ВТ_СреднийЗапас
ИЗ
	(ВЫБРАТЬ
		ОстаткиИОбороты.АналитикаУчетаНоменклатуры.МестоХранения КАК МестоХранения,
		СУММА(ОстаткиИОбороты.КоличествоКонечныйОстаток * ВТ_Стоимость.Стоимость) КАК СтоимостнойОстаток,
		СУММА(ОстаткиИОбороты.КоличествоКонечныйОстаток) КАК КоличественныйОстаток
	ИЗ
		РегистрНакопления.ТоварыОрганизаций.ОстаткиИОбороты({(&amp;НачалоОборотов)}, {(&amp;ДатаОстатков)}, День, , ) КАК ОстаткиИОбороты
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СкладыСМинусами КАК ВТ_СкладыСМинусами
			ПО ОстаткиИОбороты.АналитикаУчетаНоменклатуры.МестоХранения = ВТ_СкладыСМинусами.Склад
			ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_Стоимость КАК ВТ_Стоимость
			ПО ОстаткиИОбороты.АналитикаУчетаНоменклатуры = ВТ_Стоимость.АналитикаУчетаНоменклатуры
				И ОстаткиИОбороты.Организация = ВТ_Стоимость.Организация
	
	СГРУППИРОВАТЬ ПО
		ОстаткиИОбороты.АналитикаУчетаНоменклатуры.МестоХранения,
		ОстаткиИОбороты.Период) КАК ОстаткиПоДням

СГРУППИРОВАТЬ ПО
	ОстаткиПоДням.МестоХранения
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Минусы.Склад КАК Склад,
	Минусы.СкладОрганизация КАК СкладОрганизация,
	Минусы.ОрганизацияМинус КАК ОрганизацияМинус,
	ВЫБОР
		КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА ФактОстатки.ОрганизацияФакт
		ИНАЧЕ NULL
	КОНЕЦ КАК ОрганизацияФакт,
	ОКР(Минусы.СуммаМинусов, 2) КАК СуммаМинусов,
	ОКР(Минусы.КоличествоМинусов, 3) КАК КоличествоМинусов,
	ОКР(СреднийЗапас.СреднедневнойЗапас, 2) КАК СреднедневнойЗапас,
	ОКР(СреднийЗапас.СреднедневнойЗапасКоличество, 3) КАК СреднедневнойЗапасКоличество,
	ОКР(ВЫБОР
			КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				ТОГДА ФактОстатки.СуммаФактОстаток
			ИНАЧЕ ФактОстаткиИтого.СуммаФактОстаток
		КОНЕЦ, 2) КАК ФактическийОстаток,
	ОКР(ВЫБОР
			КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				ТОГДА ФактОстатки.КоличествоФактОстаток
			ИНАЧЕ ФактОстаткиИтого.КоличествоФактОстаток
		КОНЕЦ, 3) КАК ФактическийОстатокКоличество,
	ВЫБОР
		КОГДА СреднийЗапас.СреднедневнойЗапас &lt;&gt; 0
				И НЕ СреднийЗапас.СреднедневнойЗапас ЕСТЬ NULL
			ТОГДА ОКР(Минусы.СуммаМинусов / СреднийЗапас.СреднедневнойЗапас * 100, 2)
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентОтСреднегоЗапаса,
	ВЫБОР
		КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				И ФактОстатки.СуммаФактОстаток &lt;&gt; 0
				И НЕ ФактОстатки.СуммаФактОстаток ЕСТЬ NULL
			ТОГДА ОКР(Минусы.СуммаМинусов / ФактОстатки.СуммаФактОстаток * 100, 2)
		КОГДА Минусы.СкладОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				И ФактОстаткиИтого.СуммаФактОстаток &lt;&gt; 0
				И НЕ ФактОстаткиИтого.СуммаФактОстаток ЕСТЬ NULL
			ТОГДА ОКР(Минусы.СуммаМинусов / ФактОстаткиИтого.СуммаФактОстаток * 100, 2)
		ИНАЧЕ 0
	КОНЕЦ КАК ПроцентОтФактического,
	ВЫБОР
		КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				И ФактОстатки.ОрганизацияФакт ЕСТЬ NULL
			ТОГДА "НЕТ ПЛЮСОВЫХ ОСТАТКОВ"
		КОГДА Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
				И Минусы.ОрганизацияМинус &lt;&gt; ФактОстатки.ОрганизацияФакт
			ТОГДА "МЕЖФИРМЕННАЯ ПРОБЛЕМА"
		КОГДА Минусы.СкладОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА "Склад без организации"
		ИНАЧЕ "ОК - та же организация"
	КОНЕЦ КАК Признак
ИЗ
	ВТ_Минусы КАК Минусы
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ФактОстатки КАК ФактОстатки
		ПО Минусы.Склад = ФактОстатки.Склад
			И (Минусы.СкладОрганизация &lt;&gt; ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка))
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ФактОстаткиИтого КАК ФактОстаткиИтого
		ПО Минусы.Склад = ФактОстаткиИтого.Склад
			И (Минусы.СкладОрганизация = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка))
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СреднийЗапас КАК СреднийЗапас
		ПО Минусы.Склад = СреднийЗапас.Склад

УПОРЯДОЧИТЬ ПО
	Склад,
	ОрганизацияМинус,
	ОрганизацияФакт</query>
	</dataSet>
	<parameter>
		<name>ДатаИнвентаризации</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата инвентаризации</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>Date</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
		<denyIncompleteValues>true</denyIncompleteValues>
	</parameter>
	<parameter>
		<name>ДатаОстатков</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата остатков</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>Date</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>ДатаОстатковСтоимость</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата остатков стоимость</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>НачалоОборотов</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Начало оборотов</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Контроль минусовых остатков (mrs)</v8:content>
			</v8:item>
			<v8:item>
				<v8:lang>en</v8:lang>
				<v8:content>Основной</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ОрганизацияМинус</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СкладОрганизация</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Склад</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаМинусов</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СреднедневнойЗапас</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ФактическийОстаток</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПроцентОтСреднегоЗапаса</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПроцентОтФактического</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:filter>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Склад</dcsset:left>
					<dcsset:comparisonType>InList</dcsset:comparisonType>
					<dcsset:right xsi:type="v8:ValueListType">
						<v8:valueType/>
						<v8:lastId xsi:type="xs:decimal">-1</v8:lastId>
					</dcsset:right>
					<dcsset:userSettingID>fcc94a0d-1c3a-48c0-9eda-4284ae3cb631</dcsset:userSettingID>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:FilterItemComparison">
					<dcsset:use>false</dcsset:use>
					<dcsset:left xsi:type="dcscor:Field">Организация</dcsset:left>
					<dcsset:comparisonType>InList</dcsset:comparisonType>
					<dcsset:right xsi:type="v8:ValueListType">
						<v8:valueType/>
						<v8:lastId xsi:type="xs:decimal">-1</v8:lastId>
					</dcsset:right>
					<dcsset:userSettingID>b15adbbc-63db-44bc-9356-5a5d1388eb71</dcsset:userSettingID>
				</dcsset:item>
			</dcsset:filter>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ДатаИнвентаризации</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardBeginningDate">
						<v8:variant xsi:type="v8:StandardBeginningDateVariant">Custom</v8:variant>
						<v8:date>2026-01-20T00:00:00</v8:date>
					</dcscor:value>
					<dcsset:userSettingID>c9a46749-f5ef-4e1d-99a4-d5b8f4becfbd</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>ДатаОстатков</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardBeginningDate">
						<v8:variant xsi:type="v8:StandardBeginningDateVariant">Custom</v8:variant>
						<v8:date>2026-01-26T00:00:00</v8:date>
					</dcscor:value>
					<dcsset:userSettingID>324dcd82-e38b-486e-b18a-d7c05614b604</dcsset:userSettingID>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>